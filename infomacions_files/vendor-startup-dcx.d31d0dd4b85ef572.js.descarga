"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["72692"],{397503:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s,o,i,n,a,l,d,h,c,u,p,_,f=r(247673),g=r(111829),m=r(866525),E=r(42173);function A(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=A(f),D=A(m);let C={Asset:"asset",Composite:"composite",File:"file",Directory:"directory",Version:"version"};t.HeaderKeys=void 0,(s=t.HeaderKeys||(t.HeaderKeys={})).CONTENT_ID="content-id",s.CONTENT_LENGTH="content-length",s.CONTENT_RANGE="content-range",s.CONTENT_TYPE="content-type",s.IF_MATCH="if-match",s.IF_NONE_MATCH="if-none-match",s.AUTHORIZATION="authorization",s.X_API_KEY="x-api-key",t.HTTPMethods=void 0,(o=t.HTTPMethods||(t.HTTPMethods={})).GET="GET",o.PUT="PUT",o.PATCH="PATCH",o.HEAD="HEAD",o.POST="POST",o.DELETE="DELETE";let I={ACCESS_CHECK:"http://ns.adobe.com/adobecloud/rel/ac/check",ACL_POLICY:"http://ns.adobe.com/adobecloud/rel/ac/policy",ANNOTATIONS:"http://ns.adobe.com/adobecloud/rel/annotations",APP_METADATA:"http://ns.adobe.com/adobecloud/rel/metadata/application",BASE_DIRECTORY:"http://ns.adobe.com/adobecloud/rel/directory/base",BLOCK_DOWNLOAD:"http://ns.adobe.com/adobecloud/rel/download",BLOCK_EXTEND:"http://ns.adobe.com/adobecloud/rel/block/extend",BLOCK_FINALIZE:"http://ns.adobe.com/adobecloud/rel/block/finalize",BLOCK_TRANSFER:"http://ns.adobe.com/adobecloud/rel/block/transfer",BLOCK_UPLOAD_INIT:"http://ns.adobe.com/adobecloud/rel/block/init",BULK_REQUEST:"http://ns.adobe.com/adobecloud/rel/bulk",COMPONENT:"http://ns.adobe.com/adobecloud/rel/component",CREATE:"http://ns.adobe.com/adobecloud/rel/create",DESCRIBED_BY:"describedBy",DIRECTORY:"http://ns.adobe.com/adobecloud/rel/directory",DISCARD:"http://ns.adobe.com/adobecloud/rel/discard",EFFECTIVE_PRIVILAGES:"http://ns.adobe.com/adobecloud/rel/ac/effective",EMBEDDED_METADATA:"http://ns.adobe.com/adobecloud/rel/metadata/embedded",ID:"http://ns.adobe.com/adobecloud/rel/id",MANIFEST:"http://ns.adobe.com/adobecloud/rel/manifest",PAGE:"http://ns.adobe.com/adobecloud/rel/page",PATH:"http://ns.adobe.com/adobecloud/rel/path",PRIMARY:"http://ns.adobe.com/adobecloud/rel/primary",RENDITION:"http://ns.adobe.com/adobecloud/rel/rendition",REPO_METADATA:"http://ns.adobe.com/adobecloud/rel/metadata/repository",REPO_OPS:"http://ns.adobe.com/adobecloud/rel/ops",REPOSITORY:"http://ns.adobe.com/adobecloud/rel/repository",RESOLVE_BY_ID:"http://ns.adobe.com/adobecloud/rel/resolve/id",RESOLVE_BY_PATH:"http://ns.adobe.com/adobecloud/rel/resolve/path",RESTORE:"http://ns.adobe.com/adobecloud/rel/restore",VERSION_HISTORY:"version-history"},v="application/vnd.adobecloud.directory+json",b="application/vnd.adobe.dcx-manifest+json",T="application/json",P="application/problem+json",R="application/json-patch+json",w="application/vnd.adobecloud.bulk-transfer+json",O="application/vnd.adobe.asset-operation+json";t.Properties=void 0,(i=t.Properties||(t.Properties={})).DC_FORMAT="dc:format",i.DC_TITLE="dc:title",i.LINKS="_links",i.PAGE="_page",i.CHILDREN="children",i.EMBEDDED="_embedded",i.REPO_REPRESENTATIONS="repo:representations",i.REPO_ASSET_ID="repo:assetId",i.REPO_REPOSITORY_ID="repo:repositoryId",i.REPO_REPOSITORY_TYPE="repo:repositoryType",i.REPO_BASE_ASSET_ID="repo:baseAssetId",i.REPO_SIZE="repo:size",i.REPO_NAME="repo:name",i.REPO_PATH="repo:path",i.REPO_ASSET_CLASS="repo:assetClass",i.REPO_CREATE_DATE="repo:createDate",i.REPO_MODIFY_DATE="repo:modifyDate",i.REPO_DISCARD_DATE="repo:discardDate",i.REPO_ETAG="repo:etag",i.REPO_CREATED_BY="repo:createdBy",i.REPO_MODIFIED_BY="repo:modifiedBy",i.REPO_DISCARDED_BY="repo:discardedBy",i.REPO_DEVICE_CREATE_DATE="storage:deviceCreateDate",i.REPO_DEVICE_MODIFY_DATE="storage:deviceModifyDate",i.REPO_DEFAULT_SCHEDULED_DELETION_DURATION="repo:defaultScheduledDeletionDuration",i.REPO_SCHEDULED_DELETION_DATE="repo:scheduledDeletionDate",i.REPO_VERSION="repo:version",i.REPO_STATE="repo:state",i.REPO_AVAILABLE_REGIONS="repo:availableRegions",i.REPO_REGIONS="repo:regions",i.REPO_OWNER="repo:owner",i.REPO_OWNER_ID="id",i.REPO_OWNER_TYPE="type",i.STORAGE_ASSIGNEE="storage:assignee",i.STORAGE_ASSIGNEE_ID="id",i.STORAGE_ASSIGNEE_TYPE="type",i.IMAGE_LENGTH="tiff:imageLength",i.IMAGE_WIDTH="tiff:imageWidth",i.NUM_OF_PAGES="xmpTPg:NPages",i.PAGE_START="start",i.PAGE_ORDER_BY="orderBy",i.PAGE_NEXT="next",i.PAGE_COUNT="count",i.PAGE_LIMIT="limit",t.VersionProperties=void 0,(n=t.VersionProperties||(t.VersionProperties={})).REPO_ID="repo:id",n.CREATED="created",n.CREATED_BY="created_by",n.MILESTONE="milestone",n.VERSION="version",n.TOTAL_CHILDREN="total_children",t.PolicyProperties=void 0,(a=t.PolicyProperties||(t.PolicyProperties={})).REPO_ACL="repo:acl",a.REPO_PRINCIPLE="repo:principal",a.REPO_MODIFIER="repo:modifier",a.REPO_PRIVILEGES="repo:privileges",a.REPO_RELATIONS="repo:relations",a.REPO_INHERITANCE="repo:inheritance",t.PolicyPrincipalProperties=void 0,(l=t.PolicyPrincipalProperties||(t.PolicyPrincipalProperties={})).XDM_PROVIDER="xdm:provider",l.ID="@id",l.TYPE="@type",t.XDMProviderProperties=void 0,(t.XDMProviderProperties||(t.XDMProviderProperties={})).ID="@id",t.EmbeddedMetadataMediaTypes=void 0,(d=t.EmbeddedMetadataMediaTypes||(t.EmbeddedMetadataMediaTypes={})).XML="application/rdf+xml",d.JSON="application/ld+json",t.BlockTransferProperties=void 0,(h=t.BlockTransferProperties||(t.BlockTransferProperties={})).REPO_SIZE="repo:size",h.REPO_BLOCK_SIZE="repo:blocksize",h.REPO_REL_TYPE="repo:reltype",h.COMPONENT_ID="component_id",h.DC_FORMAT="dc:format",h.REPO_MD5="repo:md5",h.REPO_EXPIRES="repo:expires",h.REPO_IF_MATCH="repo:if-match",h.MAX_SINGLE_TRANSFER_SIZE="repo:maxSingleTransferSize",h.REPO_MIN_BLOCK_TRANSFER_SIZE="repo:minBlockTransferSize",t.Constants=void 0,(c=t.Constants||(t.Constants={})).DEVICE_MODIFY_DATE="deviceModifyDate",c.REPO_META_PATCH="repoMetaPatch",c.RESPOND_WITH="respondWith";let k=["buffer","arraybuffer","string","text","blob","json","stream","defaultbuffer"];function S(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)0>t.indexOf(s[o])&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r}function N(e,t,r,s){return new(r||(r=Promise))(function(o,i){function n(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((s=s.apply(e,t||[])).next())})}function L(e){return this instanceof L?(this.v=e,this):new L(e)}function M(e){return E.isObject(e)&&["headers","responseType","statusCode","xhr"].every(t=>t in e)}function X(e){return E.isObject(e)&&M(e.response)}function x(e){return E.isObject(e)&&X(e)&&"result"in e}function B(e){return E.isObject(e)&&E.isAnyFunction(e.slice)}function j(e){return E.isObject(e)&&"resolvePullWithBranch"in e}function U(e){return"undefined"!=typeof Blob&&e instanceof Blob}function H(e){return E.isObject(e)&&("string"==typeof e.repositoryId&&"string"==typeof e.path||"string"==typeof e.assetId)}function V(e){return E.isObject(e)&&("AdobeHTTPService"===e.name||E.isAnyFunction(e.invoke))}function F(e){return E.isObject(e)&&V(e.service)}function Y(e){if(!E.isObject(e))return!1;let r=e[t.Properties.LINKS];return!!E.isObject(r)&&!!(r[I.BLOCK_TRANSFER]&&r[I.BLOCK_EXTEND]&&r[I.BLOCK_FINALIZE])}let W=g.newDebug("dcx:assets:service"),q=e=>F(e)?e.service:e,z=e=>F(e)?e.cache:void 0;function G(e,t){W("constructServiceEndpoint()",e);let r=t._repoAPIBaseUrl;return r&&(e=`${r.endsWith("/")?r.substr(0,r.length-1):r}${e}`),W("cSE()",e),e}let K=(e,t,r)=>{if(null==t&&null==r&&null==e)return f._defaultStatusValidator;let s=r||{},o=t||{},i=e||[];return(e,t)=>{var r,n;if(!e||!t)return new y.default(f.ErrorCodes.NETWORK_ERROR,"Invalid or missing status code",void 0,t);if(i.includes(e))return!0;let a=o[e]||(null==(r=f.HTTP_STATUS_ERROR_MAP.get(e))?void 0:r.message)||"Unexpected response",l=s[e]||(null==(n=f.HTTP_STATUS_ERROR_MAP.get(e))?void 0:n.code),d=f._defaultStatusValidator(e,t);return!0===d&&null==l||(f.isAdobeDCXError(d)?d:!!l&&new y.default(l,a,void 0,t))}},$=(e,t=[],r,s)=>{if(!E.isObject(e))throw new y.default(r||y.default.INVALID_PARAMS,s||"Missing or invalid links on Asset");t.map(t=>{if(!(t in e)||!E.isObject(e[t]))throw new y.default(r||y.default.INVALID_PARAMS,s||`Missing required link: ${t}`)})},J=(e={},t=[])=>{if(0!==t.length){for(let r=0;r<t.length;r++){let s=t[r];if(s in e&&E.isObject(e[s]))return s}throw new y.default(y.default.INVALID_PARAMS,`Missing links, one required: ${t.join(", ")}`)}},Z=(e,t,r,s)=>{let o=E.getLinkProperty(e,t,r);if(!o)throw new y.default(y.default.INVALID_DATA,`Missing ${r} param on Link`);if(o!==s)throw new y.default(y.default.INVALID_DATA,`Invalid ${r} param on Link, expected ${s}`)},Q=(e,t=[])=>{try{$(e,t)}catch(e){return!1}return!0},ee=(e,t=[])=>!!E.isObject(e)&&Q(e.links||e._links,t);function et(e){if(!H(e))throw new y.default(y.default.INVALID_PARAMS,"Asset must contain links or repositoryId + path or assetId to be resolved.")}function er(e,t,r){if(!E.isObject(e))throw new y.default(y.default.INVALID_PARAMS,`Invalid parameter. Expected object, encountered "${null===e?"null":typeof e}".`);if(!(t in e))throw new y.default(y.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing key "${String(t)}".`);if(r)try{E.validateParam(t,e[t],r)}catch(s){throw new y.default(y.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing key "${String(t)}" with type "${r}", encountered type "${typeof e[t]}".`)}}function es(e,t,r){if(!(t.length<1)){for(let s of t)try{return void er(e,s,r)}catch(e){}throw new y.default(y.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing one of [${t.join(", ")}]`+(r?` with type ${r}, encountered types [${t.map(t=>typeof e[t]).join(", ")}].`:"."))}}let eo=g.newDebug("dcx:assets:util:http");function ei(e,r,s){return eo("headHTTPResource()"),q(e).invoke(t.HTTPMethods.HEAD,r,s,void 0,{isStatusValid:K()})}function en(e,r,s,o){return q(e).invoke(t.HTTPMethods.GET,r,s,void 0,{isStatusValid:K(),responseType:o})}let ea=g.newDebug("dcx:assets:util:serialization");function el(e,r){ea("deserializeAsset()");let s={};s.repositoryId=e.repositoryId||e[t.Properties.REPO_REPOSITORY_ID],s.assetId=e.assetId||e[t.Properties.REPO_ASSET_ID],s.name=e.name||e[t.Properties.REPO_NAME],s.size=null!=e.size?e.size:e[t.Properties.REPO_SIZE],s.path=e.path||e[t.Properties.REPO_PATH],s.assetClass=e.etag||e[t.Properties.REPO_ASSET_CLASS],s.etag=e.etag||e[t.Properties.REPO_ETAG],s.version=e.version||e[t.Properties.REPO_VERSION],s.format=e.format||e[t.Properties.DC_FORMAT],s.md5=e.md5,s.createDate=e.createDate||e[t.Properties.REPO_CREATE_DATE],s.modifyDate=e.modifyDate||e.modifiedDate||e[t.Properties.REPO_MODIFY_DATE],s.discardDate=e.discardDate||e[t.Properties.REPO_DISCARD_DATE],s.createdBy=e.createdBy||e[t.Properties.REPO_CREATED_BY],s.modifiedBy=e.modifiedBy||e[t.Properties.REPO_MODIFIED_BY],s.discardedBy=e.discardedBy||e[t.Properties.REPO_DISCARDED_BY],s.deviceCreateDate=e.deviceCreateDate||e[t.Properties.REPO_DEVICE_CREATE_DATE],s.deviceModifyDate=e.deviceModifyDate||e[t.Properties.REPO_DEVICE_MODIFY_DATE],s.defaultScheduledDeletionDuration=e.defaultScheduledDeletionDuration||e[t.Properties.REPO_DEFAULT_SCHEDULED_DELETION_DURATION],s.scheduledDeletionDate=e.scheduledDeletionDate||e[t.Properties.REPO_SCHEDULED_DELETION_DATE],s.baseAssetId=e.baseAssetId||e[t.Properties.REPO_BASE_ASSET_ID],s.state=e.state||e[t.Properties.REPO_STATE],s.links=e.links||e[t.Properties.LINKS],s.representations=e.representations||e[t.Properties.REPO_REPRESENTATIONS],s.width=e.width||e[t.Properties.IMAGE_WIDTH],s.length=e.length||e[t.Properties.IMAGE_LENGTH];let o=[r,e._embedded].flat();return s.embedded=Object.entries({EffectivePrivileges:I.EFFECTIVE_PRIVILAGES,RepositoryResource:I.REPOSITORY,AppMetadata:I.APP_METADATA}).reduce((e,[t,r])=>(o.filter(e=>e&&r in e).forEach(s=>E.merge(e,{[t]:r===I.REPOSITORY?ed(s):s})),e),{}),E.pruneUndefined(s)}function ed(e={}){ea("deserializeRepository()");let r=e[I.REPOSITORY]?e[I.REPOSITORY]:e;return{repositoryId:r[t.Properties.REPO_REPOSITORY_ID],repositoryType:r[t.Properties.REPO_REPOSITORY_TYPE],owner:r[t.Properties.REPO_OWNER],createDate:r[t.Properties.REPO_CREATE_DATE],title:r[t.Properties.DC_TITLE],availableRegions:r[t.Properties.REPO_AVAILABLE_REGIONS]}}let eh=g.newDebug("dcx:assets:util:link");function ec(e,t){eh("getIndexLinks()");let r=q(e),s=z(e);if(s){let e=s.getIndexLinks();if(e)return D.default.resolve(e);s.setPending("INDEX")}return ei(r,G("/",r),t).then(e=>ep(e)).then(e=>(s&&s.setIndexLinks(e),e)).catch(e=>{throw s&&s.delete("INDEX"),e})}function eu(e,r){eh("getIndexDocument()");let s=q(e),o=z(e);if(o){let e=o.getIndexRepository();if(e)return D.default.resolve(e)}let i=G("/",s);return s.invoke(t.HTTPMethods.GET,i,r,void 0,{responseType:"json",isStatusValid:K()}).then(e=>{let r=ep(e),s=e.response,i={};for(let e in s.children){let r=s.children[e],o=r[t.Properties.LINKS];switch(r[t.Properties.REPO_PATH]){case"/Index.json":i.indexLinks=o;break;case"/Assets.json":i.assetLinks=o;break;case"/Repositories.json":i.repositoryLinks=o}}return o&&(o.setIndexLinks(r),o.setIndexRepository(i)),i})}function ep(e){if(!e.headers||!e.headers.link)throw new f.DCXError(f.DCXError.INVALID_DATA,"Failed to parse, missing link header");return e_(e.headers.link)}function e_(e){try{let r=E.parse(e),s={};for(let e in r.refs){let o=r.refs[e],{rel:i,uri:n,templated:a,type:l,width:d,height:h}=o,c=S(o,["rel","uri","templated","type","width","height"]),u=E.pruneUndefined({href:n,templated:a?"true"===a:void 0,type:l,width:d,height:h,[t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE]:c[t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE.toLowerCase()],[t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE]:c[t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE.toLowerCase()]});["width","height"].filter(e=>e in u).forEach(e=>{let t=parseInt(u[e],10);isNaN(t)||(u[e]=t)});let p=s[i];Array.isArray(p)?p.push(u):s[i]=p?[p,u]:u}return Object.assign({},s)}catch(e){throw new f.DCXError(f.DCXError.INVALID_DATA,"Failed to parse, invalid link header",e)}}function ef(e,t){if(E.isObject(this)){if("string"==typeof this.opsHref)return D.default.resolve(this.opsHref);if(E.isAnyFunction(this.opsHref))return D.default.resolve(this.opsHref())}return ec(e,t).then(e=>{try{return E.getLinkHref(e,I.REPO_OPS)}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"Could not get ops href.",e)}})}let eg=g.newDebug("dcx:assets:operations"),em=g.newDebug("dcx:assets:operations:builder");function eE(e,t,r,s,o,i,n){eg("copyAsset()"),E.validateParams(["svc",e,"object"],["srcAsset",t,"object"],["destAsset",r,"object"],["createIntermediates",s,"boolean"],["overwriteExisting",o,"boolean",!0],["manifestPatch",n,["object","string"],!0]),es(t,["repo:path","path","assetId","repo:assetId"],"string"),es(r,["repo:path","path","assetId","repo:assetId"],"string");let a=eM("copy",r,t,{overwriteExisting:o,createIntermediates:s},{"repo:manifestPatch":JSON.stringify(n)}),l=q(e);return ef.call(this,e).then(e=>eP(l,e,a,i)).then(ek.bind(void 0,r)).then(eS)}let eA=e=>"string"==typeof e?{reltype:e,component_id:"",revision:""}:e;function ey(e,t,r,s,o,i){eg("moveAsset()"),E.validateParams(["svc",e,"object"],["srcAsset",t,"object"],["destAsset",r,"object"],["createIntermediates",s,"boolean"],["overwriteExisting",o,"boolean",!0]),es(t,["repo:path","path","assetId","repo:assetId"],"string"),es(r,["repo:path","path","assetId","repo:assetId"],"string");let n=eM("move",r,t,{createIntermediates:s,overwriteExisting:o}),a=q(e);return ef.call(this,e).then(e=>eP(a,e,n,i)).then(ek.bind(void 0,r)).then(eS)}function eD(e,t,r,s,o){eg("discardAsset()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["etag",r,"string",!0],["recursive",s,"boolean",!0]);let i=q(e);es(t,["repo:path","path","assetId","repo:assetId"],"string");let n=eM("discard",Object.assign(Object.assign({},t),{etag:r}),void 0,{recursive:s});return ef.call(this,e).then(e=>eP(i,e,n,o)).then(eN)}function eC(e,r,s="*",o,i){eg("deleteAsset()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["etag",s,"string",!0],["recursive",o,"boolean",!0]);let n=q(e);if(r.format===v&&null==o)throw new y.default(y.default.INVALID_PARAMS,"Recursive flag is required for directory assets.");if(!o&&ee(r,[I.REPO_METADATA])){let e=E.getLinkHrefTemplated(r,I.REPO_METADATA,{});return n.invoke("DELETE",e,{[t.HeaderKeys.IF_MATCH]:s},void 0,{isStatusValid:K()}).then(eN)}es(r,["repo:path","path","assetId","repo:assetId"],"string");let a=Object.create(Object.getPrototypeOf(r),Object.getOwnPropertyDescriptors(r));a.etag=s;let l=eM("delete",a,void 0,{recursive:o});return ef.call(this,e).then(e=>eP(n,e,l,i)).then(eN)}function eI(e,t,r){eg("restoreAsset()"),E.validateParams(["svc",e,"object"],["asset",t,"object"]);let s=q(e);es(t,["assetId","repo:assetId"],"string");let o=eM("restore",t);return ef.call(this,e).then(e=>eP(s,e,o,r)).then(ek.bind(void 0,t)).then(eS)}function ev(e,t,r,s,o,i){var n;eg("packageAssets()"),E.validateParams(["svc",e,"object"],["destination",r,"object"]),E.validateParam("sources",t,["object","object[]"]),t=E.isArray(t)?t:[t],n=["repo:path","path","assetId","repo:assetId"],t.map(e=>es(e,n,"string")),es(r,["repo:path","path","assetId","repo:assetId"],"string");let a=eM("package",r,t,{createIntermediates:s,overwriteExisting:o}),l=q(e);return ef.call(this,e).then(e=>eP(l,e,a,i)).then(ek.bind(void 0,r)).then(eN)}function eb(e){return{result:(E.isArray(e.response)?e.response:[e.response]).map(eT),response:e}}function eT(e){if(!e.error)return e;let t=Object.assign({},e),r=K()(e.error.status);return t.error=f.isAdobeDCXError(r)?r:new y.default(y.default.UNEXPECTED,"Unexpected response"),t._additionalData=e.error,t.error._message=e.error.title,t}function eP(e,r,s,o){return eg("doOperation()"),E.validateParams(["svc",e,"object"],["opsEndpoint",r,"string"],["operationDocument",s,["string","object"]],["additionalHeaders",o,"object",!0]),(function(e,r,s,o={}){return e.invoke(t.HTTPMethods.POST,r,Object.assign({[t.HeaderKeys.CONTENT_TYPE]:O},o),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K(),responseType:"json",retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:"get"}})})(e,r,s,o).then(e=>{if(e.response=e.response||{},e.response.error)throw new y.default(y.default.UNEXPECTED_RESPONSE,e.response.type||"Operation failed.",Error(e.response.title),e);return e})}class eR{constructor(){this.opBatchLimit=100,this._docs=[]}getDocumentEntry(e){return this._docs[e]}getDocument(){return this._docs}get entryCount(){return this._docs.length}copyResources(e,t,r,s,o,i){em("copyResource()"),this._assertUnderLimit(),this._checkSourceType(e),this._checkTargetType(t);let n=this._docs.find(function(r){return"copy_resources"===r.op&&eO(r.source,e)&&eO(r.target,t)});if(n)return n.resources=n.resources.concat(r),o&&(n["repo:manifestPatch"]=JSON.stringify(o)),void 0!==s&&(n.intermediates=s),this;let a=eM("copy_resources",t,e,{createIntermediates:s},{resources:r,"repo:manifestPatch":JSON.stringify(o),additionalHeaders:i});return this._docs.push(a),this}copy(e,t,r,s,o){em("copy()"),this._assertUnderLimit(),this._checkSourceType(e),this._checkTargetType(t);let i=eM("copy",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(i),this}move(e,t,r,s,o){em("move()"),this._assertUnderLimit(),this._checkSourceType(e),this._checkTargetType(t);let i=eM("move",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(i),this}package(e,t,r,s,o){em("package()"),this._assertUnderLimit(),(e=E.isArray(e)?e:[e]).map(e=>{this._checkSourceType(e)}),this._checkTargetType(t);let i=eM("package",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(i),this}discard(e,t,r){em("discard()"),this._assertUnderLimit(),this._checkTargetType(e);let s=eM("discard",e,void 0,{recursive:t},r);return this._docs.push(s),this}restore(e,t){em("restore()"),this._assertUnderLimit(),es(e,["assetId","repo:assetId"],"string"),this._checkTargetType(e);let r=eM("restore",e,void 0,void 0,t);return this._docs.push(r),this}delete(e,t,r){em("delete()"),this._assertUnderLimit(),this._checkTargetType(e);let s=eM("delete",e,void 0,{recursive:t},r);return this._docs.push(s),this}_assertUnderLimit(){if(this._docs.length>=this.opBatchLimit)throw new y.default(y.default.INVALID_STATE,`Exceeds limit of ${this.opBatchLimit} operations in a single batch.`)}_checkTargetType(e){this._checkSourceOrTargetType(e,"Target")}_checkSourceType(e){this._checkSourceOrTargetType(e,"Source")}_checkSourceOrTargetType(e,t){if(0===[!!e.assetId||!!e["repo:assetId"],!!e.path||!!e["repo:path"]].filter(e=>e).length)throw new y.default(y.default.INVALID_PARAMS,`${t} identifier is underspecified. Exactly one of [href, repo:path, repo:assetId] required.`);let r=this._getSourceType(e),s="Source"===t?this._batchSourceType:this._batchTargetType;if(s){if(r!==s)throw new y.default(y.default.INVALID_PARAMS,`Operation ${t.toLowerCase()} types must all be the same type. Expected ${s}, encountered ${r}.`)}else"Source"===t?this._batchSourceType=r:this._batchTargetType=r}_getSourceType(e){return e.assetId||e["repo:assetId"]?"id":e.path||e["repo:path"]?e.baseAssetId||e["repo:baseAssetId"]?"pathAndBaseAssetId":"path":void 0}}function ew(){return new eR}function eO(e,r){var s,o;return e[t.Properties.REPO_ASSET_ID]===(null!=(s=r[t.Properties.REPO_ASSET_ID])?s:r.assetId)&&e[t.Properties.REPO_REPOSITORY_ID]===(null!=(o=r[t.Properties.REPO_REPOSITORY_ID])?o:r.repositoryId)}function ek(e,t){return t.response.asset=Object.assign(Object.assign({},t.response.asset||{}),{repositoryId:e.repositoryId||e["repo:repositoryId"]}),t}function eS(e){return{response:e,result:el(e.response.asset)}}function eN(e){return{response:e,result:{success:e.statusCode>199&&e.statusCode<400}}}function eL(e,r,s){if(eg("_convertToACPSource()"),"object"!=typeof r)return;let o={"repo:repositoryId":r.repositoryId||r["repo:repositoryId"],"repo:path":r.path||r["repo:path"],"repo:assetId":r.assetId||r["repo:assetId"],"repo:baseAssetId":r.baseAssetId||r["repo:baseAssetId"]};return"string"==typeof o.href?(delete o["repo:path"],delete o["repo:assetId"],delete o["repo:baseAssetId"]):"string"==typeof o["repo:assetId"]&&(delete o["repo:path"],delete o["repo:baseAssetId"]),"target"===e?!0===s?o[t.HeaderKeys.IF_MATCH]=r.format!==C.Directory&&r["dc:format"]!==C.Directory&&r.etag||"*":!1===s?o[t.HeaderKeys.IF_NONE_MATCH]="*":r.format!==C.Directory&&r["dc:format"]!==C.Directory&&(o[t.HeaderKeys.IF_MATCH]=r.etag):r.format!==C.Directory&&r["dc:format"]!==C.Directory&&(o[t.HeaderKeys.IF_MATCH]=r.etag||"*"),r.version&&(o["repo:version"]=r.version),o["repo:path"]&&er(o,"repo:repositoryId","string"),eg("_cTACPS() out",o),E.pruneUndefined(o)}function eM(e,t,r,s={},o={}){eg("_buildOperationDoc()");let i=E.pruneUndefined({op:e,target:t,source:E.isArray(r)?[]:r?{}:void 0}),{overwriteExisting:n,createIntermediates:a,recursive:l}=s;if(i.source&&(i.source=E.isArray(r)?r.map(e=>eL("source",e,n)).filter(e=>null!=e):eL("source",r,n)),"object"==typeof t){let e=eL("target",t,n);e&&(i.target=e)}return null==i.target["repo:assetId"]&&null!=a&&(i.intermediates=a),null!=l&&(i.recursive=l),Object.assign(i,o),eg("_OD() doc",i),i}function eX(e,t,r,s,o,i,n){E.validateParams(["resources",s,"array",!1]);let a=ew().copyResources(t,r,s,o,i).getDocument();return ef(e).then(t=>eP(q(e),t,a,n)).then(f._handleErrorResponsePayload).then(e=>{let{asset:t,source:r,target:s,resources:o}=e.response[0];return{result:{source:el(r),target:el(s),resources:o,asset:t?el(t):void 0},response:e}})}t.BlockTransferStates=void 0,(u=t.BlockTransferStates||(t.BlockTransferStates={})).NOT_INITIALIZED="NOT_INITIALIZED",u.INITIALIZING="INITIALIZING",u.INITIALIZED="INITIALIZED",u.WAITING="WAITING",u.STARTED="STARTED",u.PAUSING="PAUSING",u.PAUSED="PAUSED",u.CANCELED="CANCELED",u.ERROR="ERROR",u.FINALIZING="FINALIZING",u.COMPLETE="COMPLETE";let ex=new class{constructor(){this._uploads=[],this._downloads=[],this._pendingUploadRequests=[],this._pendingDownloadRequests=[],this._downloadChunkSize=0xa00000}get downloads(){return this._downloads}get uploads(){return this._uploads}set downloadChunkSize(e){E.validateParams(["downloadChunkSize",e,"+number"]),this._downloadChunkSize=e}get downloadChunkSize(){return this._downloadChunkSize}get pendingUploadRequests(){return this._pendingUploadRequests}get pendingDownloadRequests(){return this._pendingDownloadRequests}resetUploads(){this._uploads=[],this._pendingUploadRequests=[]}addAndStartUpload(e){return this._addAndStart("upload",e)}addAndStartDownload(e){return e.state!==t.BlockTransferStates.INITIALIZED?Promise.resolve(e):this._addAndStart("download",e)}startNextWaiting(e){let r="upload"===e?this._uploads:this._downloads,s=[],o=!1;for(let e of r)!o&&e&&e.state===t.BlockTransferStates.WAITING?(e.start(),o=!0):e.state!==t.BlockTransferStates.CANCELED&&e.state!==t.BlockTransferStates.ERROR&&e.state!==t.BlockTransferStates.FINALIZING&&e.state!==t.BlockTransferStates.COMPLETE||s.push(e);let i=r.filter(e=>!s.includes(e));"download"===e?this._downloads=i:this._uploads=i}_addAndStart(e,r){let s="upload"===e?this._uploads:this._downloads;return 0===s.filter(e=>e&&(e.state===t.BlockTransferStates.NOT_INITIALIZED||e.state===t.BlockTransferStates.INITIALIZED||e.state===t.BlockTransferStates.INITIALIZING||e.state===t.BlockTransferStates.STARTED)).length?r.start():r._setWaiting(),s.push(r),r.promise}},eB=g.newDebug("dcx:assets:blockdownload"),ej=g.newDebug("dcx:assets:blockdownload:leaf"),eU=function*(){let e=0;for(;;)yield e++}();class eH extends E.EventEmitter{constructor(e,r,s={}){super(["stateChanged"]),this._state=t.BlockTransferStates.NOT_INITIALIZED,this._cachedBlocks=new Map,this._blockRequestIndex=0,this._blockHandledIndex=0,this._currentByteRange=[void 0,void 0],this._pending=[],eB("constructor");let{startByte:o,blockSize:i,endByte:n,url:a,totalSize:l,maxConcurrentRequests:d}=Object.assign({blockSize:ex.downloadChunkSize,maxConcurrentRequests:4},E.pruneUndefined(s));E.validateParams(["svc",e,"object"],["responseType",r,"enum",!1,["buffer"]],["blockSize",i,"+number"],["url",a,"string",!0],["startByte",o,"number",!0],["endByte",n,"number",!0],["totalSize",l,"number",!0],["maxConcurrentRequests",d,"+number"]),this._dbgId=eU.next().value,this._maxConcurrentRequests=d,this._blockSize=Math.round(i),this._service=e,this._url=a,this._startByte=o,this._endByte=n,this._totalSize=l,this._bytes=new Uint8Array,this._promise=new D.default((e,t)=>{this._resolve=()=>{eB(this._dbgId,"resolving"),this.removeAllHandlers(),e(this)},this._reject=e=>{eB(this._dbgId,"rejecting: ",e),this.removeAllHandlers(),t(e)}})}get contentType(){var e;return null!=(e=this._contentType)?e:""}get totalSize(){return this._totalSize}get buffer(){return this._bytes}get state(){return this._state}get promise(){return this._promise}_requestBlock(e,r,s,o){eB(this._dbgId,"_requestBlock(): ",e,r,s,o);let i=eY(e,r);return this._service.invoke(t.HTTPMethods.GET,this._url,i,void 0,{responseType:"defaultbuffer",isStatusValid:K(),isExternalRequest:!0}).then(e=>({response:e,index:s,lane:o})).catch(this._handleErrorAndThrow.bind(this))}init(e=this._url,r=this._totalSize){if(eB(this._dbgId,"init(): ",e,r),this._state===t.BlockTransferStates.INITIALIZED&&e===this._url&&r===this._totalSize)return D.default.resolve(this);if(this._assertStateIsValid("init"),this._shiftState(t.BlockTransferStates.INITIALIZING),this._url=e,this._initByteRange(r),this._totalSize!==1/0||null==this._currentByteRange[0])return this._shiftState(t.BlockTransferStates.INITIALIZED),D.default.resolve(this);let{startByte:s,endByte:o,blockIndex:i}=this._nextBlockData(),n=t.BlockTransferStates.INITIALIZED;return this._requestBlock(s,o,i,0).then(e=>(this._updateTotalSize(e),(!o||o>this._endByte)&&(n=t.BlockTransferStates.FINALIZING),e)).then(this._handleBlock.bind(this)).then(()=>this._shiftState(n)).catch(this._handleErrorAndThrow.bind(this))}start(){if(eB(this._dbgId,"start()"),this._assertStateIsValid("start"),this._shiftState(t.BlockTransferStates.STARTED),null!=this._currentByteRange[0])return this._start(),this._promise;let[e,r]=this._currentByteRange,s=this._blockRequestIndex;return this._blockRequestIndex+=1,this._currentByteRange=[r+1,r],this._requestBlock(e,r,s,0).then(this._handleBlock.bind(this)).catch(this._handleError.bind(this)),this._promise}pause(){return eB(this._dbgId,"pause()"),this._assertStateIsValid("pause"),this._shiftState(t.BlockTransferStates.PAUSING),D.default.allSettled(this._pending).then(()=>(this._shiftState(t.BlockTransferStates.PAUSED),ex.startNextWaiting("download"),this))}resume(){return eB(this._dbgId,"resume()"),this.state===t.BlockTransferStates.PAUSED&&(this._shiftState(t.BlockTransferStates.STARTED),this._start()),this}cancel(){return eB(this._dbgId,"cancel()"),this._assertStateIsValid("cancel"),this._shiftState(t.BlockTransferStates.CANCELED),this._reject(new y.default(y.default.ABORTED,"BlockDownload aborted.")),ex.startNextWaiting("download"),this._promise}_setWaiting(){this._shiftState(t.BlockTransferStates.WAITING)}_start(){eB(this._dbgId,"_start()");for(let e=0;e<this._maxConcurrentRequests;e++)this._loop(e).catch(this._handleError.bind(this))}get _loopShouldContinue(){let e=this._state===t.BlockTransferStates.STARTED&&this._currentByteRange[0]<=this._endByte;return eB(this._dbgId,"_loopShouldContinue() ",e,this._currentByteRange,this._endByte),e}_loop(e){return N(this,void 0,void 0,function*(){eB(this._dbgId,"_loop(): ",e);let r=!1;for(;this._loopShouldContinue&&!r;){let{startByte:t,endByte:s,blockIndex:o,done:i}=this._nextBlockData();r=i;let n=this._requestBlock(t,s,o,e).then(this._handleBlock.bind(this)).catch(this._handleError.bind(this));this._pending[e]=n,yield n}eB(this._dbgId,`_loop(${e}) done, ${r}`),r&&(eB(this._dbgId,`_loop(${e}) finalize`),this._shiftState(t.BlockTransferStates.FINALIZING))})}_nextBlockData(){eB(this._dbgId,"_nextBlockData()");let e=this._blockRequestIndex;this._blockRequestIndex+=1;let[t,r]=this._currentByteRange;return this._currentByteRange[0]+=this._blockSize,this._currentByteRange[1]=Math.min(this._currentByteRange[1]+this._blockSize,this._endByte),{startByte:t,endByte:r,blockIndex:e,done:r>=this._endByte}}_initByteRange(e=this._totalSize){if(eB(this._dbgId,"_initByteRange(): ",e),this._totalSize=e,null!=this._totalSize&&this._totalSize<0)throw new y.default(y.default.INVALID_PARAMS,"Total size must be positive.");if(this._totalSize||(this._totalSize=1/0),this._endByte||(this._endByte=this._totalSize),!this._startByte&&this._endByte===this._totalSize)return this._startByte=0,void(this._currentByteRange=[0,this._blockSize-1]);if(!this._startByte&&this._endByte<0&&this._totalSize!==1/0?(this._startByte=Math.max(0,this._totalSize+this._endByte),this._endByte=this._totalSize):!this._startByte&&this._endByte>0&&(this._startByte=0),null!=this._startByte&&(this._currentByteRange[0]=Math.max(this._startByte,0)),(null==this._endByte||this._endByte>0)&&(this._currentByteRange[1]=Math.min(this._endByte,(this._startByte||0)+this._blockSize-1)),null!=this._startByte||this._endByte===1/0)return;if(this._totalSize===1/0){if(-this._endByte>this._blockSize)throw new y.default(y.default.INVALID_PARAMS,"Cannot download last N bytes without a total size.");return void(this._currentByteRange=[void 0,this._endByte])}this._startByte=Math.max(0,this._totalSize+this._endByte),this._endByte=this._totalSize;let t=Math.min(this._startByte+this._blockSize-1,this._endByte);this._currentByteRange=[this._startByte,t]}_finalize(){return eB(this._dbgId,"_finalize() start"),ex.startNextWaiting("download"),D.default.allSettled(this._pending).then(()=>{this._checkCachedBlocks(),this._shiftState(t.BlockTransferStates.COMPLETE)})}_updateTotalSize(e){if(eB(this._dbgId,"_updateTotalSize()"),null==this._totalSize||this._totalSize===1/0)try{let t=e.response.headers["content-range"],r=parseInt(t.split("/")[1]);E.assert(()=>!isNaN(r),"Invalid number."),this._totalSize=r,this._endByte===1/0&&(this._endByte=this._totalSize)}catch(t){throw new y.default(y.default.INVALID_DATA,"Could not determine total size.",t,e.response)}return eB(this._dbgId,"_uTS(): ",this._totalSize,this._endByte),e}_handleError(e){eB(this._dbgId,"_handleError(): ",e),this._shiftState(t.BlockTransferStates.ERROR),this._error=e,f.isAdobeDCXError(e)||(this._error=new y.default(y.default.UNEXPECTED,"An unexpected error occurred.",e)),this._reject(this._error)}_handleErrorAndThrow(e){throw this._handleError(e),this._error}_handleBlock(e){this._endByte===1/0&&this._updateTotalSize(e);let{index:t,response:r}=e;if(eB(this._dbgId,`_handleBlock(${t})`),t!==this._blockHandledIndex)return eB(this._dbgId,`_handleBlock(${t}) cached`),void this._cachedBlocks.set(t,e);eB(this._dbgId,`_handleBlock(${t}) handled`),this._pushBlockData(r),this._markCurrentBlockHandled()}_markCurrentBlockHandled(){this._cachedBlocks.delete(this._blockHandledIndex),this._blockHandledIndex+=1,this._checkCachedBlocks()}_checkCachedBlocks(){let e=this._cachedBlocks.get(this._blockHandledIndex);e&&this._handleBlock(e)}_pushBlockData(e){if(this._state===t.BlockTransferStates.ERROR)return;this._contentType=this._contentType||e.headers[t.HeaderKeys.CONTENT_TYPE];let r="undefined"!=typeof Buffer&&e.response instanceof Buffer?e.response:new Uint8Array(e.response);this._bytes=E.concatUint8Arrays(this._bytes,r)}_shiftState(e){return eB(this._dbgId,"_shiftState(): ",e),this._state===t.BlockTransferStates.COMPLETE||this._state===t.BlockTransferStates.ERROR||this._state===t.BlockTransferStates.CANCELED||(this._state=e,this.emit("stateChanged",[this._state,this]),e===t.BlockTransferStates.FINALIZING&&this._finalize(),e===t.BlockTransferStates.COMPLETE&&Promise.all(this._pending).then(this._resolve.bind(this))),this}_assertStateIsValid(e,r=this._state){eB(this._dbgId,"_assertStateIsValid() ",e,r);let s=!1,o="Invalid state transition.";switch(e){case"init":r===t.BlockTransferStates.NOT_INITIALIZED&&(s=!0);break;case"start":r!==t.BlockTransferStates.INITIALIZED&&r!==t.BlockTransferStates.WAITING&&r!==t.BlockTransferStates.STARTED||(s=!0);break;case"pause":r!==t.BlockTransferStates.INITIALIZING&&r!==t.BlockTransferStates.STARTED||(s=!0);break;case"cancel":s=!0}if(!s)throw eB(this._dbgId,"_aSIV() throw ",o),new y.default(y.default.INVALID_STATE,o,void 0,void 0,{method:e,currentState:r})}}function eV(e,t,r){return new eH(e,t,r)}function eF(e,r,s,o,i="defaultbuffer",n,a,l){ej("_doBlockDownload()");let d="stream"===i?void 0:eV(e,"buffer",{startByte:s,endByte:o});(null!=this?this:{}).blockDownload=d;let h=D.default.resolve(r,void 0!==this?this:{});return n||(h=h.then(()=>e.invoke(t.HTTPMethods.GET,r,Object.assign({priority:"u=1"},l),void 0,{responseType:"text",isStatusValid:K(),retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:"GET"}})).then(e=>{let t=e.response.indexOf("href")>0?E.getFirstRegexpCapture(e.response,'"href":\\s*"([^;"]*)"'):"";if("string"!=typeof t||""===t)throw new y.default(y.default.UNEXPECTED_RESPONSE,"No block download href found in response.",void 0,e);return a=a||parseInt(E.getFirstRegexpCapture(e.response,'"size":\\s*(\\d+)')),t})),h.then(r=>N(this,void 0,void 0,function*(){return d?Promise.race([d.init(r,a).then(()=>ex.addAndStartDownload(d)),d.promise]).then(()=>({statusCode:200,headers:E.pruneUndefined({[t.HeaderKeys.CONTENT_TYPE]:d.contentType,[t.HeaderKeys.CONTENT_LENGTH]:d.totalSize}),responseType:i,response:function(e,t,r){if("defaultbuffer"===t||"buffer"===t||"arraybuffer"===t)return e.buffer;if("blob"===t)return new Blob([e],{type:r});let s=E.arrayBufferToString(e);if("text"===t)return s;try{return JSON.parse(s)}catch(e){return s}}(d.buffer,i,d.contentType),message:"OK"})):e.invoke(t.HTTPMethods.GET,r,eY(s,o),void 0,{responseType:"stream",isExternalRequest:!0})}))}function eY(e,t){return null==e&&null==t?{}:{range:`bytes=${null!=e?e:null!=t&&t>0?"0":""}-${null!=t?Math.abs(t):""}`}}let eW=g.newDebug("dcx:assets:private");function eq(e,r,s,o,i="defaultbuffer",n,a,l={},d=!1){let h;eW("_getUrlFallbackDirect()");let c=void 0!==this?this:{};return D.default.resolve(void 0,c).then(()=>e.invoke(t.HTTPMethods.GET,s,Object.assign({priority:"u=1"},l),void 0,{responseType:i,isStatusValid:K([400])})).then(e=>(eW("_gUFD() status code",e.statusCode),h=e,400===e.statusCode&&e.xhr?e.xhr.getResponseDataAsJSON():e)).then(e=>{let t=E.isObject(e)&&(400===h.statusCode||400===e.status)&&e.type===f.ProblemTypes.RESPONSE_TOO_LARGE;if(eW("_gUFD() do direct",t),!t&&400===h.statusCode)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Unexpected response",void 0,h);return t}).then(s=>{if(!s)return h;if(!("location"in h.headers)||"string"!=typeof h.headers.location){if(!Q(r.links,[I.BLOCK_DOWNLOAD]))throw new f.DCXError(f.DCXError.INVALID_DATA,"Resource too large and missing download link.");let s=E.pruneUndefined({reltype:o,component_id:n,revision:a}),u=E.getLinkHrefTemplated(r.links,I.BLOCK_DOWNLOAD,{resource:o?JSON.stringify(s):void 0});return d?{statusCode:200,headers:E.pruneUndefined({[t.HeaderKeys.CONTENT_TYPE]:h.headers["content-type"],[t.HeaderKeys.CONTENT_LENGTH]:h.headers["content-length"]}),responseType:i,response:{href:u},message:"OK"}:eF.call(c,e,u,void 0,void 0,i,!1,void 0,l)}return d?{statusCode:200,headers:E.pruneUndefined({[t.HeaderKeys.CONTENT_TYPE]:h.headers["content-type"],[t.HeaderKeys.CONTENT_LENGTH]:h.headers["content-length"]}),responseType:i,response:{href:h.headers.location},message:"OK"}:eF.call(c,e,h.headers.location,void 0,void 0,i,!0,void 0,l)})}let ez=g.newDebug("dcx:assets:bulk");function eG(e,r){let s=Uint8Array.from([]);for(let o=0;o<e.length;o++){let i=e[o];s=0===o?E.concatUint8Arrays(s,E.stringToBuffer(`--${r}\r
`)):E.concatUint8Arrays(s,E.stringToBuffer(`\r
--${r}\r
`)),s=E.concatUint8Arrays(s,E.stringToBuffer(`${[t.HeaderKeys.CONTENT_TYPE]}: application/http\r
`)),s=E.concatUint8Arrays(s,E.stringToBuffer(`\r
${i.method} ${i.href}`));let n=!1;for(let e in i.headers){let t=e.toLowerCase();"content-length"===t&&(n=!0),s=E.concatUint8Arrays(s,E.stringToBuffer(`\r
${t}: ${i.headers[e]}`))}if(i.body){let e=eK(i.body);n||(s=E.concatUint8Arrays(s,E.stringToBuffer(`\r
content-length: ${e.length}`))),s=E.concatUint8Arrays(s,E.stringToBuffer(`\r
\r
`)),s=E.concatUint8Arrays(s,e)}}return E.concatUint8Arrays(s,E.stringToBuffer(`\r
--${r}--\r
`))}function eK(e){if("string"==typeof e)return E.stringToBuffer(e);if(E.isArrayBuffer(e))return new Uint8Array(e);if(B(e))return e;throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"Bulk subrequest body expecting string | ArrayBuffer | Buffer")}function e$(e,r){let s=e.headers[t.HeaderKeys.CONTENT_TYPE];if(!s)throw new f.AdobeDCXError(f.AdobeDCXError.UNEXPECTED_RESPONSE,"Missing boundary header in multipart response");let o=s.split("=")[1],i=function(e,t){let r=new Uint8Array(e),s=E.stringToBuffer(`--${t}`);return eZ(r,eJ(r,s),s.byteLength).map(e=>eQ(e,!0))}(e.response,o);if(r&&i.length!==r)throw new f.AdobeDCXError(f.AdobeDCXError.UNEXPECTED_RESPONSE,`Unexpected number of parts; Expected ${r}, Received ${i.length}`);return i}function eJ(e,t){let r=Array(256).fill(-1),s=[];for(let e=0;e<t.length;e++)r[t[e]]=e;let o=0;for(;o<=e.length-t.length;){let i=t.length-1;for(;i>=0&&t[i]===e[o+i];)i--;i<0?(s.push(o),o+=o+t.length<e.length?t.length-r[e[o+t.length]]:1):o+=Math.max(1,i-r[e[o+i]])}return s}function eZ(e,t,r,s=!1){let o=s?0:void 0,i=[];for(let s of t)void 0!==o&&i.push(e.subarray(o,s)),o=s+r;return s&&i.push(e.subarray(o)),i}function eQ(e,r=!1){let s,o=E.stringToBuffer("\r\n\r\n"),i=eJ(e,o).slice(0,2),n=E.stringToBuffer("\n\n"),a=eZ(e,...i.length>0?[i,o.byteLength]:[eJ(e,n).slice(0,2),n.byteLength],!0),l=a.slice(0,r||a.length>1?2:1).reduce((e,t)=>Object.assign(e,E.parseHeaders(E.arrayBufferToString(t))),{}),d=a.length>1?a[a.length-1]:void 0,h=parseInt(E.arrayBufferToString(a[+!!r]).split("\r\n",1)[0].split(" ")[1]),c=parseInt(l["content-length"],10);return s=isNaN(c)?0===(null==d?void 0:d.length)?new Uint8Array([]):d:0===c?new Uint8Array([]):null==d?void 0:d.subarray(0,c),{headers:l,response:l[t.HeaderKeys.CONTENT_TYPE]===P&&void 0!==s?JSON.parse(E.arrayBufferToString(s)):s,statusCode:h}}function e0(e){if(e.length>10)throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"A single bulk request can only contain a maximum of 10 sub-requests.");let{writeOperations:r,readOperations:s}=e.reduce((e,r)=>{if("string"!=typeof r.href)throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation is missing an href");if("string"!=typeof r.method)throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation is missing the HTTP method");let s=r.method.toUpperCase();if(!Object.values(t.HTTPMethods).includes(s))throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation includes an invalid HTTP method");return[t.HTTPMethods.GET,t.HTTPMethods.HEAD].includes(s)?e.readOperations.push(r):e.writeOperations.push(r),e},{readOperations:[],writeOperations:[]});if(r.length>0&&s.length>0)throw new f.AdobeDCXError(f.AdobeDCXError.INVALID_PARAMS,"Cannot mix READ and WRITE operations in bulk sub requests.")}function e1(e,r,s,o="id",i={},n=!1){return ez("performBulkRequest()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["requests",s,"array"],["linkMode",o,"string",!0,["id","path"]]),$(r.links,[I.BULK_REQUEST]),e0(s),e2(e,r,s,o,i).then(({response:a,subresponses:l})=>N(this,void 0,void 0,function*(){let d=e4(l,s);return{result:n?yield function e(r,s,o,i="id",n={},a,l=5){return N(this,void 0,void 0,function*(){if(0===o.length||l<=0)return a;if(1===o.length){let[e]=o,s=yield q(r).invoke(e.method,e.href,e.headers,e.body,{isStatusValid:K(),responseType:"defaultbuffer",retryOptions:{pollHeader:"location",pollCodes:[202],pollMethod:t.HTTPMethods.GET}});return s.headers["content-id"]=e.href,a.map(e=>"content-id"in e.headers&&e.headers["content-id"]===s.headers["content-id"]?s:e)}let d=yield e2(r,s,o,i,n).then(t=>N(this,void 0,void 0,function*(){let a=e4(t.subresponses,o);return a.length?yield e(r,s,a,i,n,t.subresponses,l-1):t.subresponses}));return a.map(e=>d.find(t=>t.headers["content-id"]===e.headers["content-id"])||e)})}(e,r,d,o,i,l):l,response:a}}))}function e2(e,r,s,o="id",i={}){let n=`boundary-${Date.now()}`,a=eG(s,n),l=Object.assign(Object.assign({},i),{[t.HeaderKeys.CONTENT_TYPE]:`multipart/mixed;boundary=${n}`}),d=E.getLinkHref(r.links,I.BULK_REQUEST,o);return e.invoke(t.HTTPMethods.POST,d,l,a,{isStatusValid:K(),responseType:"defaultbuffer",retryOptions:{pollHeader:"location",pollCodes:[202],pollMethod:t.HTTPMethods.GET}}).then(e=>({response:e,subresponses:e$(e,s.length)}))}function e4(e,t){return e.filter(({statusCode:e})=>E.checkRetriable(e)).map(e=>t.find(({href:t})=>t===e.headers["content-id"])).filter(e=>e)}let e5=g.newDebug("dcx:assets:asset"),e3=g.newDebug("dcx:assets:asset:leaf");class e6{constructor(e,t,r={}){this.type=C.Asset,this._data={},this._data=el(e),this._svc=q(t),this._cache=z(t),this._links=E.merge({},e.links||{},e._links||{},r)}setLinks(e){this._links=e,this._updateCachedLinks()}get links(){return this._links}set links(e){this.setLinks(e)}setLink(e,t){this._links[e]=t,this._updateCachedLinks()}getLink(e){return this._links[e]}removeLink(e){delete this._links[e],this._updateCachedLinks()}_updateCachedLinks(){this._cache&&this._cache.setValueWithAsset(this.links,this.asset)}getLinkProperty(e,t,r="id"){return e5("getLinkProperty()"),E.getLinkProperty({_links:this._links},e,t,r)}getLinkHrefTemplated(e,t,r="id"){return e5("getLinkHrefTemplated()"),E.getLinkHrefTemplated({_links:this._links},e,t,r)}getLinkHref(e,t="id"){return e5("getLinkHref()"),E.getLinkHref({_links:this._links},e,t)}get asset(){return Object.assign(Object.assign({},this._data),this.links)}get serviceConfig(){return{service:this._svc,cache:this._cache}}get repositoryId(){return this._data.repositoryId}set repositoryId(e){this._data.repositoryId=e}get assetId(){return this._data.assetId}set assetId(e){this._data.assetId=e}get path(){return this._data.path}set path(e){this._data.path=e}get name(){return this._data.name}get etag(){return this._data.etag}set etag(e){this._data.etag=e}get version(){return this._data.version}set version(e){this._data.version=e}get format(){return this._data.format}set format(e){this._data.format=e}get assetClass(){return this._data.assetClass}get createDate(){return this._data.createDate}get modifyDate(){return this._data.modifyDate}get discardDate(){return this._data.discardDate}get createdBy(){return this._data.createdBy}get modifiedBy(){return this._data.modifiedBy}get discardedBy(){return this._data.discardedBy}get deviceCreateDate(){return this._data.deviceCreateDate}get deviceModifyDate(){return this._data.deviceModifyDate}get baseAssetId(){return this._data.baseAssetId}set baseAssetId(e){this._data.baseAssetId=e}get state(){return this._data.state}get size(){return this._data.size}set size(e){this._data.size=e}get md5(){return this._data.md5}set defaultScheduledDeletionDuration(e){this._data.defaultScheduledDeletionDuration=e}get defaultScheduledDeletionDuration(){return this._data.defaultScheduledDeletionDuration}set scheduledDeletionDate(e){this._data.scheduledDeletionDate=e}get scheduledDeletionDate(){return this._data.scheduledDeletionDate}get representations(){return this._data.representations}set width(e){this._data.width=e}get width(){return this._data.width}set length(e){this._data.length=e}get length(){return this._data.length}fetchLinksIfMissing(e=[],t){return e5("fetchLinksIfMissing()"),tE(this.serviceConfig,this,e,void 0,t).then(({result:e,response:t})=>(this._updateDataWithResponse(t),this))}useLinkOrResolveResource(e,t){return e5("useLinkOrResolveResource()"),tf(this.serviceConfig,this,e,t).then(e=>(this._updateDataWithResponse(e.response),this.setLinks(E.merge(this.links,e.result.links)),e))}headPrimaryResource(e){return e5("headPrimaryResource()"),this.fetchLinksIfMissing([I.PRIMARY],e).then(()=>e9(this.serviceConfig,this,e)).then(e=>(this._updateDataWithResponse(e),e))}getRepresentation(e){return this._data.representations?this._data.representations[e]:void 0}getRepoMetadata(){return e5("getRepoMetadata()"),this.useLinkOrResolveResource(I.REPO_METADATA,"json").then(e=>{this._data=E.merge(this._data,e.result,el(e.response.response));let t=e.response.response;return t&&t._links&&this.setLinks(E.merge(this.links,t._links)),{result:this._data,response:e.response}})}headAppMetadata(e){return e5("headAppMetadata()"),this.fetchLinksIfMissing([I.APP_METADATA],e).then(()=>tn(this.serviceConfig,this))}getAppMetadata(e,t){return e5("getAppMetadata()"),E.validateParams(["etag",e,"string",!0]),this.fetchLinksIfMissing([I.APP_METADATA],t).then(()=>ta(this._svc,this,e,t))}putAppMetadata(e,t,r){return e5("putAppMetadata()"),E.validateParams(["etag",t,"string",!0],["metadata",e,["object","string"]]),this.fetchLinksIfMissing([I.APP_METADATA],r).then(()=>tl(this._svc,this,e,t,r))}patchAppMetadata(e,t,r){return e5("patchAppMetadata()"),E.validateParams(["patchDoc",e,["string","object[]"]],["etag",t,"string"]),this.fetchLinksIfMissing([I.APP_METADATA],r).then(()=>td(this._svc,this,e,t,r))}getBaseDirectoryMetadata(){return e5("getBaseDirectoryMetadata()"),to(this._svc)}getLinks(e){return e5("getLinks()"),E.isObject(this.links)&&Object.keys(this.links).length>0?D.default.resolve(this.links):ts(this._svc,this,e).then(e=>(this.setLinks(e),e))}getRepositoryResource(e){return e5("getRepositoryResource()"),this.fetchLinksIfMissing([I.REPOSITORY],e).then(()=>ti(this._svc,this,e)).then(e=>(this.repositoryId=e.result["repo:repositoryId"],e))}getEffectivePrivileges(e){return e5("getEffectivePrivileges()"),this.fetchLinksIfMissing([I.EFFECTIVE_PRIVILAGES],e).then(()=>th(this._svc,this))}performBulkRequest(e,t,r){return e5("performBulkRequest()"),E.validateParams(["requests",e,"array"],["linkMode",t,"string",!0,["id","path"]]),this.fetchLinksIfMissing([I.BULK_REQUEST],r).then(()=>e1(this._svc,this,e,t,r))}getACLPolicy(e){return e5("getACLPolicy()"),this.fetchLinksIfMissing([I.ACL_POLICY],e).then(()=>tc(this._svc,this))}checkACLPrivilege(e,t,r){return e5("checkACLPrivilege()"),E.validateParams(["privilege",e,"string"],["relation",t,"string"]),this.fetchLinksIfMissing([I.ACCESS_CHECK],r).then(()=>tu(this._svc,this,e,t))}patchACLPolicy(e,t,r){return e5("patchACLPolicy()"),E.validateParams(["policy",e,["string","object"]]),this.fetchLinksIfMissing([I.ACL_POLICY],r).then(()=>tp(this._svc,this,e,t))}deleteACLPolicy(e){return e5("deleteACLPolicy()"),this.fetchLinksIfMissing([I.ACL_POLICY],e).then(()=>t_(this._svc,this))}getPrimaryResource(e,t){e5("getPrimaryResource()"),E.validateParams(["responseType",e,"string"]);let r={};return this._withSourcePromise(r).then(()=>this.fetchLinksIfMissing([I.PRIMARY],t)).then(()=>e8.call(r,this._svc,this,e,t))}copy(e,t,r,s,o){return e5("copy()"),E.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"],["manifestPatch",o,["object","string"],!0]),eE(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r,s,o).then(({response:e,result:t})=>({response:e,result:new e6(t,this.serviceConfig)}))}copyResources(e,t,r,s,o){return e5("copyResources()"),E.validateParams(["targetAsset",e,"object"],["resources",t,"array"],["manifestPatch",s,["object","string"],!0],["intermediates",r,"boolean",!0]),eX(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path,version:this.version},e,t,r,s,o)}move(e,t,r,s){return e5("move()"),E.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"]),ey(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r,s).then(({response:e,result:t})=>(this._data=Object.assign(Object.assign({},this._data),E.pruneUndefined(t)),{response:e,result:this}))}delete(e,t=!1,r){return e5("delete()"),E.validateParams(["etag",e,"string",!0],["recursive",t,"boolean"]),eC(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r).then(e=>(this._data.state="DELETED",e))}discard(e,t=!1,r){return e5("discard()"),E.validateParams(["etag",e,"string",!0],["recursive",t,"boolean"]),eD(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r).then(e=>(this._data.state="DISCARDED",e))}package(e,t,r,s){return e5("package()"),E.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"]),ev(this._svc,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r,s)}restore(e){return e5("restore()"),eI(this._svc,{repositoryId:this.repositoryId,assetId:this.assetId},e).then(({response:e,result:t})=>(this._data=Object.assign(Object.assign(Object.assign({},this._data),E.pruneUndefined(t)),{state:"ACTIVE"}),{response:e,result:this}))}_updateDataWithResponse(e){return e&&(this._data.etag=e.headers.etag||this._data.etag,this._data.version=e.headers.version||this._data.version,this._data.assetId=e.headers["asset-id"]||this._data.assetId,this._data.md5=e.headers["content-md5"]||this._data.md5,this._data.repositoryId=e.headers["repository-id"]||this._data.repositoryId),e}_withSourcePromise(e){return D.default.resolve(void 0,e)}}function e8(e,t,r,s){e5("getPrimaryResource()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["responseType",r,"enum",!0,k]),$(t.links,[I.PRIMARY]);let o=E.getLinkHref(t.links,I.PRIMARY);return eq.call({},e,t,o,I.PRIMARY,r,void 0,void 0,s)}function e9(e,r,s){e5("headPrimaryResource()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.PRIMARY]);let o=E.getLinkHref(r.links,I.PRIMARY);return q(e).invoke(t.HTTPMethods.HEAD,o,s,void 0,{isStatusValid:K()}).then(t=>{let s=ep(t);r.links=E.merge(r.links||{},s);let o=z(e);return o&&o.setValueWithAsset(r.links||{},r),t})}function e7(e,t,r="id",s,o){e3("getResolveLinkForAsset()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["mode",r,"enum",!1,["id","path"]],["resource",s,["string","object"],!0]),et(t);let i={repositoryId:t.repositoryId,id:t.assetId,path:t.path,mode:r,resource:E.isObject(s)?JSON.stringify(s):s},n=q(e),a=G(t.assetId?"/content/directory/resolve{?repositoryId,id,resource,mode}":"/content/directory/resolve{?repositoryId,path,resource,mode}",n);return D.default.resolve(E.expandURITemplate(a,E.pruneUndefined(i)))}function te(e,t,r="id",s,o,i){e3("resolveAsset()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["mode",r,"enum",!0,["id","path"]],["resource",s,["string","object"],!0]),et(t);let n=q(e),a=z(e),l=a&&t.assetId&&t.repositoryId&&"id"===r;return l&&(e3("rA() set pending"),a.setPending(t.assetId,t.repositoryId)),e7(e,t,r,s).then(e=>null==s?ei(n,e,i):en(n,e,i,o)).then(e=>({response:e,result:ty(t,e,"id"===r,a)})).catch(e=>{throw l&&a.deleteWithAsset(t),e})}function tt(e,t,r){return e3("fetchLinksForAsset()"),tr(e,t,r).then(e=>e.result.links)}function tr(e,r,s){let o;if(e3("fetchAsset()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),H(r))return te(e,r,"id",void 0,void 0,s).then(e=>e);try{o=J(r.links,[I.ID,I.REPO_METADATA,I.PRIMARY,I.PATH])}catch(e){throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Asset is not resolvable. Must contain repositoryId & path, assetId, or links.",e)}let i=E.getLinkHref(r.links,o),n=q(e),a=z(e);return n.invoke(t.HTTPMethods.HEAD,i,s,void 0,{isStatusValid:K()}).then(e=>({result:ty(r,e,o===I.ID,a),response:e}))}function ts(e,r,s){e3("getLinksForAsset()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]);let o=r.links||r[t.Properties.LINKS];if(E.isObject(o)&&0!==Object.keys(o).length)return D.default.resolve(o);let i=z(e);if(i){let e=i.getValueWithAsset(r);if(e)return D.default.resolve(e)}return tt(e,r,s)}function to(e,t){throw e3("getBaseDirectoryMetadata()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}function ti(e,r,s){e3("getRepositoryResource()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.REPOSITORY]);let o=E.getLinkHref(r.links,I.REPOSITORY);return e.invoke(t.HTTPMethods.GET,o,s,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function tn(e,r,s){e5("headAppMetadata()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.APP_METADATA]);let o=E.getLinkHref(r.links,I.APP_METADATA);return q(e).invoke(t.HTTPMethods.HEAD,o,s,void 0,{isStatusValid:K()}).then(t=>{let s=ep(t);r.links=E.merge(r.links||{},s);let o=z(e);return o&&o.setValueWithAsset(r.links,r),t})}function ta(e,r,s,o={}){e3("getAppMetadata()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["etag",s,"string",!0]);let i=E.getLinkHref(r.links,I.APP_METADATA),n=Object.assign({},o);return s&&(n[t.HeaderKeys.IF_NONE_MATCH]=s),e.invoke(t.HTTPMethods.GET,i,n,void 0,{responseType:"json",isStatusValid:K([304])}).then(e=>{let t=e.response,r=e.headers.etag;return 304===e.statusCode&&(t=null,r=s),{result:t,response:e,etag:r}})}function tl(e,r,s,o,i={}){e3("putAppMetadata()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["metadata",s,["object","string"]],["etag",o,"string",!0]),$(r.links,[I.APP_METADATA]);let n=E.getLinkHref(r.links,I.APP_METADATA);return e.invoke(t.HTTPMethods.PUT,n,E.pruneUndefined(Object.assign(i,{[t.HeaderKeys.IF_MATCH]:o,[t.HeaderKeys.CONTENT_TYPE]:T})),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K()}).then(e=>({response:e,result:{etag:e.headers.etag}}))}function td(e,r,s,o,i={}){e3("patchAppMetadata()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["metadata",s,["object[]","string"]],["etag",o,"string"]),$(r.links,[I.APP_METADATA]);let n=E.getLinkHref(r.links,I.APP_METADATA);return e.invoke(t.HTTPMethods.PATCH,n,E.pruneUndefined(Object.assign(i,{[t.HeaderKeys.IF_MATCH]:o,[t.HeaderKeys.CONTENT_TYPE]:R})),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K()}).then(e=>({response:e,result:{etag:e.headers.etag}}))}function th(e,r,s){e3("getEffectivePrivileges()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.EFFECTIVE_PRIVILAGES]);let o=E.getLinkHref(r.links,I.EFFECTIVE_PRIVILAGES);return e.invoke(t.HTTPMethods.GET,o,s,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function tc(e,r,s){e3("getACLPolicy()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.ACL_POLICY]);let o=E.getLinkHref(r.links,I.ACL_POLICY);return e.invoke(t.HTTPMethods.GET,o,s,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function tu(e,r,s,o,i={}){e3("checkACLPrivilege()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["privilege",s,"string",!1,["ack","read","write","delete"]]),$(r.links,[I.ACCESS_CHECK]);let n=E.getLinkHrefTemplated(r.links,I.ACCESS_CHECK,{privilege:s.toString(),relation:o});return e.invoke(t.HTTPMethods.GET,n,Object.assign({directive:"acl-check-no-body"},i),void 0,{responseType:"json",isStatusValid:K([403])}).then(e=>({result:403!==e.statusCode,response:e}))}function tp(e,r,s,o,i={}){e3("patchACLPolicy()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["policy",s,["string","object"]],["etag",o,"string",!0]),$(r.links,[I.ACL_POLICY]);let n=E.pruneUndefined(Object.assign(i,{[t.HeaderKeys.CONTENT_TYPE]:R,[t.HeaderKeys.IF_MATCH]:o})),a=E.getLinkHref(r.links,I.ACL_POLICY);return q(e).invoke(t.HTTPMethods.PATCH,a,n,"string"==typeof s?s:JSON.stringify(s),{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function t_(e,r,s={}){e3("deleteACLPolicy()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.ACL_POLICY]);let o=E.getLinkHref(r.links,I.ACL_POLICY);return q(e).invoke(t.HTTPMethods.DELETE,o,s,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function tf(e,r,s,o,i){let n;e3("useLinkOrResolveResource()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["resource",s,"string"]);let a=q(e);try{n=E.getLinkHref(r.links,s)}catch(e){}return D.default.resolve(n).then(t=>"string"==typeof t?(e3("uLORR() asset has link"),t):tA(r,z(e),[s])).then(e=>{if("string"==typeof e)return e;try{return E.getLinkHref(e,s)}catch(e){return}}).then(n=>{if("string"==typeof n)return e3("uLORR() cache or asset had link"),a.invoke(t.HTTPMethods.GET,n,i,void 0,{isStatusValid:K(),responseType:o});if(!H(r))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Asset is not resolvable. Must contain repository ID + path/id or links.");return te(e,r,"id",s,o,i)}).then(e=>x(e)?e:{result:r,response:e})}function tg(e,t,r=[],s=!1,o){return tE(e,t,r,s,o).then(({result:e})=>e)}let tm=new Set([I.BASE_DIRECTORY,I.RESOLVE_BY_ID,I.RESOLVE_BY_PATH,I.REPO_OPS,I.REPOSITORY,I.DIRECTORY,I.DISCARD,I.RESTORE,I.PATH,I.ANNOTATIONS]);function tE(e,r,s=[],o=!1,i){return(e3("fetchLinksIfMissing()",s),E.validateParams(["svc",e,"object"],["asset",r,"object"],["linksToPopulate",s,"string[]"],["suppressMissingErrors",o,"boolean",!0]),Q(r.links,s))?(e3("fLIM() links exist"),D.default.resolve({result:r.links})):tA(r,z(e),s,!0).then(o=>o||("string"==typeof r.assetId&&r.assetId.length>0&&s.every(e=>!tm.has(e))?function(e,r,s){let o=function(e,t){e3("getLinksAPIUrlForAsset()"),E.validateParams(["svc",e,"object"],["asset",t,"object"]);let r=G("/links{?assetId,repositoryId,clientRegion}",q(e)),{assetId:s,repositoryId:o,contentRegion:i}=t,n=E.pruneUndefined({assetId:s,repositoryId:o,contentRegion:i});return E.expandURITemplate(r,n)}(e,r);return q(e).invoke(t.HTTPMethods.GET,o,s,void 0,{responseType:"json"}).then(t=>{let s=z(e);return r.links=Object.assign({},r.links,t.response._links),null==s||s.setValueWithAsset(r.links,r),{response:t,result:r}})}(e,r,i):(e3("fLIM() fetching links"),tr(e,r,i)))).then(t=>{let i,n,a=t;if(x(t)&&(i=t.response,a=t.result.links,n=t.result),r.links!==a){r.links=E.merge(r.links||{},a);let t=z(e);t&&t.setValueWithAsset(r.links,r)}if(!o&&!Q(a,s))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Required links could not be fetched for asset.",void 0,i,E.pruneUndefined({required:s,asset:n}));return e3("fLIM() fetchedOCached exists"),{result:a||r.links,response:i}})}function tA(e,t,r,s){if(e3("getLinksFromCache()"),!t)return D.default.resolve(void 0);let o=t.getValueWithAsset(e);return null==o?(s&&t.setPending(e.assetId,e.repositoryId),D.default.resolve(void 0)):D.default.resolve(o).then(o=>r?Q(o,r)?o:void(s&&t.setPending(e.assetId,e.repositoryId)):o)}function ty(e,r,s,o){let i=ep(r),n=Object.assign(Object.assign(Object.assign({},E.isObject(e.asset)?e.asset:e),E.pruneUndefined({assetId:r.headers["asset-id"]||r.headers["x-resource-id"],format:r.headers[t.HeaderKeys.CONTENT_TYPE],md5:r.headers["content-md5"],etag:r.headers.etag,version:r.headers.version,repositoryId:r.headers["repository-id"]})),{links:i});return s&&i&&Object.keys(i).length>0&&o&&o.setValueWithAsset(i,n),n}let tD=g.newDebug("dcx:assets:block_transfer"),tC=0x3200000;function tI(e,r){let s=tv(e,t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE);if(s&&r<s)return!1;let o=tb(e);return!!(o&&r>o)||r>0xa00000}function tv(e,t){if(!Q(e.links,[I.BLOCK_UPLOAD_INIT]))return;let r=E.getLinkProperty(e.links,I.BLOCK_UPLOAD_INIT,t);return r?parseInt(r):void 0}function tb(e){return tv(e,t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE)}let tT=e=>"string"==typeof e?e.length>=2621440?E.stringToBuffer(e).byteLength:e.length:"size"in e?e.size:e.byteLength,tP=(e,t)=>{if(!E.isAnyFunction(e))return e;if(e.length<2)throw new f.DCXError(f.DCXError.INVALID_PARAMS,"GetSliceCallback is expected to accept 2 parameters");if(void 0===t||isNaN(t)||t<0)throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Size parameter should indicate total number of bytes to be read from GetSliceCallback");return{getSlice:e,size:t}},tR=()=>tC;function tw(e,t,r,s){let o=E.parseHeaders(s);return{id:t,length:r,type:e,links:e_(o.link),etag:o.etag,location:o.location,version:o.version,revision:o.revision,md5:o["content-md5"]}}function tO(e){return new Promise(t=>{let r;e.finally(()=>{clearTimeout(r),t(void 0)}),function s(){["blockUpload","blockDownload"].forEach(o=>{if(E.isObject(e[o]))return clearTimeout(r),t(e[o]);clearTimeout(r),r=setTimeout(s,1)})}()})}let tk=g.newDebug("dcx:assets:blockupload"),tS=g.newDebug("dcx:assets:blockupload:leaf");class tN extends E.EventEmitter{constructor(e,r,s,o,i,n,a,l,d,h,c,u,p,_){super(["stateChanged"]),this._internalBlockUploadId=E.generateUuid(),this._state=t.BlockTransferStates.NOT_INITIALIZED,this._currentBlockIndex=0,this._pendingBlockRequests=[],this._bytesUploaded=0,this._totalBlocksUploaded=0,this._indeterminateTransfer=!1,this._maxConcurrentRequests=4,this._service=e,this._getSliceCallback=r,Y(s)?(E.validateParams([t.BlockTransferProperties.REPO_SIZE,s[t.BlockTransferProperties.REPO_SIZE],"number"]),this._blockTransferDocument=s,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][I.BLOCK_TRANSFER],this._dataSize=this._blockTransferDocument[t.BlockTransferProperties.REPO_SIZE],this._relationType=this._blockTransferDocument[t.BlockTransferProperties.REPO_REL_TYPE],this._shiftState(t.BlockTransferStates.INITIALIZED),tk(`BlockUpload Initialized: Transfer document found with ${this._transferBlockLinks.length} links. BlockUploadId: ${this._internalBlockUploadId}`)):(E.validateParams(["relationType",o,"string"],["dataSize",i,"number"],["contentType",n,"string"],["componentId",a,"string",!0],["etag",d,"string",!0]),this._asset=s,$(this._asset.links,[I.BLOCK_UPLOAD_INIT],f.DCXError.UNEXPECTED,"/rel/block/init missing from BlockTransferDocument."),this._relationType=o,this._dataSize=i,this._contentType=n,this._componentId=a,this._md5=l,this._ifMatch=d),this._relPath=h,this._createIntermediates=c,this._respondWith=u,this._repoMetaPatch=p,this._maxConcurrentRequests=_||4,this._promise=new D.default((e,t)=>{this._reject=t,this._resolve=e}),ex.uploads.push(this)}init(e){if(this._assertStateIsValid("init"),!this._blockTransferDocument||!this._blockTransferDocument[t.Properties.LINKS]){this._shiftState(t.BlockTransferStates.INITIALIZING);let r=E.pruneUndefined(Object.assign({[t.BlockTransferProperties.REPO_REL_TYPE]:this._relationType,[t.BlockTransferProperties.REPO_IF_MATCH]:this._ifMatch,[t.BlockTransferProperties.REPO_SIZE]:this._dataSize,[t.BlockTransferProperties.DC_FORMAT]:this._contentType,[t.BlockTransferProperties.COMPONENT_ID]:this._componentId,[t.BlockTransferProperties.REPO_MD5]:this._md5},this._blockTransferDocument));return tL(this._service,this._asset,r,e).then(e=>(this._blockTransferDocument=e.result,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][I.BLOCK_TRANSFER],this._shiftState(t.BlockTransferStates.INITIALIZED),tk(`BlockUpload Initialized: Transfer document found with ${this._transferBlockLinks.length} links. BlockUploadId: ${this._internalBlockUploadId}`),this))}return D.default.resolve(this)}get state(){return this._state}get promise(){return this._promise}start(){return this._assertStateIsValid("start"),ex.uploads[0]!==this||this._state!==t.BlockTransferStates.INITIALIZED&&this._state!==t.BlockTransferStates.PAUSED||(tk(`Starting the transfer of BlockUpload: ${this._internalBlockUploadId}`),this._shiftState(t.BlockTransferStates.STARTED),this._uploadLoop()),this._promise}pause(){return this._assertStateIsValid("pause"),this._shiftState(t.BlockTransferStates.PAUSING),D.default.allSettled(this._pendingBlockRequests).then(()=>(this._shiftState(t.BlockTransferStates.PAUSED),tk(`BlockUploading has been paused.  BlockUploadId: ${this._internalBlockUploadId}`),this))}resume(){return this._assertStateIsValid("resume"),tk(`BlockUploading has been resumed.  BlockUploadId: ${this._internalBlockUploadId}`),this.start(),this}cancel(){this._assertStateIsValid("cancel"),this._shiftState(t.BlockTransferStates.CANCELED),tk(`A BlockUpload has been canceled... BlockUploadId: ${this._internalBlockUploadId}`),this._promise.cancel(),this._cancel()}_setWaiting(){this._shiftState(t.BlockTransferStates.WAITING)}uploadNextBlock(e){let r;if(this._assertStateIsValid("uploadNextBlock"),this._isEmptyBlock(e))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Trying to upload empty data block.");let s=this._blockTransferDocument[t.Properties.LINKS][I.BLOCK_TRANSFER][this._currentBlockIndex].href;tk(`Uploading a block... BlockUploadId: ${this._internalBlockUploadId}`);let o=tT(e),i=this._uploadBlock(e,s).then(e=>(this._totalBlocksUploaded++,this._updateProgress(o),r(),tk(`A block has completed... ${this._pendingBlocksCount} requests still active. BlockUploadId: ${this._internalBlockUploadId}`),e)).catch(e=>{tk(`A block upload has failed. BlockUploadId: ${this._internalBlockUploadId}`),r(),this._shiftState(t.BlockTransferStates.ERROR),this._reject(new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"A block has failed during upload",e,e.response)),this.cancel()});return r=this._pushPendingBlockRequest(i),i}get _pendingBlocksCount(){return ex.pendingUploadRequests.filter(e=>!!e).length}_nextBlockLock(){return this._pendingBlocksCount<this._maxConcurrentRequests?Promise.resolve():Promise.race(ex.pendingUploadRequests.filter(e=>!!e))}_handleAssetMoved(e){throw tk("_handleAssetMoved"),this._pendingBlockRequests.forEach(e=>{e.abort()}),this._pendingBlockRequests.length=0,this._transferBlockLinks.length=0,this._asset.links=Object.assign(Object.assign({},this._asset.links),ep(e.response)),this._currentBlockIndex=0,this._bytesUploaded=0,this._state=t.BlockTransferStates.NOT_INITIALIZED,this._blockTransferDocument[t.Properties.LINKS]=void 0,this.init().then(()=>this.start()),t.BlockTransferStates.INITIALIZING}_uploadLoop(){this._nextBlockLock().then(()=>{if(this._state===t.BlockTransferStates.FINALIZING||this._state===t.BlockTransferStates.COMPLETE)throw t.BlockTransferStates.COMPLETE;if(this._state===t.BlockTransferStates.PAUSING||this._state===t.BlockTransferStates.PAUSED)throw t.BlockTransferStates.PAUSED;if(this._state===t.BlockTransferStates.CANCELED)throw t.BlockTransferStates.CANCELED;if(this._state===t.BlockTransferStates.ERROR)throw t.BlockTransferStates.ERROR}).then(()=>this._getBlockAtIndex(this._currentBlockIndex)).then(e=>this._isEmptyBlock(e)?(tk(`No more blocks.  BlockUploadId: ${this._internalBlockUploadId}`),Promise.all(this._pendingBlockRequests).then(this._finalize.bind(this))):e&&tT(e)>0&&this._currentBlockIndex>=this._transferBlockLinks.length?this._extend().then(()=>e):e).then(e=>{if(!e)throw t.BlockTransferStates.COMPLETE;this.uploadNextBlock(e),this._currentBlockIndex++}).then(()=>{this._uploadLoop()}).catch(e=>{if("string"!=typeof e&&(this._continueBlockUploads(),this._reject(e)),e!==t.BlockTransferStates.INITIALIZING)if(e!==t.BlockTransferStates.COMPLETE){if(e!==t.BlockTransferStates.PAUSED)return e===t.BlockTransferStates.CANCELED?(tk(`BlockUpload loop is terminated due to the upload being canceled. BlockUploadId: ${this._internalBlockUploadId}`),void this._continueBlockUploads()):e===t.BlockTransferStates.ERROR?(tk(`BlockUpload loop is terminated due to error state. BlockUploadId: ${this._internalBlockUploadId}`),void this._continueBlockUploads()):void 0;tk(`BlockUpload loop is terminated due to paused state. BlockUploadId: ${this._internalBlockUploadId}`)}else tk(`BlockUpload loop is complete. BlockUploadId: ${this._internalBlockUploadId}`);else tk(`BlockUpload loop must be re-started due to assetmoved BlockUploadId: ${this._internalBlockUploadId}`)})}_getBlockAtIndex(e){tk(`_getBlockAtIndex(${e})`);let r=Math.min(this._dataSize,this._blockTransferDocument[t.BlockTransferProperties.REPO_BLOCK_SIZE]);if(this._state===t.BlockTransferStates.STARTED){let t=e*r;return tk("calling _getSliceCallback",t,t+r),this._getSliceCallback(t,t+r).catch(e=>{throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"The getSliceCallback threw an unexpected error.",e)})}}_uploadBlock(e,r){return this._service.invoke(t.HTTPMethods.PUT,r,void 0,e,{isStatusValid:K(),isExternalRequest:!0})}_isEmptyBlock(e){return"string"==typeof e?0===e.length:U(e)?0===e.size:!e||0===e.byteLength}_extend(){$(this._blockTransferDocument[t.Properties.LINKS],[I.BLOCK_EXTEND],f.DCXError.UNEXPECTED,"The transfer document does not contain an extend href");let e=Math.ceil(1.5*this._blockTransferDocument[t.BlockTransferProperties.REPO_SIZE]),r=E.getLinkHrefTemplated(this._blockTransferDocument[t.Properties.LINKS],I.BLOCK_EXTEND,{size:e});return this._service.invoke(t.HTTPMethods.POST,r,{},void 0,{isStatusValid:K(),responseType:"json"}).then(e=>(this._indeterminateTransfer=!0,this._blockTransferDocument=e.response,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][I.BLOCK_TRANSFER],tk(`Transfer document was extended to ${this._transferBlockLinks.length} transfer links. BlockUploadId: ${this._internalBlockUploadId}`),e)).catch(e=>{throw f.isAdobeDCXError(e)&&e.problemType===f.ProblemTypes.ASSET_MOVED&&this._handleAssetMoved(e),new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"An unexpected error occurred while extending the block transfer document.",e,e.response)})}_pushPendingBlockRequest(e){let t=this._pendingBlockRequests.push(e),r=ex.pendingUploadRequests.push(e);return()=>{delete this._pendingBlockRequests[t-1],delete ex.pendingUploadRequests[r-1]}}_updateProgress(e){if(tk("_updateProgress()",e),"number"==typeof e&&(this._bytesUploaded+=e),this.onProgress&&E.isAnyFunction(this.onProgress))try{this.onProgress(this._bytesUploaded,Math.max(this._blockTransferDocument[t.BlockTransferProperties.REPO_SIZE],this._bytesUploaded),this._indeterminateTransfer)}catch(e){console.error("Error in onProgress callback",e)}}_cancel(){this._pendingBlockRequests.map(e=>{e&&e.cancel()}),this._state!==t.BlockTransferStates.ERROR&&this._resolve(this)}_assertStateIsValid(e,r){let s=r||this._state;switch(e){case"init":if(s!==t.BlockTransferStates.NOT_INITIALIZED&&s!==t.BlockTransferStates.INITIALIZED)throw new f.DCXError(f.DCXError.INVALID_STATE,"BlockUpload has already been initialized");break;case"start":if(s===t.BlockTransferStates.NOT_INITIALIZED)throw new f.DCXError(f.DCXError.INVALID_STATE,"Please call init before starting the block upload");break;case"uploadNextBlock":if(s===t.BlockTransferStates.PAUSED||s===t.BlockTransferStates.CANCELED)throw new f.DCXError(f.DCXError.INVALID_STATE,"Cannot add block when Paused or Cancelled");break;case"getBlockAtIndex":if(s!==t.BlockTransferStates.STARTED)throw new f.DCXError(f.DCXError.INVALID_STATE,`Cannot fetch block while in the ${s} state`);break;case"cancel":if(s!==t.BlockTransferStates.STARTED&&s!==t.BlockTransferStates.FINALIZING&&s!==t.BlockTransferStates.PAUSING&&s!==t.BlockTransferStates.PAUSED&&s!==t.BlockTransferStates.ERROR)throw new f.DCXError(f.DCXError.INVALID_STATE,`Trying to cancel while in an invalid state ${s}`)}}_continueBlockUploads(){if(tk("continueBlockUploads()"),ex.uploads[0]===this)if(ex.uploads.shift(),ex.uploads.length>0){let e=ex.uploads[0];tk("Another block upload found in the queue, starting..."),e.start()}else 0===this._pendingBlocksCount&&(tk("There are no more pending block transfers.. Clean up blockUploadManager.."),ex.resetUploads())}_finalize(){tk(`Finalizing block transfer.  BlockUploadId: ${this._internalBlockUploadId}`),this._shiftState(t.BlockTransferStates.FINALIZING);let e=E.getLinkHrefTemplated(this._blockTransferDocument[t.Properties.LINKS],I.BLOCK_FINALIZE,E.pruneUndefined({path:this._relPath,intermediates:this._createIntermediates,respondWith:E.isObject(this._respondWith)?JSON.stringify(this._respondWith):this._respondWith,repoMetaPatch:this._repoMetaPatch}));return this._blockTransferDocument[t.Properties.LINKS][I.BLOCK_TRANSFER]=this._transferBlockLinks.slice(0,this._totalBlocksUploaded),this._service.invoke(t.HTTPMethods.POST,e,{[t.HeaderKeys.CONTENT_TYPE]:w},JSON.stringify(E.pruneUndefined(this._blockTransferDocument)),{isStatusValid:K(),retryOptions:{pollHeader:"location",pollCodes:[202],timeoutAfter:12e4},responseType:"arraybuffer"}).then(e=>{if(200===e.statusCode||201===e.statusCode){tk(`Finalize complete.  BlockUploadId: ${this._internalBlockUploadId}`);let r=eQ(new Uint8Array(e.response));if(this._relationType===I.PRIMARY){if(this.finalizeResponse=r,this.createdAsset=E.pruneUndefined({assetId:r.headers["asset-id"],repositoryId:r.headers["repository-id"],links:e_(r.headers.link),etag:r.headers.etag,md5:r.headers["content-md5"]}),r.response&&this._respondWith)try{let e=JSON.parse(E.arrayBufferToString(r.response));r.response=e,this.createdAsset=E.mergeDeep(this.createdAsset,el(e))}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"Unexpected error parsing respondWith parameter",e)}}else{this.finalizeResponse=e;try{this.uploadRecord=tw(this._blockTransferDocument[t.BlockTransferProperties.DC_FORMAT],this._blockTransferDocument[t.BlockTransferProperties.COMPONENT_ID],this._bytesUploaded,E.arrayBufferToString(e.response))}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"An error occurred while deserializing upload component record.",e,r)}}this._shiftState(t.BlockTransferStates.COMPLETE),this._updateProgress(!0),this._resolve(this)}this._continueBlockUploads()}).catch(e=>{f.isAdobeDCXError(e)&&e.problemType===f.ProblemTypes.ASSET_MOVED&&this._handleAssetMoved(e),tk("Error occurred finalizing the block transfer.. Rejecting"),this._reject(new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"An error occurred while finalizing the block transfer.",e,e.response)),this._continueBlockUploads()})}_shiftState(e){return tk(`_shiftState(): ${e}`),this._state===t.BlockTransferStates.COMPLETE||this._state===t.BlockTransferStates.ERROR||this._state===t.BlockTransferStates.CANCELED||(this._state=e,this.emit("stateChanged",[this._state])),this}}function tL(e,r,s,o={}){if(E.validateParams(["svc",e,"object"],["asset",r,"object"],["transferDocument",s,"object"],["additionalHeaders",o,"object",!0]),$(r.links,[I.BLOCK_UPLOAD_INIT]),s["repo:resource"]){if(!s["repo:resource"].reltype)throw new f.DCXError(f.DCXError.INVALID_DATA,"reltype param is required in the Resource Designator");s[t.BlockTransferProperties.REPO_REL_TYPE]=s["repo:resource"].reltype,s["repo:resource"].component_id&&(s[t.BlockTransferProperties.COMPONENT_ID]=s["repo:resource"].component_id),s["repo:resource"].etag&&(s[t.BlockTransferProperties.REPO_IF_MATCH]=s["repo:resource"].etag),delete s["repo:resource"]}if(s[t.BlockTransferProperties.REPO_REL_TYPE]===I.COMPONENT&&!s[t.BlockTransferProperties.COMPONENT_ID])throw new f.DCXError(f.DCXError.INVALID_DATA,"Component Id required to block upload to a component");let i=E.getLinkHref(r.links,I.BLOCK_UPLOAD_INIT);o[t.HeaderKeys.CONTENT_TYPE]=w;let n=E.normalizeHeaders(o);return n.priority=n.priority||"u=1",e.invoke(t.HTTPMethods.POST,i,n,JSON.stringify(s),{responseType:"json",isStatusValid:K()}).then(e=>({response:e,result:e.response}))}function tM({additionalHeaders:e,asset:r,componentId:s,contentType:o,dataOrSliceCallback:i,etag:n,maybeIsNew:a,md5:l,progressCb:d,relation:h,size:c,svc:u,blockSize:p,maxConcurrentRequests:_}){tS("_upload()"),E.validateParams(["svc",u,"object"],["asset",r,"object"],["size",c,"number",!0],["md5",l,"string",!0],["etag",n,"string",!0]);let g=tT(tP(i,c)),m=q(u);if(tI(r,g))return tX({asset:r,additionalHeaders:e,componentId:s,contentType:o,dataOrSliceCallback:i,etag:n,md5:l,progressCb:d,relation:h,size:c,service:m,blockSize:p,maxConcurrentRequests:_});$(r.links,[h]);let A=E.getLinkHrefTemplated(r.links,h,{component_id:s});return D.default.resolve(void 0,{blockUpload:void 0,progress:d}).then(()=>Promise.resolve(E.isAnyFunction(i)?i(0,g):i)).then(s=>(function e({additionalHeaders:r={},asset:s,contentType:o,data:i,etag:n,headHref:a,href:l,maybeIsNew:d,relation:h,service:c},u=!1){return(eW("_doUpload()"),E.validateParams(["service",c,"object"],["asset",s,"object"],["href",l,"string"],["headHref",a,"string"],["contentType",o,"string",!0],["maybeIsNew",d,"boolean",!0],["etag",n,"string",!0],["isRetry",u,"boolean",!0],["additionalHeaders",r,"object",!0]),null==d)?c.invoke(t.HTTPMethods.HEAD,a,r,void 0,{isStatusValid:K([404])}).then(t=>e({additionalHeaders:r,asset:s,contentType:o,data:i,etag:n,headHref:a,href:l,maybeIsNew:200!==t.statusCode,relation:h,service:c},u)):(d?delete r[t.HeaderKeys.IF_MATCH]:r[t.HeaderKeys.IF_MATCH]=n||"*",o&&(r[t.HeaderKeys.CONTENT_TYPE]=o),c.invoke(t.HTTPMethods.PUT,l,r,i,{isStatusValid:K([404,409,412]),retryOptions:{pollHeader:"location",pollCodes:[202]}}).then(t=>{let p=t.statusCode;if(p>400&&!u){if(null!=n)throw K()(p,t);if(!d&&404===p)return e({additionalHeaders:r,asset:s,contentType:o,data:i,etag:n,headHref:a,href:l,maybeIsNew:!0,relation:h,service:c},!0);if(404===p)throw new f.DCXError(f.DCXError.NOT_FOUND,"Unexpected response",void 0,t);if(409===p||412===p)return e({additionalHeaders:r,asset:s,contentType:o,data:i,etag:n,headHref:a,href:l,maybeIsNew:void 0,relation:h,service:c},!0)}return t}))})({asset:r,additionalHeaders:e,contentType:o,data:s,etag:n,headHref:A,href:A,maybeIsNew:a,relation:h,service:m})).then(e=>{let t={};try{t=ep(e),r.links=E.merge(r.links||{},t);let s=z(u);s&&s.setValueWithAsset(r.links,r)}catch(e){}return{response:e,result:{revision:e.headers.revision||e.headers.version,location:e.headers.location,links:t,etag:e.headers.etag,version:e.headers.version||e.headers.revision,md5:e.headers.md5||e.headers["content-md5"],length:g,type:o},isBlockUpload:!1,asset:{assetId:r.assetId||e.headers["asset-id"],repositoryId:r.repositoryId||e.headers["repository-id"],links:r.links||t}}}).catch(e=>{throw e})}function tX({service:e,asset:r,additionalHeaders:s,dataOrSliceCallback:o,contentType:i,progressCb:n,relation:a,size:l,componentId:d,md5:h,etag:c,relPath:u,createIntermediates:p,respondWith:_,blockSize:g,repoMetaPatch:m,maxConcurrentRequests:A}){if(!l)throw new f.DCXError(f.DCXError.INVALID_DATA,"A size estimate is required when a GetSliceCallback is provided. The size is used to determine the number of requests required to block transfer the asset.");let y=E.isAnyFunction(o)?o:function(e){if(!E.isAnyFunction(e.slice))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Data cannot be sliced");return function(t,r){return N(this,void 0,void 0,function*(){return e.slice(t,r)})}}(o);$(r.links,[I.BLOCK_UPLOAD_INIT]);let D=tL(e,r,E.pruneUndefined({[t.BlockTransferProperties.REPO_REL_TYPE]:a,[t.BlockTransferProperties.REPO_IF_MATCH]:c,[t.BlockTransferProperties.REPO_SIZE]:l,[t.BlockTransferProperties.DC_FORMAT]:i,[t.BlockTransferProperties.COMPONENT_ID]:d,[t.BlockTransferProperties.REPO_MD5]:h,[t.BlockTransferProperties.REPO_BLOCK_SIZE]:g}),s);return D.then(t=>{let r=new tN(e,y,t.result,a,l,i,d,h,c,u,p,_,m,A);return r.onProgress=n,Object.assign(D,{blockUpload:r}),r.init(s)}).then(e=>e.start()).then(e=>{let t=e.finalizeResponse||{headers:{}};return{response:t,result:e.uploadRecord||e.createdAsset,blockUpload:e,isBlockUpload:!0,asset:{assetId:t.headers["asset-id"]||r.assetId,repositoryId:t.headers["repository-id"]||r.repositoryId,etag:t.headers.etag,links:r.links}}})}function tx(e){return e||"defaultbuffer"}function tB(e,r,s="json",o={}){E.validateParams(["svc",e,"object"],["asset",r,"object"],["format",s,"enum",!1,["json","xml"]]),$(r.links,[I.EMBEDDED_METADATA]);let i=E.getLinkHref(r.links,I.EMBEDDED_METADATA);return e.invoke(t.HTTPMethods.GET,i,Object.assign(Object.assign({},o),{accept:t.EmbeddedMetadataMediaTypes[s.toUpperCase()],vary:"accept"}),void 0,{isStatusValid:K(),responseType:"json"===s?"json":"text"}).then(e=>({result:e.response,response:e}))}function tj(e,r,s,o,i="json",n={}){E.validateParams(["svc",e,"object"],["asset",r,"object"],["data",s,["string","object","object[]"]],["etag",o,"string",!0],["format",i,"enum",!1,["json","xml"]]),$(r.links,[I.EMBEDDED_METADATA]);let a=E.getLinkHref(r.links,I.EMBEDDED_METADATA),l=Object.assign(Object.assign({},n),{[t.HeaderKeys.CONTENT_TYPE]:t.EmbeddedMetadataMediaTypes[i.toUpperCase()],[t.HeaderKeys.IF_MATCH]:o});return e.invoke(t.HTTPMethods.PUT,a,l,"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K()})}function tU(e,r,s,o,i={}){E.validateParams(["svc",e,"object"],["asset",r,"object"],["data",s,["string","object","object[]"]],["etag",o,"string",!0]),$(r.links,[I.EMBEDDED_METADATA]);let n=E.getLinkHref(r.links,I.EMBEDDED_METADATA);return e.invoke(t.HTTPMethods.PATCH,n,Object.assign(i,{[t.HeaderKeys.CONTENT_TYPE]:R,[t.HeaderKeys.IF_MATCH]:o}),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K(),retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:"GET"}})}let tH=g.newDebug("dcx:assets:filebase"),tV=g.newDebug("dcx:assets:filebase:leaf"),tF="application/vnd.adobe.versions+json";class tY extends e6{constructor(e,r,s){super(e,r,s),this._data.width=null!=e.width?e.width:e[t.Properties.IMAGE_WIDTH],this._data.length=null!=e.length?e.length:e[t.Properties.IMAGE_LENGTH],this._data.renderable=null!=e.renderable?e.renderable:"object"==typeof this._data.links?I.RENDITION in this._data.links:void 0}get width(){return this._data.width}get length(){return this._data.length}get renderable(){return this._data.renderable}getRendition(e,t,r,s){return tH("getRendition()"),E.validateParams(["opts",e,"object",!0],["responseType",t,"string",!0],["linkProvider",r,"object",!0]),this.fetchLinksIfMissing([I.RENDITION],s).then(()=>tW(this._svc,this,e,t,r,s))}getEmbeddedMetadata(e="json",t){return tH("getEmbeddedMetadata()"),E.validateParams(["format",e,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing([I.EMBEDDED_METADATA],t).then(()=>tB(this._svc,this,e,t))}putEmbeddedMetadata(e,t,r="json",s){return E.validateParams(["data",e,["object","object[]","string"]],["etag",t,"string",!0],["format",r,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing([I.EMBEDDED_METADATA],s).then(()=>tj(this._svc,this,e,t,r,s))}patchEmbeddedMetadata(e,t,r){return E.validateParams(["data",e,["object","object[]","string"]],["etag",t,"string",!0]),this.fetchLinksIfMissing([I.EMBEDDED_METADATA],r).then(()=>tU(this._svc,this,e,t,r))}blockDownload(e,t,r,s,o,i,n){tH("blockDownload()"),E.validateParams(["startByte",e,"number",!0],["endByte",t,"number",!0],["resource",r,"string",!0],["componentId",s,"string",!0],["version",o,"string",!0],["responseType",i,"enum",!0,k]),E.assert(()=>null==e||null==t||e<t,"endByte must be greater than startByte");let a={};return this._withSourcePromise(a).then(()=>this.fetchLinksIfMissing([I.BLOCK_DOWNLOAD])).then(()=>tq.call(a,this._svc,this,e,t,r,s,o,i,n))}updatePrimaryResource(e,t,r,s,o,i){tH("updatePrimaryResource()");let n=E.isAnyFunction(e)?I.BLOCK_UPLOAD_INIT:I.PRIMARY;return this.fetchLinksIfMissing([n],i).then(()=>tz(this.serviceConfig,this,e,t,r,s,o,i)).then(e=>(this._data.etag=e.result.etag,this._data.md5=e.result.md5,this._data.length=e.result.length,this._data.version=e.result.version,e))}}function tW(e,r,s,o="defaultbuffer",i,n){tV("getRendition()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["renditionOptions",s,"object",!0],["linkProvider",i,"object",!0]),$(r.links,[I.RENDITION]);let a=i?E.provideLink(r.links[I.RENDITION],i,s):E.getLinkHrefTemplated(r.links,I.RENDITION,Object.assign({},s));return e.invoke(t.HTTPMethods.GET,a,n,void 0,{responseType:tx(o),isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function tq(e,t,r,s,o,i,n,a,l){tV("doBlockDownload()"),E.validateParams(["svc",e,"object"],["assetOrPresignedUrl",t,["object","string"]],["startByte",r,"number",!0],["endByte",s,"number",!0],["resource",o,"string",!0],["componentId",i,"string",!0],["version",n,"string",!0],["responseType",a,"enum",!0,k]),E.assert(()=>null==r||null==s||r<s,"endByte must be greater than startByte");let d=null!=this?this:{};if("string"==typeof t)return eF.call(d,e,t,r,s,a,!0,void 0,l);$(t.links,[I.BLOCK_DOWNLOAD]);let h=E.pruneUndefined({reltype:o,component_id:i,revision:n}),c=E.getLinkHrefTemplated(t.links,I.BLOCK_DOWNLOAD,{resource:void 0!==o?JSON.stringify(h):void 0});return eF.call(d,e,c,r,s,a,!1,void 0,l)}function tz(e,t,r,s,o,i,n,a){return tV("updatePrimaryResource()"),E.validateParams(["service",e,"object"],["asset",t,"object"],["dataOrSliceCallback",r,["function","object","string"]],["contentType",s,"string"],["size",o,"number",!0],["md5",n,"string",!0]),$(t.links,[I.PRIMARY]),tM({svc:e,asset:t,dataOrSliceCallback:r,contentType:s,relation:I.PRIMARY,size:o,md5:n,maybeIsNew:!1,etag:i,additionalHeaders:a}).catch(l=>{var d;if(413===(null==(d=l.response)?void 0:d.statusCode))return tX({service:q(e),asset:t,dataOrSliceCallback:r,contentType:s,relation:I.PRIMARY,size:o,md5:n,etag:i,additionalHeaders:a});throw l})}let tG=g.newDebug("dcx:assets:pagination");class tK{constructor(e,t,r,s){if(this._links=e,this._svc=t,this._transformer=r,this._items={},this.ListResource=s,!e||!e[I.PAGE])throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Asset must have links that contain a page relation.")}get items(){return Object.values(this._items)}get data(){return this._data}getPage(e={},r){tG("getPage()");let{embed:s}=e,o=S(e,["embed"]);s&&(o.embed=s.some(e=>"object"==typeof e)?JSON.stringify(s):s.join(",")),this.ListResource&&Object.assign(o,{resource:this.ListResource});let i=E.getLinkHrefTemplated(this._links,I.PAGE,o);return this._svc.invoke(t.HTTPMethods.GET,i,r,void 0,{isStatusValid:K(),responseType:"json"}).then(e=>{let t=this.parseResponse(e);return this._data=t,{paged:this,result:this._data,response:e}})}getNextPage(){if(tG("getNextPage()"),this.hasNextPage()&&this._nextPageLink)return this._svc.invoke(t.HTTPMethods.GET,this._nextPageLink.href,void 0,void 0,{isStatusValid:K(),responseType:"json"}).then(e=>{let t=this.parseResponse(e);return this._data=t,{paged:this,result:this._data,response:e}})}hasNextPage(){return tG("hasNextPage() ",void 0!==this._nextPageLink),void 0!==this._nextPageLink}*[Symbol.iterator](){for(let e in this._items)yield this._items[e]}[Symbol.asyncIterator](){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=r.apply(e,t||[]),i=[];return s={},n("next"),n("throw"),n("return"),s[Symbol.asyncIterator]=function(){return this},s;function n(e){o[e]&&(s[e]=function(t){return new Promise(function(r,s){i.push([e,t,r,s])>1||a(e,t)})})}function a(e,t){var r;try{(r=o[e](t)).value instanceof L?Promise.resolve(r.value.v).then(l,d):h(i[0][2],r)}catch(e){h(i[0][3],e)}}function l(e){a("next",e)}function d(e){a("throw",e)}function h(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,function*(){for(let e in this._items)yield yield L(this._items[e]);for(;this.hasNextPage();)for(let e of(yield L(this.next())).value.paged)yield yield L(e)})}next(){return N(this,void 0,void 0,function*(){if(tG("next()"),!this.hasNextPage())return{done:!0,value:void 0};let e=yield this.getNextPage();return e?{done:!1,value:e}:{done:!0,value:void 0}})}parseResponse(e){tG("parseResponse()"),this._items={};let r=e.response;for(let e in r[t.Properties.CHILDREN]){let s=r[t.Properties.CHILDREN][e],[o,i]=this._transformer(s,this._svc);this._items[o]=i}return this._nextPageLink=r[t.Properties.LINKS].next,this.currentPage=r[t.Properties.PAGE],r}}let t$=g.newDebug("dcx:assets:version"),tJ=g.newDebug("dcx:assets:version:leaf");class tZ extends tY{constructor(e,t,r){super(e,t,r),this._svc=t,this.type=C.Version,this._data=t1(e)}get milestone(){return this._data.milestone}getRepositoryResource(){throw t$("getRepositoryResource()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}getEffectivePrivileges(){throw t$("getEffectivePrivileges()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}performBulkRequest(e,t){throw t$("performBulkRequest()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}checkACLPrivilege(e,t){throw t$("checkACLPrivilege()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}getACLPolicy(){throw t$("getACLPolicy()"),new f.DCXError(f.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}}function tQ(e){tJ("adobeVersionTransformer()");let t=t1(e);return t.links=E.merge({},e.links,e._links),[t.version,t]}function t0(e,t){tJ("versionTransformer()");let r=new tZ(e,t);return[r.version,r]}function t1(e){return tJ("deserializeVersion()"),{version:e.version||e[t.VersionProperties.VERSION],createDate:e.created||e[t.VersionProperties.CREATED],createdBy:e.createdBy||e[t.VersionProperties.CREATED_BY],milestone:e.milestone||e[t.VersionProperties.MILESTONE],links:e._links}}let t2=g.newDebug("dcx:assets:file"),t4=g.newDebug("dcx:assets:file:leaf");class t5 extends tY{constructor(e,t,r){super(e,t,r),this.type=C.File}getPagedVersions(e={itemTransformer:t0},t){return t2("getPagedVersions()"),E.validateParams(["pageOpts",e,"object",!0]),this.fetchLinksIfMissing([I.PAGE],t).then(()=>t8(this._svc,this,e,t))}getVersionResource(e,t){return t2("getVersionResource()"),E.validateParams(["version",e,"string"]),this.fetchLinksIfMissing([I.PAGE],t).then(()=>t6(this._svc,this,e,t).then(e=>({result:e.result?new tZ(e.result,this._svc):void 0,response:e.response})))}patchVersions(e,t,r){return t2("patchVersions()"),E.validateParams(["patchDoc",e,["string","array"]],["etag",t,"string",!0]),this.fetchLinksIfMissing([I.VERSION_HISTORY],r).then(()=>t3(this._svc,this,e,t,r))}initBlockUpload(e,t){return E.validateParams(["transferDocument",e,"object"],["additionalHeaders",t,"object",!0]),this.fetchLinksIfMissing([I.BLOCK_UPLOAD_INIT],t).then(()=>tL(this._svc,this,e,t))}copy(e,t,r,s,o){return super.copy(e,t,r,s,o).then(({response:e,result:t})=>({response:e,result:new t5(t,this.serviceConfig)}))}}function t3(e,r,s,o,i){t4("patchVersions()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["patchDoc",s,["string","array"]],["etag",o,"string",!0]),$(r.links,[I.VERSION_HISTORY]);let n=Object.assign(Object.assign({},i),{[t.HeaderKeys.CONTENT_TYPE]:R});o&&(n[t.HeaderKeys.IF_MATCH]=o);let a=E.getLinkHref(r.links,I.VERSION_HISTORY);return e.invoke(t.HTTPMethods.PATCH,a,n,"string"==typeof s?s:JSON.stringify(s),{isStatusValid:K()})}function t6(e,r,s,o){t4("getVersionResource()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["version",s,"string"]),$(r.links,[I.PAGE]),Z(r.links,I.PAGE,"type",tF);let i=E.getLinkHrefTemplated(r.links,I.PAGE,{version:s});return e.invoke(t.HTTPMethods.GET,i,o,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response[t.VersionProperties.TOTAL_CHILDREN]>0?e.response[t.Properties.CHILDREN][0]:void 0,response:e}))}function t8(e,t,r={},s){return t4("getPagedVersions()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["pageOpts",r,"object"]),$(t.links,[I.PAGE]),Z(t.links,I.PAGE,"type",tF),new tK(t.links,e,r.itemTransformer||tQ,I.VERSION_HISTORY).getPage(r,s)}let t9=g.newDebug("dcx:assets:composite"),t7=g.newDebug("dcx:assets:composite:leaf"),re=g.AdobeDCXLogger.getInstance();class rt extends t5{constructor(e,t,r){super(e,t,r),this.type=C.Composite}headManifest(e){return t9("headManifest()"),this.fetchLinksIfMissing([I.MANIFEST],e).then(()=>rr(this._svc,this,e)).then(e=>this._updateDataWithResponse(e))}getManifest(e,t,r){return t9("getManifest()"),E.validateParams(["version",e,"string",!0],["etag",t,"string",!0]),this.fetchLinksIfMissing([I.MANIFEST],r).then(()=>rs(this._svc,this,e,t,r))}getManifestUrl(e){t9("getManifestUrl()");let t=null==e?I.MANIFEST:I.PAGE;return this.fetchLinksIfMissing([t]).then(()=>ro(this._svc,this,e))}getManifestAndComponentsByPath(e,t,r,s){return t7("getManifestAndComponentsByPath()"),ra(this._svc,this,e,t,r,s)}getComponent(e,t,r,s,o){t9("getComponent()");let i={};return this._withSourcePromise(i).then(()=>rf.call(i,this._svc,this,e,t,r,s,o))}getComponentByPath(e,t="defaultbuffer",r){return t9("getComponentByPath()"),r_(this.serviceConfig,this,e,t,r)}getComponentUrl(e,t,r){return t9("getComponentUrl()"),this.fetchLinksIfMissing([I.COMPONENT],r).then(()=>rc(this._svc,this,e,t))}updateManifest(e,t,r,s,o,i){return t9("updateManifest()"),this.fetchLinksIfMissing([I.MANIFEST],o).then(()=>rg(this._svc,this,e,t,r,s,o,i)).then(this._updateDataWithResponse.bind(this))}putComponent(e,t,r,s,o,i,n,a){if(t9("putComponent()"),s&&!E.verifyUuid(e))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Component id is not a uuid");return E.verifyUuid(e)||re.warn("Existing component id is not a uuid"),this.fetchLinksIfMissing([I.COMPONENT],a).then(()=>rm(this.serviceConfig,this,e,t,r,s,o,i,n,a))}putEmbeddedMetadata(e,t,r="json",s){return E.validateParams(["data",e,["object","object[]","string"]],["etag",t,"string",!0],["format",r,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing([I.EMBEDDED_METADATA],s).then(()=>tj(this._svc,this,e,t,r,s)).then(e=>N(this,void 0,void 0,function*(){return yield this.headManifest(s),e}))}patchEmbeddedMetadata(e,t,r){return E.validateParams(["data",e,["object","object[]","string"]],["etag",t,"string",!0]),this.fetchLinksIfMissing([I.EMBEDDED_METADATA],r).then(()=>tU(this._svc,this,e,t,r)).then(e=>N(this,void 0,void 0,function*(){return yield this.headManifest(),e}))}copy(e,t,r,s,o){return super.copy(e,t,r,s,o).then(({response:e,result:t})=>({response:e,result:new rt(t,this.serviceConfig)}))}}function rr(e,r,s){return t7("headCompositeManifest()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.MANIFEST]),ro(e,r,void 0,s).then(r=>e.invoke(t.HTTPMethods.HEAD,r,s,void 0,{responseType:"json",isStatusValid:K()}))}function rs(e,r,s,o,i){return t7("getCompositeManifest()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["version",s,"string",!0],["etag",o,"string",!0]),$(r.links,[I.MANIFEST]),ro(e,r,s,i).then(r=>e.invoke(t.HTTPMethods.GET,r,Object.assign(null!=i?i:{},o?{[t.HeaderKeys.IF_NONE_MATCH]:o}:{}),void 0,{responseType:"json",isStatusValid:K([304]),retryOptions:{pollCodes:[404],pollHeader:"location",pollMethod:t.HTTPMethods.GET,problemWithCode:{problemType:f.ProblemTypes.RESOURCE_NOT_READY,code:404,url:r}}})).then(e=>({manifestData:e.response||null,manifestEtag:e.headers.etag,response:e}))}function ro(e,t,r,s){return t7("getCompositeManifestUrl()"),rn(e,t,I.MANIFEST,r,s).then(e=>E.expandURITemplate(e,{}))}function ri(e,t,r,s){return t7("_getComponentPathUrl()"),rn(e,t,I.COMPONENT,t.version,s).then(e=>E.expandURITemplate(e,E.pruneUndefined({component_path:r})))}function rn(e,r,s,o,i){return t7("_getUrl()"),E.validateParams(["svc",e,"object"],["asset",r,"object"],["versionId",o,"string",!0]),D.default.resolve().then(()=>{if(o)return t6(e,r,o,i)}).then(e=>{if(null!=o){if(!e||!E.isObject(e)||"object"!=typeof e.result)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Invalid version resource.",void 0,e?e.response:void 0);return $(e.result[t.Properties.LINKS],[s]),E.getLinkHref(e.result[t.Properties.LINKS],s)}return E.getLinkHref(r.links,s)})}function ra(e,r,s,o,i,n){E.validateParams(["svc",e,"object"],["asset",r,"object"],["components",s,"array"],["version",o,"string",!0],["etag",i,"string",!0]);let a=[I.MANIFEST,I.COMPONENT,I.BULK_REQUEST,I.BLOCK_DOWNLOAD];return o&&a.push(I.PAGE),tg(e,r,a,void 0,n).then(a=>N(this,void 0,void 0,function*(){r.links=Object.assign({},r.links,a);let l=q(e),d=s.map(({component_path:e,responseType:s,subrequestHeaders:o})=>({method:t.HTTPMethods.GET,href:E.getLinkHrefTemplated(r.links,I.COMPONENT,{component_path:e}),headers:Object.assign(o||{},n),component_path:e,responseType:s})),h=yield ro(l,r,o,n);d.unshift({method:t.HTTPMethods.GET,href:h,headers:Object.assign(i?{[t.HeaderKeys.IF_NONE_MATCH]:i}:{},n)});let c={startTime:E.now(),timeoutAfter:72e5};return E.retriesWithDelayOnError(rl.bind(void 0,e,r,s,d,n),404,c,f.ProblemTypes.RESOURCE_NOT_READY)}))}function rl(e,r,s,o,i){return N(this,void 0,void 0,function*(){let n=q(e),a=yield Promise.all(E.chunkArray(o,10).map(e=>e1(n,r,e,void 0,i,!0)));return D.default.resolve((yield a.reduce((a,l)=>N(this,void 0,void 0,function*(){var d,h,c;let u=yield a;if(u.responses.push(l.response),200!==l.response.statusCode)return u;let{componentResponses:p,manifestResponse:_}=(c=l.result,c.reduce((e,r)=>{let s=o.find(e=>e.href===r.headers[t.HeaderKeys.CONTENT_ID]);if(!s)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Bulk sub-response content-id did not match any bulk request",void 0,r);return"component_path"in s?e.componentResponses.push(r):e.manifestResponse=r,e},{componentResponses:[]})),g={};if(s.forEach(e=>{e.hasOwnProperty("skipBlockDownload")&&(g[e.component_path]=e.skipBlockDownload)}),Object.assign(u.components,(yield function(e,r,s,o,i,n){return N(this,void 0,void 0,function*(){return(yield Promise.all(r.map(r=>N(this,void 0,void 0,function*(){if(r.headers[t.HeaderKeys.CONTENT_TYPE]===P&&r.response.type===f.ProblemTypes.RESPONSE_TOO_LARGE){let a=rd(r,e),l=r.headers.location?r.headers.location:E.getLinkHrefTemplated(o,I.BLOCK_DOWNLOAD,{resource:JSON.stringify({component_path:a.component_path})});if(n&&n[a.component_path])return{statusCode:200,headers:E.pruneUndefined({[t.HeaderKeys.CONTENT_TYPE]:r.headers["content-type"],[t.HeaderKeys.CONTENT_LENGTH]:r.headers["content-length"],[t.HeaderKeys.CONTENT_ID]:r.headers[t.HeaderKeys.CONTENT_ID]}),responseType:"application/json",response:{href:l},message:"OK"};let d=yield eF(q(s),l,void 0,void 0,"defaultbuffer",!0,void 0,i);return Object.assign(d.headers,{[t.HeaderKeys.CONTENT_ID]:r.headers[t.HeaderKeys.CONTENT_ID]}),d}return r})))).reduce((t,r)=>{let s=rd(r,e);try{let e=f._responseToError(r);t[s.component_path]=Object.assign({},s,{response:r,[e?"error":"data"]:e||rh(r.response,s.responseType||"defaultbuffer",r.headers["content-type"])})}catch(e){t[s.component_path]=Object.assign({},s,{response:r,error:new f.DCXError(f.DCXError.UNEXPECTED,"Error parsing sub-response into requested responseType",e)})}return t},{})})}(o.slice(1),p,e,r.links,i,g))),!_)return u;if(200===_.statusCode){u.manifest.data=rh(_.response,"json"),u.manifest.response=_,j(r)&&"function"==typeof(null==(d=r.current)?void 0:d.parse)&&(r.current.parse(E.arrayBufferToString(_.response)),r.current.versionId=_.headers.version),r.links=ep(_);let t=z(e);return t&&t.setValueWithAsset(r.links,r),u}if(304===_.statusCode)return u.manifest.response=_,u;if(404===_.statusCode){if(_.response=rh(_.response,"json"),_.response&&_.response.type===f.ProblemTypes.RESOURCE_NOT_READY)throw new f.DCXError(f.DCXError.NOT_FOUND,void 0,void 0,_);return u.manifest.error=f._responseToError(_)||new f.DCXError(f.DCXError.NO_COMPOSITE,"Composite missing or deleted",void 0,_),u}if(_.headers[t.HeaderKeys.CONTENT_TYPE]===P&&_.response.type===f.ProblemTypes.RESPONSE_TOO_LARGE){try{let e=_.headers.location?_.headers.location:E.getLinkHrefTemplated(r.links,I.BLOCK_DOWNLOAD,{resource:JSON.stringify({reltype:I.MANIFEST})}),t=yield eF(n,e,void 0,void 0,"json",!0,void 0,i);u.manifest.data=t.response,u.manifest.response=t,j(r)&&"function"==typeof(null==(h=r.current)?void 0:h.parse)&&r.current.parse(JSON.stringify(t.response)),r.links=ep(t)}catch(e){u.manifest.error=e instanceof f.DCXError?e:new f.DCXError(f.DCXError.UNEXPECTED,"Error fetching manifest via block download",e)}return u}return u.manifest.error=f._responseToError(_)||new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,_.response.title||"Failed to fetch manifest. Operation failed.",void 0,_),u}),Promise.resolve({manifest:{},components:{},responses:[]}))))})}function rd(e,r){if(!e.headers[t.HeaderKeys.CONTENT_ID])throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Sub-response is missing content-id header",void 0,e);let s=r.find(({href:r})=>r===e.headers[t.HeaderKeys.CONTENT_ID]);if(!s)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Bulk sub-response content-id did not match any bulk request",void 0,e);return s}function rh(e,t,r){if(!B(e))return e;switch(t){case"text":return E.arrayBufferToString(e);case"json":return JSON.parse(E.arrayBufferToString(e));case"blob":return new Blob([e],{type:r});case"buffer":case"defaultbuffer":return e;case"arraybuffer":return e.buffer}throw new f.DCXError(f.DCXError.INVALID_PARAMS,"requested response type is not supported")}function rc(e,t,r,s){return t7("getCompositeComponentUrl()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["componentId",r,"string"],["componentRevision",s,"string",!0]),$(t.links,[I.COMPONENT]),E.getLinkHrefTemplated(t.links,I.COMPONENT,{component_id:r,revision:s})}function ru(e,r,s,o){return t7("getPresignedUrl()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),tg(e,r,[I.BLOCK_DOWNLOAD],void 0,o).then(r=>{let i=s?JSON.stringify(s):void 0,n=E.getLinkHrefTemplated(r,I.BLOCK_DOWNLOAD,{resource:i});return(F(e)?e.service:e).invoke(t.HTTPMethods.GET,n,Object.assign({priority:"u=1"},o),void 0,{isStatusValid:K(),responseType:"json",retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:t.HTTPMethods.GET}})}).then(e=>{if("string"!=typeof e.response.href)throw new f.DCXError(f.DCXError.INVALID_DATA,"Direct download URL not found.",void 0,e);return{response:e,result:e.response.href}})}function rp(e,t,r,s,o){return t7("getCompositeComponentPresignedUrl()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["componentId",r,"string"],["componentRevision",s,"string"]),ru(e,t,{reltype:I.COMPONENT,revision:s,component_id:r},o)}function r_(e,t,r,s="defaultbuffer",o,i){return E.validateParams(["svc",e,"object"],["asset",t,"object"],["componentPath",r,"string"],["responseType",s,"string",!0],["additionalHeaders",o,"object",!0]),tg(e,t,[I.COMPONENT,I.PAGE],void 0,o).then(s=>{if(t.links=s,t.version)return ri(q(e),t,r)}).then(n=>eq(q(e),t,null!=n?n:E.getLinkHrefTemplated(t.links,I.COMPONENT,{component_path:r}),I.COMPONENT,s,void 0,void 0,o,i))}function rf(e,t,r,s,o="defaultbuffer",i,n){t7("getCompositeComponent()"),E.validateParams(["svc",e,"object"],["asset",t,"object"],["componentId",r,"string"],["componentRevision",s,"string"],["responseType",o,"string",!0],["additionalHeaders",i,"object",!0],["componentSize",n,"number",!0]);let a={};if(!n||n<tR()){let n=rc(e,t,r,s);return eq.call(a,e,t,n,I.COMPONENT,o,r,s,i)}return rp(e,t,r,s,i).then(({response:t,result:r})=>eF.call(a,e,r,void 0,void 0,o,!0,t.response.size,i))}function rg(e,r,s,o,i=1,n,a={},l){if(t7("updateCompositeManifest() ",o,n),E.validateParams(["svc",e,"object"],["asset",r,"object"],["manifest",s,["object","string"]],["overwrite",o,"boolean"],["validationLevel",i,"+number"],["etag",n,"string",!0]),i<1)throw new f.DCXError(f.DCXError.INVALID_PARAMS,"ValidationLevel must be >=1");return $(r.links,[I.BULK_REQUEST,I.REPO_METADATA]),rn(e,r,I.MANIFEST,void 0,a).then(d=>N(this,void 0,void 0,function*(){let h,c,u,p=Object.assign({},a);o?p[t.HeaderKeys.IF_MATCH]="*":n&&(p[t.HeaderKeys.IF_MATCH]=n);let _=`${b}; validation-level=${i}`;p[t.HeaderKeys.CONTENT_TYPE]=_;let g="string"==typeof s?s:JSON.stringify(s),m=d.includes(t.Constants.REPO_META_PATCH)||d.includes(t.Constants.RESPOND_WITH);if(m){let s={};if(r.deviceModifyDate){let e={};e[t.Properties.REPO_DEVICE_MODIFY_DATE]=r.deviceModifyDate,s[t.Constants.REPO_META_PATCH]=e}l&&(s[t.Constants.RESPOND_WITH]=l),d=E.expandURITemplate(d,s),h=yield function(e,r,s,o){return N(this,void 0,void 0,function*(){return yield e.invoke(t.HTTPMethods.PUT,r,o,s,{isStatusValid:K([412,409]),responseType:"arraybuffer",retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:t.HTTPMethods.GET}})})}(e,d,g,p)}else{let s=yield function(e,r,s,o,i,n){return N(this,void 0,void 0,function*(){let a=[{method:t.HTTPMethods.PUT,href:s,headers:i,body:o}];if(r.deviceModifyDate){let e=JSON.stringify([{op:"add",path:`/${[t.Properties.REPO_DEVICE_MODIFY_DATE]}`,value:r.deviceModifyDate}]),s={[t.HeaderKeys.CONTENT_TYPE]:R};a.push({method:t.HTTPMethods.PATCH,href:E.getLinkHref(r.links,I.REPO_METADATA),headers:s,body:e})}let{result:l,response:d}=yield e1(e,r,a,void 0,n,!0),{manifestResponse:h,repoMetadataResponse:c}=function(e,r){let s={manifestResponse:{},repoMetadataResponse:{}};return r.forEach(r=>{let o=e.find(e=>e.headers[t.HeaderKeys.CONTENT_ID]===r.href);if(!o)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Bulk sub-response content-id did not match any bulk request",void 0,o);r.href.includes(":repometadata")?s.repoMetadataResponse=o:s.manifestResponse=o}),s}(l,a);return{manifestResponse:h,repoMetadataResponse:c,response:d}})}(e,r,d,g,p,a);h=s.manifestResponse,c=s.repoMetadataResponse,u=s.response}if(t7("uCM() status code for manifest response: ",h.statusCode),412===h.statusCode&&o)return t7("uCM() retry 412 without overwrite"),rg(e,r,s,!1,i,void 0,a);if(409===h.statusCode&&o)return t7("uCM() retry 409 without overwrite"),rg(e,r,s,!1,i,n,a);if(409===h.statusCode)throw new f.DCXError(f.DCXError.UPDATE_CONFLICT,"Manifest has been changed",void 0,h);if(412===h.statusCode)throw new f.DCXError(f.DCXError.PRECONDITION_FAILED,"Precondition failed",void 0,h);if(400===h.statusCode){let e=f._responseToError(h);throw new f.DCXError(null==e?void 0:e.code,null==e?void 0:e.message,void 0,h)}{let e=K()(h.statusCode,h);if(!0!==e)throw new f.DCXError(e.code||f.DCXError.UNEXPECTED_RESPONSE,e._message||e.message,e.underlyingError,h)}if(!m){if(h.xhr=u.xhr,t7("uCM() status code for metadata response: ",c.statusCode),r.deviceModifyDate&&200!==c.statusCode&&201!==c.statusCode&&204!==c.statusCode)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Unexpected HTTP Response",void 0,c);return h}let A=h;if(200===h.statusCode&&(A=eQ(new Uint8Array(h.response))),A.response&&l)try{let e=JSON.parse(E.arrayBufferToString(A.response));A.response=el(e)}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"Unexpected error parsing respondWith parameter",e)}return A}))}function rm(e,t,r,s,o,i,n,a,l,d,h){if(E.validateParams(["service",e,"object"],["asset",t,"object"],["componentId",r,"string"],["contentType",o,"string"],["maybeIsNew",i,"boolean",!0],["size",n,"number",!0],["blockSize",h,"number",!0],["md5",a,"string",!0]),i&&!E.verifyUuid(r))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Component id is not a uuid");return E.verifyUuid(r)||re.warn("Existing component id is not a uuid"),tM({svc:e,asset:t,dataOrSliceCallback:s,contentType:o,relation:I.COMPONENT,size:n,componentId:r,md5:a,maybeIsNew:i,additionalHeaders:d,progressCb:l,blockSize:h}).then(({response:e,result:t,isBlockUpload:s,asset:i})=>{let n={response:e,result:Object.assign(Object.assign({},t),{id:r,type:o}),isBlockUpload:s,asset:i};return Object.defineProperty(n,"compositeAsset",{get:()=>i}),n})}let rE=g.newDebug("dcx:assets:directory"),rA=g.newDebug("dcx:assets:directory:leaf");class ry extends e6{constructor(e,r,s){super(e,r,s),this.type=C.Directory,this.children=[],this.children=e[t.Properties.CHILDREN]}getPagedChildren(e,t){return rE("getPagedChildren()"),this.fetchLinksIfMissing([I.PAGE],t).then(()=>rI(this._svc,this,e,t))}createAsset(e,t,r,s,o,i,n,a,l){return rE("createAsset()"),rv(this._svc,this,e,t,r,s,o,i,n,a,l).then(e=>({result:new e6(e.result,this.serviceConfig),response:e.response}))}copy(e,t,r){return super.copy(e,t,r).then(({response:e,result:t})=>({response:e,result:new ry(t,this.serviceConfig)}))}}function rD(e){var r;rA("directoryTransformer()");let s=el(e,null==(r=e[t.Properties.PAGE])?void 0:r.embed);s.links=E.merge({},e.links,e._links);let o=e.children||e[t.Properties.CHILDREN];return o&&o.length>0?s.children=o.map(e=>el(e)):s.children=[],[s.assetId,s]}function rC(e,r){return rA("getDirectoryByURL()"),e.invoke(t.HTTPMethods.GET,r,void 0,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:e.response,response:e}))}function rI(e,t,r={},s){if(rA("getPagedChildren()"),$(t.links,[I.PAGE]),r&&r.embed&&r.embed.includes(I.REPOSITORY))throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Repository Resource embeds on directory listings are not supported");try{return new tK(t.links,e,rD,"api:primary").getPage(r,s)}catch(e){return D.default.reject(e)}}function rv(e,r,s,o,i,n,a={},l,d,h,c){rA("createAsset()"),E.validateParams(["service",e,"object"],["parentDir",r,"object"],["relPath",s,"string"],["createIntermediates",o,"boolean"],["contentType",i,"string"],["respondWith",n,["string","object"],!0],["additionalHeaders",a,"object",!0],["repoMetaPatch",h,"object",!0]);let u=E.isObject(n)?JSON.stringify(n):n;return tg(e,r,[I.CREATE]).then(p=>{let _=E.getLinkHrefTemplated(p,I.CREATE,{path:s,intermediates:o.toString(),respondWith:u,mode:"id",repoMetaPatch:h}),g=Object.assign({},{[t.HeaderKeys.CONTENT_TYPE]:i},a),m=q(e),A=l?tP(l,d):void 0,C=A?tT(A):0;return l&&tI(r,C)?tX({service:m,contentType:i,relation:I.PRIMARY,asset:r,dataOrSliceCallback:l,size:C,relPath:s,createIntermediates:o,respondWith:n,repoMetaPatch:h,additionalHeaders:a,progressCb:c}).then(({result:e,response:t})=>{let r=s.split("/").slice(-1);return{result:E.pruneUndefined(E.mergeDeep({name:r},e)),response:t}}):D.default.resolve().then(()=>N(this,void 0,void 0,function*(){let u=E.isAnyFunction(l)?yield l(0,C):A;return m.invoke(t.HTTPMethods.POST,_,g,u,{responseType:"json",isStatusValid:K([413]),reuseRequestDesc:{id:"createAsset",method:t.HTTPMethods.POST,href:_,headers:g,progress:c}}).then(u=>{var p;let _;if(413===u.statusCode)return tX({service:m,contentType:i,relation:I.PRIMARY,asset:r,dataOrSliceCallback:l,size:tT(tP(l,d)),relPath:s,createIntermediates:o,respondWith:n,repoMetaPatch:h,additionalHeaders:a,progressCb:c}).catch(e=>{var t;if(e.problemType===f.ProblemTypes.ASSET_NAME_CONFLICT){let r={assetId:null==(t=e.response.response)?void 0:t["repo:assetId"],links:ep(e.response)};return tX({service:m,contentType:i,relation:I.PRIMARY,asset:r,dataOrSliceCallback:l,size:tT(tP(l,d)),relPath:s,createIntermediates:o,respondWith:n,repoMetaPatch:h,additionalHeaders:a,progressCb:c})}throw e}).then(({result:e,response:t})=>{let r=s.split("/")[s.split("/").length-1];return{result:E.pruneUndefined(E.mergeDeep({name:r},e)),response:t}});let g=s.split("/")[s.split("/").length-1];r.path&&(_=E.appendPathElements(r.path,s));let A=ep(u),D=u.headers;if(null==(p=D[t.HeaderKeys.CONTENT_TYPE])?void 0:p.includes("multipart/mixed")){let e=e$(u)[1];throw 404===e.statusCode?new y.default(f.DCXError.ASSET_NOT_FOUND,"Asset was created successfully but repository metadata could not be found.",void 0,u):403===e.statusCode?new y.default(f.DCXError.FORBIDDEN,"Asset was created successfully but Permission denied for fetching repository metadata.",void 0,u):f.unexpectedResponse("Unexpected Server Response",void 0,u)}let C=E.isObject(u.response)?u.response:{etag:"",md5:""},v=D["asset-id"]||D["x-resource-id"],b=r.repositoryId,T=C.etag,P=C.md5;null==n&&(T=D.etag,P=D["content-md5"]);let R=E.isObject(u.response)&&n&&(n===I.REPO_METADATA||E.isObject(n)&&n.reltype===I.REPO_METADATA)?el(u.response):{};u.response&&(R.representations=u.response.representations||u.response[t.Properties.REPO_REPRESENTATIONS]);let w=z(e);return w&&w.setValueWithAsset(A,R),{result:E.pruneUndefined(E.mergeDeep({name:g},R,E.pruneUndefined({links:A,assetId:v,etag:T,md5:P,repositoryId:b,format:i,path:_}))),response:u}})}))})}let rb=g.newDebug("dcx:assets:discoverable");function rT(e){rb("discoverableAssetTransformer()");let r=e[t.Properties.EMBEDDED][I.REPO_METADATA],s=el(r,e[t.Properties.EMBEDDED]);return s.links=E.merge({},e.links,r._links),[s.assetId,s]}function rP(e){rb("discoverableReposTransformer()");let r=e[t.Properties.EMBEDDED][I.PRIMARY],s=ed(r);return s.links=r._links,[s.repositoryId,s]}let rR=g.newDebug("dcx:assets:factory");function rw(e,t){rR("hydrateAsset()"),E.validateParams(["asset",e,"object"],["svc",t,"object"]);let r=e.format||"",s=r.endsWith("+dcx")?C.Composite:r===v?C.Directory:r.split("/").length>1?C.File:C.Asset;switch(s){case C.Directory:return e.type===s&&e instanceof ry?e:new ry(e,t);case C.Composite:return e.type===s&&e instanceof rt?e:new rt(e,t);case C.File:return e.type===s&&e instanceof t5?e:new t5(e,t);case C.Asset:return e.type===s&&e instanceof e6?e:new e6(e,t);default:return new e6(e,t)}}let rO=g.newDebug("dcx:assets:indexdocument");function rk(e){rO("deserializeIndexDocument()");let r=e.children.map(e=>{let r=el(e[t.Properties.EMBEDDED][I.REPO_METADATA]);return r.embedded={RepositoryResource:ed(e[t.Properties.EMBEDDED][I.REPOSITORY])},r});return{regions:e[t.Properties.REPO_REGIONS],assignedDirectories:r,links:e._links}}class rS{constructor(e=1e5,t="SESSION"){if(this.values={},this.maxEntries=1e5,this.promiseToResolveMap=new Map,e<=0)throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Cache Max enteries must be great than 0.");this.maxEntries=e,this.defaultSessionKey=t}clear(){for(let e in this.promiseToResolveMap.forEach(e=>{e.call(void 0)}),this.values)this.values[e].clear();this.values={}}getKey(e){if(e.assetId||"object"!=typeof e)return e.assetId}getValueWithAsset(e){if(!e.assetId&&"object"==typeof e)return;let t=this.getKey(e);return t?this.get(t,e.repositoryId):void 0}setPending(e,t=this.defaultSessionKey){let r;this.values[t]||(this.values[t]=new Map);let s=this.values[t].get(e);if(s&&s instanceof Promise)return this.promiseToResolveMap.get(s);let o=new Promise(e=>{r=e});return this.values[t].set(e,o),this.promiseToResolveMap.set(o,r),o.then(()=>this.promiseToResolveMap.delete(o)).catch(()=>this.promiseToResolveMap.delete(o)),r}get(e,t=this.defaultSessionKey){if(this.values[t]&&t in this.values)return this.values[t].get(e)}setValueWithAsset(e,t){if(!e)return;let r=this.getKey(t);if(r){let s=t.repositoryId||this.defaultSessionKey;this.set(e,r,s)}}set(e,t,r=this.defaultSessionKey){if(this.values[r]){if(this.values[r]&&this.values[r].get(t)instanceof Promise){let s=this.values[r].get(t),o=this.promiseToResolveMap.get(s);this.promiseToResolveMap.delete(s),o&&o(e)}}else this.values[r]=new Map;if(this.values[r].size>=this.maxEntries){let e=this.values[r].keys().next().value;this.values[r].delete(e)}this.values[r].set(t,Promise.resolve(e))}delete(e,t=this.defaultSessionKey){this.values[t]&&this.values[t].delete(e)}deleteWithAsset(e){let t=this.getKey(e);t&&this.delete(t,e.repositoryId)}}t.RenditionType=void 0,(p=t.RenditionType||(t.RenditionType={})).IMAGE_JPG="image/jpg",p.IMAGE_PNG="image/png",p.IMAGE_GIF="image/gif",p.VIDEO_MP4="video/mp4",p.VIDEO_METADATA="application/vnd.adobe.ccv.videometadata",t.RenditionC2paSign=void 0,(_=t.RenditionC2paSign||(t.RenditionC2paSign={})).NONE="none",_.EMBEDDED="embedded";let rN=g.newDebug("dcx:assets:versionset"),rL=g.newDebug("dcx:assets:versionset:leaf");Object.defineProperty(t,"ProblemTypes",{enumerable:!0,get:function(){return f.ProblemTypes}}),t.ACLPolicyMediaType="application/vnd.adobecloud.accesscontrolpolicy+json",t.Asset=e6,t.AssetFactory=class{constructor(e){this._svc=e}hydrate(e){return rw(e,this._svc)}},t.AssetTypes=C,t.BlockTransferMediaType=w,t.BlockUpload=tN,t.COPY_RESOURCES_RESOURCE_LIMIT=30,t.Composite=rt,t.DEFAULT_BLOCK_DOWNLOAD_THRESHOLD=0x3200000,t.DEFAULT_BLOCK_UPLOAD_THRESHOLD=0xa00000,t.DEFAULT_CACHE_MAX_ENTRIES=1e5,t.DEFAULT_MAX_CONCURRENT_REQUESTS=4,t.DEFAULT_STRING_LENGTH_CHECK=2621440,t.Directory=ry,t.DirectoryMediaType=v,t.File=t5,t.GenericCache=rS,t.JSONLDMediaType="application/ld+json",t.JSONMediaType=T,t.JSONPatchMediaType=R,t.JSONProblemMediaType=P,t.LinkRelation=I,t.MAX_CACHE_PERIOD_MS=2592e6,t.ManifestMediaType=b,t.OperationDocumentBuilder=eR,t.OperationDocumentMediaType=O,t.PageResource=tK,t.RepositoryLinksCache=class extends rS{constructor(e=1e5,t=2592e6){super(e,"SESSION"),this.timestampsOnLinkCreation=0,this.maxCachePeriodMS=0,this.maxCachePeriodMS=t}isLinkExpired(){return this.maxCachePeriodMS<Date.now()-this.timestampsOnLinkCreation}setIndexLinks(e){this.set(e,"INDEX","SESSION"),this.timestampsOnLinkCreation=Date.now()}getIndexLinks(){if(!this.isLinkExpired())return this.get("INDEX","SESSION")}setIndexRepository(e){this.indexRepository=e}getIndexRepository(){return this.indexRepository}setRepositoryLinks(e){this.set(e,"/Repositories","SESSION"),this.timestampsOnLinkCreation=Date.now()}getRepositoryLinks(){if(!this.isLinkExpired())return this.get("/Repositories","SESSION")}},t.STREAMABLE_RESPONSE_TYPES=k,t.Version=tZ,t.VersionSet=class{constructor(e,r,s){for(let s in this._svc=r,this.versionCount=e.versionCount||e[t.VersionProperties.TOTAL_CHILDREN],this.repositoryId=e.repositoryId||e[t.Properties.REPO_REPOSITORY_ID],this.assetId=e.assetId||e[t.Properties.REPO_ASSET_ID],this.versions=[],e.versions||e[t.Properties.CHILDREN])this.versions.push(new tZ(e.versions&&e.versions[s]?e.versions[s]:e[t.Properties.CHILDREN][s],r));this.links=E.merge({},e.links,e._links,s)}versionByVersionId(e){return rN("versionByVersionId()"),this.versions.find(t=>t.version===e)}versionsByLabel(e){return rN("versionsByLabel()"),this.versions.filter(t=>!(!t.milestone||t.milestone.label!==e))}},t._copyResources=eX,t._getComponentPathUrl=ri,t._getUrl=rn,t._parseUploadableData=tP,t.adobeVersionTransformer=tQ,t.assertLinksContain=$,t.assertLinksContainAny=J,t.assertValidBulkRequest=e0,t.assetTransformer=function(e){e3("assetTransformer()");let t=el(e);return t.links=E.merge({},e.links,e._links),[t.assetId,t]},t.blockTransferManager=ex,t.bodyToUint8Array=eK,t.buildRangeHeader=eY,t.checkACLPrivilege=tu,t.constructMultipartRequestBody=eG,t.constructServiceEndpoint=G,t.convertToACPRepoMetadataResource=function(e){ea("convertToACPRepoMetadataResource()");let r={};return r[t.Properties.REPO_REPOSITORY_ID]=e[t.Properties.REPO_REPOSITORY_ID]||e.repositoryId,r[t.Properties.REPO_ASSET_ID]=e[t.Properties.REPO_ASSET_ID]||e.assetId,r[t.Properties.REPO_NAME]=e[t.Properties.REPO_NAME]||e.name,r[t.Properties.REPO_SIZE]=null!=e[t.Properties.REPO_SIZE]?e[t.Properties.REPO_SIZE]:e.size,r[t.Properties.REPO_PATH]=e[t.Properties.REPO_PATH]||e.path,r[t.Properties.REPO_ASSET_CLASS]=e[t.Properties.REPO_ASSET_CLASS]||e.etag,r[t.Properties.REPO_ETAG]=e[t.Properties.REPO_ETAG]||e.etag,r[t.Properties.REPO_VERSION]=e[t.Properties.REPO_VERSION]||e.version,r[t.Properties.DC_FORMAT]=e[t.Properties.DC_FORMAT]||e.format,r[t.Properties.REPO_CREATE_DATE]=e[t.Properties.REPO_CREATE_DATE]||e.createDate,r[t.Properties.REPO_MODIFY_DATE]=e[t.Properties.REPO_MODIFY_DATE]||e.modifyDate||e.modifiedDate,r[t.Properties.REPO_DISCARD_DATE]=e[t.Properties.REPO_DISCARD_DATE]||e.discardDate,r[t.Properties.REPO_CREATED_BY]=e[t.Properties.REPO_CREATED_BY]||e.createdBy,r[t.Properties.REPO_MODIFIED_BY]=e[t.Properties.REPO_MODIFIED_BY]||e.modifiedBy,r[t.Properties.REPO_DISCARDED_BY]=e[t.Properties.REPO_DISCARDED_BY]||e.discardedBy,r[t.Properties.REPO_DEVICE_CREATE_DATE]=e[t.Properties.REPO_DEVICE_CREATE_DATE]||e.deviceCreateDate,r[t.Properties.REPO_DEVICE_MODIFY_DATE]=e[t.Properties.REPO_DEVICE_MODIFY_DATE]||e.deviceModifyDate,r[t.Properties.REPO_DEFAULT_SCHEDULED_DELETION_DURATION]=e[t.Properties.REPO_DEFAULT_SCHEDULED_DELETION_DURATION]||e.defaultScheduledDeletionDuration,r[t.Properties.REPO_SCHEDULED_DELETION_DATE]=e[t.Properties.REPO_SCHEDULED_DELETION_DATE]||e.scheduledDeletionDate,r[t.Properties.REPO_BASE_ASSET_ID]=e[t.Properties.REPO_BASE_ASSET_ID]||e.baseAssetId,r[t.Properties.REPO_STATE]=e[t.Properties.REPO_STATE]||e.state,r[t.Properties.LINKS]=e[t.Properties.LINKS]||e.links,r[t.Properties.REPO_REPRESENTATIONS]=e[t.Properties.REPO_REPRESENTATIONS]||e.representations,r[t.Properties.IMAGE_WIDTH]=e[t.Properties.IMAGE_WIDTH]||e.width,r[t.Properties.IMAGE_LENGTH]=e[t.Properties.IMAGE_LENGTH]||e.length,E.pruneUndefined(r)},t.copyAsset=eE,t.copyAssetResources=function(e,t,r,s,o,i,n){return eX(e,t,r,s,o,i,n)},t.copyResources=function(e,t,r,s,o,i,n){return eg("copyResource()"),eX(e,t,r,s,o,i,n).then(e=>e.response).then(eN)},t.createAsset=rv,t.defaultBufferResponseType=tx,t.deleteACLPolicy=t_,t.deleteAsset=eC,t.deserializeAsset=el,t.deserializeIndexDocument=rk,t.deserializeRepository=ed,t.deserializeUploadComponentRecord=tw,t.deserializeVersion=t1,t.deserializeVersionSet=function(e){rL("deserializeVersionSet()");let r={versionCount:e[t.VersionProperties.TOTAL_CHILDREN],repositoryId:e[t.VersionProperties.REPO_ID],assetId:e[t.Properties.REPO_ASSET_ID],links:{},versions:[]},s=e.children||e[t.Properties.CHILDREN];return s&&s.length>0&&(r.versions=s.map(e=>t1(e))),r.links=e._links,r},t.directoryTransformer=rD,t.discardAsset=eD,t.discoverableAssetTransformer=rT,t.discoverableReposTransformer=rP,t.doBatchOperation=function(e,t,r,s){return eP(e,t,r,s).then(eb)},t.doBlockDownload=tq,t.doLinksContain=Q,t.doOperation=eP,t.doesAssetContainLinks=ee,t.fetchLinksForAsset=tt,t.fetchLinksForAssetWithResponse=tr,t.fetchLinksIfMissing=tg,t.getACLPolicy=tc,t.getAppMetadata=ta,t.getBaseDirectoryMetadata=to,t.getBlockDownloadThreshold=tR,t.getCompositeComponent=rf,t.getCompositeComponentByPath=r_,t.getCompositeComponentPresignedUrl=rp,t.getCompositeComponentUrl=rc,t.getCompositeComponentsUrlsForUpload=function(e,r,s,o){return tg(e,r,[I.COMPONENT,I.BLOCK_UPLOAD_INIT],void 0,o).then(i=>{var n;let a=q(e);null==(n=z(e))||n.setValueWithAsset(i,r),r.links=Object.assign(Object.assign({},r.links),i);let l=E.normalizeHeaders(E.pruneUndefined(Object.assign(Object.assign({},o),{[t.HeaderKeys.AUTHORIZATION]:a.authProvider.authToken,[t.HeaderKeys.X_API_KEY]:a.authProvider.apiKey})));return Promise.all(s.map(e=>tI(r,e.size)?tL(a,r,E.pruneUndefined({"repo:reltype":I.COMPONENT,"repo:size":e.size,"dc:format":e.contentType,component_id:e.componentId}),l).then(e=>{if(200!==e.response.statusCode)throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from block upload init",e.response);let r=e.result;return{blockSize:r[t.BlockTransferProperties.REPO_BLOCK_SIZE],uploadRequestParameters:r[t.Properties.LINKS][I.BLOCK_TRANSFER].map(({href:e})=>({href:e,method:t.HTTPMethods.PUT})),finalizeRequestParameters:{href:E.getLinkHrefTemplated(r[t.Properties.LINKS],I.BLOCK_FINALIZE,{}),method:t.HTTPMethods.POST,headers:l,body:`${JSON.stringify(r)}`}}}).catch(e=>{throw new f.DCXError(f.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from block upload init",e)}):D.default.resolve({blockSize:e.size,uploadRequestParameters:[{href:rc(a,r,e.componentId),method:t.HTTPMethods.PUT,headers:l}]})))})},t.getCompositeManifest=rs,t.getCompositeManifestUrl=ro,t.getDataLength=tT,t.getDirectory=function(e,t){return rA("directoryTransformer()"),tg(e,t,[I.PRIMARY]).then(t=>rC(q(e),E.getLinkHref(t,I.PRIMARY)))},t.getDirectoryByURL=rC,t.getDiscoverableAssets=function(e,t={},r){rb("getDiscoverableAssets()"),E.validateParams(["svc",e,"object"],["pageOpts",t,"object"]);let s=q(e);return eu(e,r).then(e=>new tK(e.assetLinks,s,rT,"api:primary").getPage(t,r)).then(e=>({result:e.response.response,paged:e.paged,response:e.response}))},t.getDiscoverableRepos=function(e,r={},s){rb("getDiscoverableRepos()"),E.validateParams(["svc",e,"object"],["pageOpts",r,"object"]);let o=q(e),i=G("/repositories",o);return D.default.resolve(void 0).then(()=>N(this,void 0,void 0,function*(){let n,a=z(e);return a&&(n=yield a.getRepositoryLinks()),n||(n=ep((yield o.invoke(t.HTTPMethods.HEAD,i,s,void 0,{isStatusValid:K()})))),a&&a.setRepositoryLinks(n),new tK(n,o,rP).getPage(r,s)})).then(e=>({result:e.response.response,paged:e.paged,response:e.response}))},t.getEffectivePrivileges=th,t.getEmbeddedMetadata=tB,t.getHTTPResource=en,t.getIndexDocument=function(e,r){rO("getIndexDocument()"),E.validateParams(["svc",e,"object"]);let s=q(e),o=G("/index",s);return s.invoke(t.HTTPMethods.GET,o,r,void 0,{responseType:"json",isStatusValid:K()}).then(e=>({result:rk(e.response),response:e.response}))},t.getIndexLinks=ec,t.getIndexRepository=eu,t.getLinksForAsset=ts,t.getLinksFromCache=tA,t.getManifestAndComponentsByPath=ra,t.getOpsHref=ef,t.getPagedChildren=rI,t.getPagedVersions=t8,t.getPresignedUrl=ru,t.getPrimaryResource=e8,t.getPubsAsset=function(e,r){eh("getPubsAsset()");let s=q(e),o=G("/index-pubs",s);return s.invoke(t.HTTPMethods.GET,o,r,void 0,{responseType:"json",isStatusValid:K()}).then(r=>{let s=el(r.response.pubsDir[t.Properties.EMBEDDED]["http://ns.adobe.com/adobecloud/rel/metadata/repository"]),o=z(e);return o&&o.setValueWithAsset(s.links,s),s})},t.getRendition=tW,t.getRepoMetadata=function(e,r,s){e3("getRepoMetadata()"),E.validateParams(["svc",e,"object"],["asset",r,"object"]),$(r.links,[I.REPO_METADATA]);let o=E.getLinkHref(r.links,I.REPO_METADATA);return e.invoke(t.HTTPMethods.GET,o,s,void 0,{responseType:"json",isStatusValid:K()}).then(e=>{let r=ep(e),s=e.response;return s[t.Properties.LINKS]=E.merge({},s[t.Properties.LINKS],r),{result:s,response:e}})},t.getRepositoryResource=ti,t.getReposityLinksCache=z,t.getResolveByIdHref=function(e){if(E.isObject(this)){if("string"==typeof this.resolveByIdHref)return D.default.resolve(this.resolveByIdHref);if(E.isAnyFunction(this.resolveByIdHref))return D.default.resolve(this.resolveByIdHref())}return ec(e).then(e=>{try{return E.getLinkHref(e,I.RESOLVE_BY_ID)}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"Could not get ResolveByID href.",e)}})},t.getResolveByPathHref=function(e){if(E.isObject(this)){if("string"==typeof this.resolveByPathHref)return D.default.resolve(this.resolveByPathHref);if(E.isAnyFunction(this.resolveByPathHref))return D.default.resolve(this.resolveByPathHref())}return ec(e).then(e=>{try{return E.getLinkHref(e,I.RESOLVE_BY_PATH)}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,"Could not get ResolveByPath href.",e)}})},t.getResolveLinkForAsset=e7,t.getService=q,t.getVersionResource=t6,t.headAppMetadata=tn,t.headCompositeManifest=rr,t.headHTTPResource=ei,t.headPrimaryResource=e9,t.hydrateAsset=rw,t.isAdobeCopyResourcesDocument=e=>"copy_resources"===e.op,t.isAdobeDCXBranchLike=function(e){return E.isObject(e)&&(["compositeId","compositeAssetId","compositeRepositoryId"].some(t=>t in e)||E.isObject(e._core))},t.isAdobeDCXCompositeLike=j,t.isAdobeResponseLike=M,t.isBlob=U,t.isBufferLike=B,t.isComponentResourceDesignator=function(e){return E.isObject(e)&&"component_id"in e},t.isHttpService=V,t.isMinimalAdobeAsset=function(e){return E.isObject(e)&&(E.isObject(e.links)||"string"==typeof e.repositoryId&&("string"==typeof e.path||"string"==typeof e.assetId))},t.isRepoResponseLike=X,t.isRepoResponseResultLike=x,t.isResolvableAsset=H,t.isServiceConfig=F,t.isTransferDocument=Y,t.maybeGetBlockTransfer=tO,t.moveAsset=ey,t.newBlockDownload=eV,t.newOperationDocBuilder=ew,t.normalizeCopyResourcesDesignator=e=>{if(e.hasOwnProperty("source")&&e.hasOwnProperty("target"))return{source:eA(e.source),target:eA(e.target)};let t=eA(e);return{source:t,target:t}},t.packageAssets=ev,t.parseHttpResponseContent=eQ,t.parseLinkString=e_,t.parseLinksFromResponseHeader=ep,t.parseMultipartResponseParts=e$,t.patchACLPolicy=tp,t.patchAppMetadata=td,t.patchEmbeddedMetadata=tU,t.patchVersions=t3,t.pauseBlockTransfer=function(e,t){return N(this,void 0,void 0,function*(){let r=yield tO(e);if(r)return t&&r.on("stateChanged",t),yield r.pause(),r})},t.performBulkRequest=e1,t.putAppMetadata=tl,t.putCompositeComponent=rm,t.putEmbeddedMetadata=tj,t.resolveAsset=te,t.restoreAsset=eI,t.setBlockDownloadThreshold=e=>{if(Number.isNaN(e)||"number"!=typeof e||e<=0)throw new f.DCXError(f.DCXError.INVALID_PARAMS,"Invalid block download threshold, must be positive integer");tC=e},t.shouldUseBlockTransferForDownload=(e,t=0x3200000)=>e>=t,t.shouldUseBlockTransferForUpload=tI,t.streamToGetSliceCallback=function(e,t,r,s=4){var o;let i=null!=(o=tb(r))?o:0xa00000,n=i*s,a=new Uint8Array(new ArrayBuffer(n)),l=0,d=E.isWHATWGReadableStream(e)?e.pipeThrough(function(e,t){let r,s=new ByteLengthQueuingStrategy({highWaterMark:e*t});return{writable:new WritableStream({write(t){if(tD("Chunk Received:",t.byteLength),t.byteLength<e)r.enqueue(t);else for(let s of[...Array(Math.ceil(t.byteLength/e)).keys()].map(r=>t.subarray(r*e,Math.min((r+1)*e,t.byteLength))))tD("enqueue smaller chunk:",s.byteLength),r.enqueue(s)},close(){r.close()}},s),readable:new ReadableStream({start(e){r=e}},s)}}(i,s)).getReader():e,h=!1,c=Promise.resolve();return function(e,t){return N(this,void 0,void 0,function*(){if(h)return new Uint8Array([]);try{let r,s=new Promise((o,i)=>N(this,void 0,void 0,function*(){function u(r){let s=l%n;if(r.byteLength+s>n){let e=n-s;a.set(r.subarray(0,e),s),a.set(r.subarray(e),0)}else a.set(r,s);if(l+=r.byteLength,tD(`chunk ${e}-${t} progress: ${l-e}/${t-e}`),l>=t){let r=a.subarray(e%n,t%n||t);tD(`resolving slice - start:  ${e}, end: ${t}, length: ${r.byteLength}`),o(r)}}if(E.isNodeReadableStream(d)){function p(){return N(this,void 0,void 0,function*(){let e=d.read(t-l);null!==e&&u(e)})}let c=()=>{h=!0,o(a.subarray(e%n,l%n||n))},_=()=>{d.off("readable",p),d.off("end",c),d.off("error",i)};r=()=>N(this,void 0,void 0,function*(){d.on("readable",p),d.on("end",c),d.on("error",i),yield p(),s.finally(_)})}else r=()=>(tD("starting read for slice",e,t),function r(){return N(this,void 0,void 0,function*(){let{value:s,done:i}=yield d.read();return i?(h=!0,tD("End of stream",e,l),o(a.subarray(e%n,l%n||n))):(u(s),l<=t?yield r():void 0)})}());c=c.then(()=>N(this,void 0,void 0,function*(){r(),yield s}))}));return s}catch(e){throw new f.DCXError(f.DCXError.UNEXPECTED,e.message,e)}})}},t.updateCompositeManifest=rg,t.updatePrimaryResource=tz,t.useLinkOrResolveResource=tf,t.versionTransformer=t0},621655:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s,o,i,n,a,l,d=r(111829),h=(n=r(866525))&&"object"==typeof n&&"default"in n?n:{default:n};s=l={path:a,exports:{},require:function(e,t){throw null==t&&l.path,Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},l.exports,"undefined"!=typeof self?s.exports=self:"undefined"!=typeof window?s.exports=window:s.exports=Function("return this")(),l.exports;let c="dcxjs",u=globalThis;u[c]={_modules:{}},Object.assign(u[c],{getModule:e=>{var t;return null==(t=u[c])?void 0:t.modules[e]},registerModule:(e,t)=>{let r=u[c];if(!r)throw Error("[@dcx/core] Namespace not yet initialized.");if(e in r.modules)throw Error(`[@dcx/core] Module ${e} already registered.`);r.modules[e]={module:t}}}),Object.defineProperty(u[c],"modules",{get:()=>u[c]._modules}),null==(o=u[c])||o.registerModule("AdobeDCXLogger",d.AdobeDCXLogger),Object.defineProperty(u[c],"logger",{get:()=>{var e;return null==(e=u[c])?void 0:e.getModule("AdobeDCXLogger").module},enumerable:!0}),null==(i=u[c])||i.registerModule("AdobeDCXPromise",h.default);let p=globalThis[c];t.dcxjs=p,t.default=p,t.getModule=e=>{var t;let r=u[c];if(!r)throw Error("[@dcx/core] Namespace not yet initialized.");return null==(t=r.getModule(e))?void 0:t.module}},433287:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(621655);var s,o,i,n=r(4861),a=r(111829);r(737719);var l=r(42173),d=r(397503),h=r(247673),c=r(866525),u=r(738513),p=r(609645);function _(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=_(a),g=function(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}(l),m=_(h),E=_(c);class A{constructor(){this._communityId=null,this._artworkComponentId=null,this._assetId=null,this._resourcePath=null,this._mainResource=null,this._mainResourceVersion=null,this._artworkResource=null,this._artworkResourceVersion=null,this._title=null,this._alias=null,this._tags=[],this._description=null,this._categoryId=null,this._subCategoryIds=[],this._creatorIds=[],this._undiscoverable=!1,this._isPrivate=!1,this._custom=null}get communityId(){return this._communityId}set communityId(e){this._communityId=e}get artworkComponentId(){return this._artworkComponentId}set artworkComponentId(e){this._artworkComponentId=e}get assetId(){return this._assetId}set assetId(e){this._assetId=e}get resourcePath(){return this._resourcePath}set resourcePath(e){this._resourcePath=e}get mainResource(){return this._mainResource}set mainResource(e){this._mainResource=e}get mainResourceVersion(){return this._mainResourceVersion}set mainResourceVersion(e){this._mainResourceVersion=e}get artworkResource(){return this._artworkResource}set artworkResource(e){this._artworkResource=e}get artworkResourceVersion(){return this._artworkResourceVersion}set artworkResourceVersion(e){this._artworkResourceVersion=e}get title(){return this._title}set title(e){this._title=e}get alias(){return this._alias}set alias(e){this._alias=e}get tags(){return this._tags}set tags(e){this._tags=this._tags.concat(e)}get description(){return this._description}set description(e){this._description=e}get categoryId(){return this._categoryId}set categoryId(e){this._categoryId=e}get subCategoryIds(){return this._subCategoryIds}set subCategoryIds(e){this._subCategoryIds=this._subCategoryIds.concat(e)}get creatorIds(){return this._creatorIds}set creatorIds(e){this._creatorIds=this._creatorIds.concat(e)}get undiscoverable(){return this._undiscoverable}set undiscoverable(e){this._undiscoverable=e}get isPrivate(){return this._isPrivate}set isPrivate(e){this._isPrivate=e}get custom(){return this._custom}set custom(e){this._custom=e}}let y=a.newDebug("dcx:dcxjs:sb"),D=()=>!0,C={disableRetry:!0},I="primary",v="http://ns.adobe.com/ccapi/manifest",b="http://ns.adobe.com/ccapi/manifest2",T="http://ns.adobe.com/ccapi/component",P="version-history",R="rendition",w=null,O=null;class k{constructor(e,t){this._maxRedirects=5,this._authenticationAllowList=["adobe.com","adobe.io","adobelogin.com","fotolia.net"],this._assetInfoCache={},this._assetIdResolutionTemplate=null,this.SYNC_ASYNC_DEFAULT_DELAY=5,this.ASYNC_DEFAULT_DELAY=1,this.DEFAULT_POLL_DELAY=10,this._service=e,this._server=t,t&&(this._endPoint=l.endPointOf(t))}get maxRedirects(){return this._maxRedirects}set maxRedirects(e){if("number"!=typeof e)throw new m.default(m.default.INVALID_PARAMS,"Expecting a number.");this._maxRedirects=Math.floor(e)}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new m.default(m.default.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}isValidHref(e){let t=l.endPointOf(e);return!t||t===this._endPoint}isDomainOnAllowList(e){y("isDomainOnAllowList");let t=l.parseURI(e).authority;if(!t||0===t.length)return!0;let r=t.length,s=this._authenticationAllowList.length;for(let e=0;e<s;e++){let s=this._authenticationAllowList[e],o=s.length;if((r>o?t.slice(-o):t)===s)return y("iDOAL true"),!0}return y("iDOAL false"),!1}getAsset(e,t,r,s){return this._getAsset(e,t,r,void 0,s)}_getAsset(e,t={},r,s,o){if(y("_getAsset()"),!(e=this._resolveUrl(e)))return void o(new m.default(m.default.WRONG_ENDPOINT,"Wrong endpoint: "+e));let i=s,n={};"string"==typeof t?n["if-none-match"]=t:l.merge(n,t);let a,c=0,u=(e,t)=>{if(y("_getAsset() respHandler",e,t),e)return void o(h.networkError("Error downloading an asset",e,t));let r=t.statusCode;if(200===r)o(void 0,t);else if(304===r)o(void 0,t);else if(301===r||302===r||303===r||307===r)if(!this._service.handlesRedirects&&this.maxRedirects)if(c<this.maxRedirects){let r=t.headers.location;r?a(r):o(h.unexpectedResponse("Missing location header in redirect response",e,t))}else o(h.unexpectedResponse("Too many redirects",e,t));else o(h.unexpectedResponse("Unexpected response getting an asset",e,t));else o(h.unexpectedResponse("Unexpected response getting an asset",e,t))};return(i=(a=t=>{let s={responseType:r,isStatusValid:D,retryOptions:C,autoParseJson:!1};return t&&(c++,s.reuseRequestDesc=i,this.isDomainOnAllowList(t)||(n.authorization=null)),this._service.invoke(d.HTTPMethods.GET,t||e,n,void 0,s,u)})()).progress=l.noOp,i}getAssetAsType(e,t,r,s){return this._getAssetAsType(e,t,r,void 0,void 0,void 0,s)}_cacheLinksFromResponse(e,t){if("string"==typeof e){let r=this._parseCachableLinks(t);if(Object.keys(r).length>0){let t=Object.assign({},this._assetInfoCache[e]||{},l.pruneUndefined(r));this._cacheInfoForAssetId(e,void 0,t)}}}_getAssetAsType(e,t,r,s,o,i,n){return y("_getAssetAsType"),this._getAsset(e,r,t,s,(e,t)=>{if(e)return n(e);if(200===t.statusCode){let e=t.response||t.responseText;null==i&&this._cacheLinksFromResponse(o,t),n(void 0,e,t.headers.etag,t)}else 304===t.statusCode?n(void 0,null,t.headers.etag,t):n(h.unexpectedResponse("Unexpected response getting asset",e,t))})}_getResourcePathFromHref(e,t){return y("_getResourcePathFromHref"),this._service.invoke(d.HTTPMethods.HEAD,e,{},void 0,{isStatusValid:D,retryOptions:C,autoParseJson:!1},(e,r)=>{if(y("_gRPFH invoked",e,r),e)return t(e);if(200===r.statusCode){let e=r.headers.link;if(e){let r=l.parse(e).get("rel","http://ns.adobe.com/ccapi/path");if(r&&r[0]&&r[0].uri)return t(void 0,r[0].uri)}}return t(h.unexpectedResponse("Unexpected response trying to retrieve path to asset.",void 0,r))})}resolveRootURLAsync(){y("resolveRootURLAsync()");let e=this._resolveUrl("/");return y("rRUA() rootHref",e),w=this._service.invoke(d.HTTPMethods.GET,e,{},void 0,{responseType:"text",isStatusValid:D,retryOptions:C,autoParseJson:!1}).then(e=>{if(y("rRUA() resolved",e),200!==e.statusCode)throw new m.default(m.default.UNEXPECTED_RESPONSE,"Resolve root URL did not succeed with 200",void 0,e);{let t=e.responseText||e.response;try{let e=JSON.parse(t),r=e._links?e._links["http://ns.adobe.com/ccapi/resolve/id"]:void 0;if(r)return{href:r.href,self:this}}catch(t){throw new m.default(m.default.INVALID_DATA,"Invalid JSON returned by server",t,e)}}}).catch(e=>{throw y("rRUA() rejected",e),e}),y("rRUA() rootReqDesc",w),w}getPromiseCacheInfo(e){return y("getPromiseCacheInfo()"),null!=O||(O=e())&&O.then&&O.then(()=>{y("gPCI() resolved"),O=null},()=>{y("gPCI() rejected"),O=null}),O}_parseCachableLinks(e){let t={};e.headers["content-location"];let r=e.headers.link;if(r){let e=l.parse(r),s=e.get("rel",I);s&&(t.primaryTemplate=s[0].uri),(s=e.get("rel",b))?t.manifestTemplate=s[0].uri:(s=e.get("rel",v))&&(t.manifestTemplate=s[0].uri),(s=e.get("rel",T))&&(t.componentTemplate=s[0].uri),(s=e.get("rel",P))&&(t.versionHistory=s[0].uri),(s=e.get("rel",R))&&(t.renditionTemplates=s)}return t}getCachedAssetInfo(e,t){y("getCachedAssetInfo()");let r=this._infoForAssetId(e);if(r)return y("gCAI() cached"),t(void 0,r);let s=this._awaitInfoForAssetId(e,t);if(y("gCAI() needs head req",s),s){let r,s=s=>{let o=l.expandURITemplate(s,{asset_id:e});if(!(o=this._resolveUrl(o)))return y("gCAI() no href"),t(new m.default(m.default.WRONG_ENDPOINT,"Wrong endpoint: "+o));let i={};return r&&y("gCAI() reuse RD",i={reuseRequestDesc:r}),r=this._service.invoke(d.HTTPMethods.HEAD,o,{},void 0,Object.assign(Object.assign({},i),{isStatusValid:D,retryOptions:C,autoParseJson:!1}),(t,r)=>{if(y("gCAI() resolveAssetId() resolved",t,r),t)return this._cacheInfoForAssetId(e,t);let s=r.statusCode;if(200===s){let t=this._parseCachableLinks(r);return this._cacheInfoForAssetId(e,void 0,t)}return 404===s?this._cacheInfoForAssetId(e,new m.default(m.default.ASSET_NOT_FOUND,"Asset not found",t,r)):this._cacheInfoForAssetId(e,h.unexpectedResponse("Unable to resolve asset id.",t,r))})};return this._assetIdResolutionTemplate?(y("gCAI() has resolution template"),s(this._assetIdResolutionTemplate)):(y("gCAI() get resolution template"),w=this.getPromiseCacheInfo(this.resolveRootURLAsync.bind(this)).then(e=>(y("gCAI() getPromiseCacheInfo() resolved",e),this._assetIdResolutionTemplate=e.href,s(e.self._assetIdResolutionTemplate))).catch(e=>(y("gCAI() getPromiseCacheInfo() rejected",e),t(new m.default(m.default.UNEXPECTED_RESPONSE,"Unable to retrieve asset id resolution link from root resource.",e,e.response)))),y("gCAI() rootReqDesc",w),w)}}registerLinks(e){e=e._links||e;let t={};t.assetId="urn:aaid:faux:"+l.generateUuid();let r=e[I];return r&&(t.primaryTemplate=r.href),(r=e[v])&&(t.manifestTemplate=r.href),(r=e[b])&&(t.manifestTemplate=r.href),(r=e[T])&&(t.componentTemplate=r.href),(r=e[P])&&(t.versionHistory=r.href),(r=e[R])&&(t.renditionTemplates=[{rel:"rendition",uri:r.href}]),this._assetInfoCache[t.assetId]=t,t.assetId}_infoForAssetId(e){let t=this._assetInfoCache[e];if(t&&!t.callbacks)return t}_awaitInfoForAssetId(e,t){y("_awaitInfoForAssetId");let r=this._assetInfoCache[e];return r?(y("_aIFA pending"),r.callbacks.push(t),!1):(y("_aIFA not pending"),(r={}).assetId=e,r.callbacks=[t],this._assetInfoCache[e]=r,!0)}_cacheInfoForAssetId(e,t,r){y("_cacheInfoForAssetId");let s=this._assetInfoCache[e];if(s){if(t){let r=s.callbacks;this._assetInfoCache[e]=void 0;for(let e=0;e<r.length;e++)r[e](t)}}else!t&&r&&(this._assetInfoCache[e]=s={});if(!t&&r&&(s.assetId||(s.assetId=e),s.primaryTemplate=r.primaryTemplate,s.manifestTemplate=r.manifestTemplate,s.componentTemplate=r.componentTemplate,s.versionHistory=r.versionHistory,s.renditionTemplates=r.renditionTemplates,s.callbacks)){for(let e=0;e<s.callbacks.length;e++)s.callbacks[e](void 0,s);s.callbacks=void 0}}_resolveUrl(e){return l.endPointOf(e)?e:l.appendPathElements(this._server,e)}_makeRelativeUrl(e){if(l.endPointOf(e)){let t=l.parseURI(e);(t.scheme||t.authority)&&(e=t.path,t.query&&(e+="?"+t.query),t.fragment&&(e+="#"+t.fragment))}return e}_parseAsyncResponse(e){y("_parseAsyncResponse");let t=e.responseText||e.response;if(!t)throw new m.default(m.default.INVALID_DATA,"No body data.");let r={},s=t.indexOf("\n");if(-1===s)throw new m.default(m.default.INVALID_DATA,"Could not find status line.");let o=t.slice(0,13===t.charCodeAt(s-1)?s-1:s).split(" ");if(r.statusCode=parseInt(o[1],10),!r.statusCode)throw new m.default(m.default.INVALID_DATA,"Could not find status code.");o.length>2&&(r.statusText=o[2]);let i=t.search(/\r?\n\r?\n/);-1===i&&(i=t.length);let n=t.slice(s+1,i);r.headers=l.parseHeaders(n);let a="\r"===t.charAt(i)?i+4:i+2;return r.response=t.slice(a),r}_pollForAsyncResponse(e,t,r,s){y("_pollForAsyncResponse");let o=Date.now()+1e3*t,i={responseType:"text",reuseRequestDesc:r,noSoonerThen:o,isStatusValid:D,retryOptions:C,autoParseJson:!1};a.log("asynchronous request - polling"),r=this._service.invoke(d.HTTPMethods.GET,e,void 0,void 0,i,(t,o)=>{if(t)return s(h.networkError("Error polling for an asynchronous reponse",t,o));let i=o.statusCode;if(202===i){let t;a.log("asynchronous request - not yet ready"),o.headers["retry-after"]&&(t=parseInt(o.headers["retry-after"],10)),this._pollForAsyncResponse(e,t||10,r,s)}else if(200===i){a.log("asynchronous request - success");try{o=this._parseAsyncResponse(o)}catch(e){return s(h.unexpectedResponse("Error parsing response body.",e,o))}200===(i=o.statusCode)||201===i||204===i?s(void 0,o):s(h.unexpectedResponse("Unexpected response polling for an asynchronous response",t,o))}else a.log("asynchronous request - error"),s(h.unexpectedResponse("Unexpected response polling for an asynchronous response",t,o))})}_handle202Response(e,t,r,s){let o;y("_handle202Response");let i=e.responseText||e.response;try{o=JSON.parse(i)}catch(t){return s(h.unexpectedResponse("Error parsing 202 response body.",t,e))}let n=o.href;if(!n)return s(h.unexpectedResponse("202 response missing an href.",void 0,e));let a=e.headers["retry-after"];a=a?parseInt(a,10):r,this._pollForAsyncResponse(this._resolveUrl(n),a,t,s)}}let S=()=>!0,N={disableRetry:!0},L="/content/2/",M=/^\/?content\/2\/[^\/]+\/[^\/]+/,X=/^\/?api\/v2\/[^\/]+\/assets\/[^\/]+/,x={"image/jpeg":"jpg","image/png":"png"};class B extends k{constructor(e,t){if(super(e,t),this.name="AdobeCommunitySession",!this._endPoint)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"Could not determine endpoint from: "+t)}publishCompositeAtResource(e,t,r){let s="/api/v2/"+t.communityId+"/assets";s=this._resolveUrl(s);let o={resource_path:this.assetIdFromSSResourceHref(t.resourcePath),resource_type:e,metadata:this.metadataFromPubRecord(t)},i={[d.HeaderKeys.CONTENT_TYPE]:d.JSONMediaType};return this._service.invoke(d.HTTPMethods.POST,s,i,JSON.stringify(o),{responseType:"text",autoParseJson:!1,isStatusValid:S,retryOptions:N},function(e,s){if(e)return r(h.networkError("Error publishing composite",e,s));if(201===s.statusCode){let o=s.headers.location;if(!o)return e=new h.AdobeDCXError(h.AdobeDCXError.INVALID_DATA,"Missing location header returned on response by server",void 0,s),r(h.unexpectedResponse("Unexpected response publishing composite",e,s));let i=function(e){let t=e.match("^.*?\\/api\\/v2\\/([^/]*)/assets\\/([^\\/]*).*$");return t?t[2]:null}(o);if(i)return t.assetId=i,r(void 0,o)}return r(h.unexpectedResponse("Unexpected response publishing composite",e,s))})}updateCpMetadataAtResource(e,t,r){let s="/api/v2/"+t.communityId+"/assets/"+t.assetId;s=this._resolveUrl(s);let o=this.metadataFromPubRecord(t),i={[d.HeaderKeys.CONTENT_TYPE]:d.JSONMediaType};return this._service.invoke(d.HTTPMethods.PUT,s,i,JSON.stringify(o),{responseType:"text",autoParseJson:!1,isStatusValid:S,retryOptions:N},(e,t)=>e?r(h.networkError("Error publishing composite",e,t)):200===t.statusCode?r(void 0,s):r(h.unexpectedResponse("Unexpected response publishing composite",e,t)))}getCpMetadata(e,t){let r="/api/v2/"+e.communityId+"/assets/"+e.assetId;r=this._resolveUrl(r),this._service.invoke(d.HTTPMethods.GET,r,{},void 0,{responseType:"text",autoParseJson:!1,isStatusValid:S,retryOptions:N},function(r,s){if(r)return t(h.networkError("Error getting metadata for CP composite",r,s));if(200===s.statusCode){let r,o=s.response||s;try{e.resourcePath=(r=JSON.parse(o)).resource_path,e.description=r.description||null,e.title=r.title||null,e.alias=r.alias||null,e.undiscoverable=r.undiscoverable||!1,e.isPrivate=r.private||!1;let t=r.tags;t&&null!==t&&t.length>0&&(e.tags=t);let s=r._embedded;if(s&&null!==s&&(t=r.creators)&&null!==t&&t.length>0){let r=[];for(let e=0;e<t.length;++e){let s=t[e];if(s&&null!==s){let e=s.id;e&&null!==e&&r.push(e)}}0!==r.length&&(e.creatorIds=r)}if((s=r.category_id)&&null!==s&&(e.categoryId=s.id||null),(t=r.sub_categories)&&null!==t&&t.length>0){e.subCategoryIds=[];for(let r=0;r<t.length;++r)s=t[r],e.subCategoryIds.push(s.id)}(s=r.custom)&&null!==s&&(e.custom=s)}catch(e){return t(new h.AdobeDCXError(h.AdobeDCXError.INVALID_DATA,"Invalid JSON returned by server",e,s))}return t(void 0,e)}return t(h.unexpectedResponse("Unexpected response while getting metadata for CP composite",r,s))})}updatePublicationRecordData(e,t){let r=t.versionId;if(e.mainResource="manifest",r&&(e.mainResourceVersion=r),null!==e.artworkComponentId){let r=t.getComponentWithId(e.artworkComponentId);if(null==r)throw new h.AdobeDCXError(h.AdobeDCXError.COMPONENT_DOWNLOAD_ERROR,"Bad component ID = "+e.artworkComponentId);let s=e.resourcePath;e.artworkResource=s=this.assetIdFromSSResourceHref(s)+r.absolutePath,e.artworkResourceVersion=r.version}}getCompositeManifestHref(e,t,r){if(t)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"AdobeCommunitySession does not support version manifests.");if(!e.assetId)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"Composite must be bound.");if(!this.isProperAssetId(e.assetId))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");let s=this._resolveUrl(e.assetId);if(!s)throw new h.AdobeDCXError(h.AdobeDCXError.WRONG_ENDPOINT,"Wrong endpoint: "+e.assetId);return r(void 0,l.appendPathElements(s,"manifest"))}getComponent(e,t,r){let s={},o=s;return this.getComponentHref(e,e.version,(e,i)=>e?r(e):(o=o||s,this._getAsset(i,void 0,t,o,r))),o||s}getRenditionOfComponent(e,t,r,s,o,i){let n={},a=n;return this.getComponentRenditionHref(e,e.version,t,r,s,(e,r)=>e?i(e):(a=a||n,this._getAsset(r,{accept:t},o,a,i))),a||n}getCompositeManifest(e,t,r,s){let o=e.assetId;return o&&(o=this._resolveUrl(o)),o?(o=l.appendPathElements(o,"manifest"),this.getAssetAsType(o,"text",r,s)):s(new h.AdobeDCXError(h.AdobeDCXError.WRONG_ENDPOINT,"Wrong endpoint: "+e.assetId))}headRequest(e,t){return this._service.invoke(d.HTTPMethods.HEAD,e,{},void 0,{responseType:"text",autoParseJson:!1,isStatusValid:S,retryOptions:N},function(e,r){if(e)return t(e);t(e,r)})}getComponentHref(e,t,r){let s=e._owner;if(!s||!s.compositeAssetId)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(s.compositeAssetId))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");if(s._core){let t=s._core._getSourceAssetInfoOfComponent(e);if(t)return void r(void 0,this._constructComponentHref(t.compositeAssetId,t.componentPath,t.componentVersion))}r(void 0,this._constructComponentHref(s.compositeAssetId,e.absolutePath,t))}getComponentRenditionHref(e,t,r,s,o,i){let n=e._owner;if(!n||!n.compositeAssetId)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(n.compositeAssetId))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");if(n._core&&n._core._getSourceAssetInfoOfComponent(e))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_STATE,"Getting a rendition of a source href not implemented.");return i(void 0,this._constructComponentRenditionHref(n.compositeAssetId,e.absolutePath,t,r,s,o))}isProperAssetId(e){return l.ensureRelativeHrefStartsWithSlash(e)}_constructComponentHref(e,t,r){let s=t.slice(1),o=l.appendPathElements(this._resolveUrl(e),s);return o&&void 0!==r&&(this._hrefUsesContentApis(e)?o+="/version/"+r:o+="?version="+r),o}_constructComponentRenditionHref(e,t,r,s,o,i){let n,a,d=t.slice(1),c=l.parseURI(e).path;if(c.slice(0,11)===L){let t=x[s];if(!t)throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"Unsupported rendition media type: "+s);if(!((n=M.exec(c))&&n.length>0))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"Failed to parse composite href: "+e);a=this._resolveUrl(l.appendPathElements(n[0],"rendition",d,"version",r,"format",t,"dimension",o,"size",String(i)))}else{if(!((n=X.exec(c))&&n.length>0))throw new h.AdobeDCXError(h.AdobeDCXError.INVALID_PARAMS,"Failed to parse composite href: "+e);a=this._resolveUrl(l.appendPathElements(n[0],"rendition",o,String(i),d)+"?version="+r)}return a}_hrefUsesContentApis(e){return l.parseURI(e).path.slice(0,11)===L}assetIdFromSSResourceHref(e){let t=e.match("^\\/pubs\\/([^\\/]*).*$");return t?t[1]:null}metadataFromPubRecord(e){let t={};if(null!==e.title&&(t.title=e.title),null!==e.description&&(t.description=e.description),null!==e.alias&&(t.alias=e.alias),t.undiscoverable=e.undiscoverable,e.isPrivate&&(t.private=e.isPrivate),Array.isArray(e.tags)&&(t.tags=[...e.tags]),Array.isArray(e.creatorIds)&&(t.creator_ids=[...e.creatorIds]),null!==e.categoryId&&(t.category_id=e.categoryId),Array.isArray(e.subCategoryIds)&&(t.sub_category_ids=[...e.subCategoryIds]),null!==e.custom&&(t.custom=e.custom),null!==e.mainResource&&null!==e.mainResourceVersion){let r={};r.resource_path=e.mainResource,r.resource_version=e.mainResourceVersion,t.main_resource=r}if(null!==e.artworkResource&&null!==e.artworkResourceVersion){let r={};r.resource_path=e.artworkResource,r.resource_version=e.artworkResourceVersion,t.artwork=r}return t}}function j(e,t,r,s){return new(r||(r=Promise))(function(o,i){function n(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((s=s.apply(e,t||[])).next())})}let U={unmodified:"unmodified",modified:"modified",pendingDelete:"pendingDelete",committedDelete:"committedDelete"},H={pending:"pending",active:"active",archived:"archived"},V={name:!0,id:!0,state:!0,path:!0,rel:!0,type:!0,etag:!0,length:!0,version:!0,md5:!0,width:!0,height:!0};class F{constructor(e,t=!1){this._readOnly=!1,this._data={},this.records={},e&&this._setData(e),this._readOnly=t}get compositeId(){return this._compositeId}get owner(){return this._owner}get data(){return this._data}get id(){return this._data.id}set id(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(this._owner)throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot change the id of a component that is part of a branch or element.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}get name(){return this._data.name}set name(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}get type(){return this._data.type}set type(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.type=e,this._setDirty()}get path(){return this._data.path}set path(e){if(this._data.path!==e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!l.isValidPath(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a valid path.");this._owner?this._owner._core._setPathOfComponent(this,e):(this._data.path=e,this._parentPath=""),this._setDirty()}}get parentPath(){return this._parentPath}set parentPath(e){throw new h.DCXError(h.DCXError.READ_ONLY,"parentPath is read-only.")}get absolutePath(){return this._data.path&&this._owner?l.appendPathElements(this._parentPath,this._data.path):void 0}set absolutePath(e){throw new h.DCXError(h.DCXError.READ_ONLY,"absolutePath is read-only.")}get relationship(){return this._data.rel}set relationship(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}get state(){return this._data.state}set state(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.keys(U).includes(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,this._setDirty()}get etag(){return this._data.etag}set etag(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.etag=e,this._setDirty()}get md5(){return this._data.md5}set md5(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.md5=e,this._setDirty()}get version(){return this._data.version}set version(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(void 0!==e&&"string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.version=e,this._setDirty()}get length(){return this._data.length}set length(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.length=e,this._setDirty()}get width(){return this._data.width}set width(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.width=e,this._setDirty()}get height(){return this._data.height}set height(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.height=e,this._setDirty()}get assetId(){return this._assetId}set assetId(e){if(e!==this._assetId){if(this._assetId)throw new h.DCXError(h.DCXError.INVALID_STATE,"assetId property cannot be changed.");this._assetId=e}}get repositoryId(){return this._repoId}set repositoryId(e){if(e!==this._repoId){if(this._repoId)throw new h.DCXError(h.DCXError.INVALID_STATE,"repoId property cannot be changed.");this._repoId=e}}getComponentDescriptor(){if(!d.isAdobeDCXBranchLike(this._owner))throw new h.DCXError(h.DCXError.INVALID_STATE,"Component must be part of a composite to get a descriptor.");return JSON.stringify({versionId:u.CURRENT_COMPONENT_DESCRIPTOR_VERSION,componentId:this.id,compositeId:this._owner.compositeId,cloudAssetId:this._owner.compositeAssetId,repositoryId:this.repositoryId||this._owner.compositeRepositoryId,componentRevisionId:this.version,type:this.type,size:this.length,etag:this.etag,hashType:u.CURRENT_COMPONENT_DESCRIPTOR_HASH_TYPE,hashValue:this.md5})}getCustomKeys(){let e=[],t=Object.keys(this._data),r=t.length;for(let s=0;s<r;s++){let r=t[s];V[r]||e.push(r)}return e}getValue(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');return this._data[e]}setValue(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');this._data[e]=t,this._setDirty()}removeValue(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');delete this._data[e],this._setDirty()}getLink(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0}setLink(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let r=this._data._links;r||(r=this._data._links={}),r[t]=e,this._setDirty()}removeLink(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())}isEqualTo(e,t){return l.objectsEqual(this._data,e._data,t)}_setData(e){let t=this._verify(e);if(null===t)return this._data=e,this;throw t}_setDirty(){this._owner&&this._owner._setDirty()}_verify(e){return"string"!=typeof e.id?new h.DCXError(h.DCXError.INVALID_DATA,"Component is missing an id of type string"):null}}F.STATES=U;class Y{constructor(e,t=!1,r=!1){this._data={},e&&this._setData(e),this._readOnly=t,this._isRoot=r}get owner(){return this._owner}get id(){return this._data.id}set id(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(this._owner)throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot change the id of a node that is part of a branch or element.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}get name(){return this._data.name}set name(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}get type(){return this._data.type}set type(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.type=e,this._setDirty()}get relationship(){return this._data.rel}set relationship(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}get path(){return this._isRoot?Y.ROOT_PATH:this._data.path}set path(e){if(e!==this.path){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(this._isRoot)throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot change the path of the root node.");if(e&&!l.isValidPath(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a valid path or undefined.");this._owner?this._owner._setPathOfNode(this,e||void 0):(this._data.path=e||void 0,this._parentPath=""),this._setDirty()}}get parentPath(){return this._parentPath}set parentPath(e){throw new h.DCXError(h.DCXError.READ_ONLY,"parentPath is read-only.")}get absolutePath(){let e=this.path;return this._isRoot?e:e&&this._owner?l.appendPathElements(this._parentPath,e):void 0}set absolutePath(e){throw new h.DCXError(h.DCXError.READ_ONLY,"absolutePath is read-only.")}get isRoot(){return this._isRoot}set isRoot(e){throw new h.DCXError(h.DCXError.READ_ONLY,"isRoot is read-only.")}getLink(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0}setLink(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let r=this._data._links;r||(r=this._data._links={}),r[t]=e,this._setDirty()}removeLink(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())}getCustomKeys(){let e=[],t=Object.keys(this._data),r=t.length;for(let s=0;s<r;s++){let r=t[s];(this._isRoot?W[r]:q[r])||e.push(r)}return e}getValue(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Illegal key");return this._data[e]}setValue(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Illegal key");this._data[e]=t,this._setDirty()}removeValue(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Illegal key");delete this._data[e],this._setDirty()}copy(){let e,t=this._data.children,r=this._data.components;try{t&&delete this._data.children,r&&delete this._data.components;let s=JSON.parse(JSON.stringify(this._data));e=new Y(s)}finally{t&&(this._data.children=t),r&&(this._data.components=r)}return e}isEqualTo(e,t,r){return this._isEqual(this._data,e._data,l.merge({children:!0,components:!0},t),r)}_isEqual(e,t,r,s){let o,i,n,a;if(!l.objectsEqual(e,t,r)||(i=e.components,n=t.components,(a=i?i.length:0)!==(n?n.length:0)))return!1;if(a){let e,t,r;for(o=0;o<a;o++){for(e=i[o],t=null,r=0;r<a;r++)if(e.id===n[r].id){t=n[r];break}if(!t||!l.objectsEqual(e,t,s))return!1}}if(i=e.children,n=t.children,(a=i?i.length:0)!==(n?n.length:0))return!1;if(a){for(o=0;o<a;o++)if(!this._isEqual(i[o],n[o],r,s))return!1}return!0}_setData(e){let t=this._verify(e);if(null===t)return this._data=e,this;throw t}_verify(e){return"string"!=typeof e.id?new h.DCXError(h.DCXError.INVALID_DATA,"Node is missing an id of type string"):null}_setDirty(){this._owner&&this._owner._setDirty()}}Y.ROOT_PATH="/";let W={components:!0,children:!0,"manifest-format-version":!0,id:!0,name:!0,type:!0,state:!0,local:!0},q={components:!0,children:!0,rel:!0,path:!0,id:!0,name:!0,type:!0};class z{constructor(e,t,r=!1){this._allNodes={},this._allComponents={},this._absolutePaths={},this._readOnly=!1,this._isDirty=!1,this._sourceAssetInfoLookup={},this._readOnly=r,this._owner=t,this._setData(e)}get allNodes(){return this._allNodes}get rootNode(){return this.getChildWithAbsolutePath(Y.ROOT_PATH)}set rootNode(e){throw new h.DCXError(h.DCXError.READ_ONLY,'Property "rootNode" is read-only.')}get isDirty(){return this._isDirty}set isDirty(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property isDirty.")}get changeCount(){return this._data.local&&this._data.local.change||0}set changeCount(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property changeCount.")}getChildWithId(e){return this._allNodes[e]}getChildWithAbsolutePath(e){let t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof Y?t:void 0}getChildrenOf(e){let t=e?this._allNodes[e.id]:this.rootNode;if(!t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown node");let r=[],s=t._data.children;if(Array.isArray(s))for(let e=0;e<s.length;e++){let t=s[e],o=this._allNodes[t.id];if(!o)throw new h.DCXError(h.DCXError.INVALID_DATA,"Node not in cache");r.push(o)}return r}addChild(e,t,r,s){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(t=t||l.generateUuid(),this._allNodes[t])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Node already exists in branch.");if(r&&("number"!=typeof r||r%1!=0))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "index" must be an integer.');let o=s?this._allNodes[s.id]:this.rootNode;if(!o)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");let i=new Y;i.id=t,e&&(i.name=e),i._parentPath=o.absolutePath||o._parentPath;let n=o._data.children;return n?(r>=0&&r<=n.length||(r=n.length),r===n.length?n[r]=i._data:n.splice(r,0,i._data)):o._data.children=[i._data],this._allNodes[i.id]=i,i._owner=this._owner,this._setDirty(),i}removeChild(e){let t=e;if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "node".');if(t.isRoot)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot remove the root node.");let r=t.id;if(!r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "node" must have an id.');let s=this._nodeDataOfParentOfNode(t);if(!s)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Node not found in this branch.");let o=s.parentNodeData.children;return o&&(o.splice(s.index,1),0===o.length&&delete s.parentNodeData.children),t=this._allNodes[r],this._removeNodeFromCachesRecursively(t._data),this._setDirty(),t}moveChild(e,t,r){let s=e;if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!s)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "node".');if(s.isRoot)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot move the root node.");if(t&&("number"!=typeof t||t%1!=0))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "index" must be an integer.');let o=s.id;if(!o)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "node" must have an id.');let i=this._nodeDataOfParentOfNode(s);if(s=this._allNodes[o],!i)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Node not found in this branch.");let n=r?this._allNodes[r.id]:this.rootNode;if(!n)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");if(this._nodeIdIsDescendantOf(n.id,s._data))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Must not create a cycle.");let a=i.parentNodeData.children.splice(i.index,1)[0];try{let e=n._data.children;e?(t>=0&&t<=e.length||(t=e.length),t===e.length?e[t]=a:e.splice(t,0,a)):n._data.children=[a]}catch(e){throw i.parentNodeData.children.splice(i.index,0,a),e}return 0===i.parentNodeData.children.length&&delete i.parentNodeData.children,this._setDirty(),this._allNodes[o]}copyChild(e,t,r,s,o,i){return this._copyChild(e,t,r,s,o,!1,i)}replaceChild(e,t,r,s){return this._copyChild(e,void 0,void 0,t,r||e.id,!0,s)}getMissingComponentsFromError(e){var t;return e.code!==h.DCXError.INCOMPLETE_COMPOSITE?[]:(null!=(t=e.response.response.report.failures.filter(e=>"MissingComponent"===e.rule))?t:[]).map(e=>this.getComponentWithId(e.component_id)||this.getComponentWithAbsolutePath(e.component_path)).filter(e=>e)}allComponents(){let e=[];for(let t in this._allComponents)Object.prototype.hasOwnProperty.call(this._allComponents,t)&&e.push(this._allComponents[t]);return e}getComponentWithId(e){return this._allComponents[e]}getComponentWithAbsolutePath(e){let t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof F?t:void 0}getComponentsOf(e){let t=e?this._allNodes[e.id]:this.rootNode;if(!t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown node");let r=[],s=t._data.components;if(Array.isArray(s)){let e;for(e=0;e<s.length;e++){let t=s[e],o=this._allComponents[t.id];if(!o)throw new h.DCXError(h.DCXError.INVALID_DATA,"Component not in cache");r[r.length]=o}}return r}addComponentWithComponentDescriptor(e,t,r,s=d.LinkRelation.COMPONENT,o){return this.addComponentWithUploadResults(t,s,r,o,u.uploadResultsFromComponentDescriptor(e))}addComponentWithUploadResults(e,t,r,s,o){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(o.compositeId!==this._owner.compositeId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");let i=Object.keys(o.records);if(1!==i.length)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Param uploadResults must contain records of exactly one component upload.");let n=o.records[i[0]],a=n.id;if(this._allComponents[a])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate component id: "+a);let l=s?this._allNodes[s.id]:this.rootNode;if(!l)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");let d=new F;d.id=a,d.name=e,d.type=n.type,d.relationship=t,d.path=r,d.state=U.unmodified,d.etag=n.etag,d.length=n.length,d.version=n.version,d.md5=n.md5;let c=this._normalizedAbsolutePathForItem(d,l);if(this._absolutePaths[c])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+c);d._parentPath=l.absolutePath||l._parentPath;let u=l._data.components;return u?u.push(d.data):l._data.components=[d.data],d._owner=this._owner,this._allComponents[a]=d,this._absolutePaths[c]=d,this._setDirty(),d}updateComponentWithUploadResults(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!(e=this._allComponents[e.id]))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown component.");if(t.compositeId!==this._owner.compositeId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Param uploadResults does not appear to be valid for this composite.");let r=t.records[e.id];if(!r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Param uploadResults does not contain an upload record for the given component.");return e.etag=r.etag,e.version=r.version,e.md5=r.md5,e.length=r.length,this._setSourceAssetInfoOfComponent(void 0,e),e.state=U.unmodified,this._setDirty(),e}removeComponent(e){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "component".');let t=e.id;if(!t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "component" must have an id.');let r=this._nodeDataOfParentOfComponent(e);if(!r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Component not found in this branch.");return r.parentNodeData.components.splice(r.index,1),0===r.parentNodeData.components.length&&delete r.parentNodeData.components,e=this._allComponents[t],delete this._allComponents[t],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._owner=void 0,e._parentPath="",this._setDirty(),e}moveComponent(e,t){if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "component".');let r=e.id;if(!r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "component" must have an id.');let s=this._nodeDataOfParentOfComponent(e);if(!s)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Component not found in this branch.");let o=t?this._allNodes[t.id]:this.rootNode;if(!o)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");let i=this._normalizedAbsolutePathForItem(e,o);if(this._absolutePaths[i])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+i);let n=s.parentNodeData.components.splice(s.index,1)[0],a=o._data.components;return a?a.push(n):o._data.components=[n],0===s.parentNodeData.components.length&&delete s.parentNodeData.components,e=this._allComponents[r],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._parentPath=o.absolutePath||o._parentPath,this._absolutePaths[i]=e,this._setDirty(),e}copyComponent(e,t,r,s,o){return this._copyComponent(e,t,r,s,!1,o)}replaceComponent(e,t,r,s){let o=this._copyComponent(e,void 0,t,r||e.id,!0,s);return r&&r!==e.id&&delete this._allComponents[e.id],o}_getHrefOfComponent(e){let t,r=this._getBranchOf(e).compositeHref;return r&&void 0!==e.version&&(t=l.appendPathElements(r,e.id)+";version="+e.version),t}_setSourceAssetInfoOfComponent(e,t){let r=t.id,s=this._sourceAssetInfoLookup;e?s[r]=e:s[r]&&delete s[r]}_getSourceAssetInfoOfComponent(e){let t=e.id,r=this._sourceAssetInfoLookup;if(r)return r[t]}_copySourceHrefsFrom(e){let t=e._sourceAssetInfoLookup,r=this.allComponents(),s=r.length;if(s&&t){let e=this._sourceAssetInfoLookup;for(let o=0;o<s;o++){let s=r[o].id;e[s]=t[s]}}}_getBranchOf(e){return e._owner?this._getBranchOf(e._owner):e}_isSameComposite(e){let t=this._getBranchOf(this),r=this._getBranchOf(e);return t._data.id===r._data.id&&t.compositeAssetId===r.compositeAssetId&&t.compositeRepositoryId===r.compositeRepositoryId}_stringify(e,t=!1){if(e){let e=this._data.local,r=null;try{delete this._data.local,r=JSON.stringify(this._data,void 0,t?2:void 0)}finally{e&&(this._data.local=e)}return r}return JSON.stringify(this._data,void 0,t?2:void 0)}_setData(e){let t=new Y(e,this._readOnly,!0);t._owner=this._owner,t._parentPath="";let r=t.id,s={},o={},i={};o[r]=t,i[Y.ROOT_PATH]=t;let n=(e,t)=>{let r,a,d=e.components;if(Array.isArray(d))for(let e=0;e<d.length;e++){let r=new F(d[e],this._readOnly);if(s[r.id])throw new h.DCXError(h.DCXError.INVALID_DATA,"Duplicate component id: "+r.id);if(r._owner=this._owner,r._parentPath=t,i[a=this._normalizedAbsolutePathForItem(r)])throw new h.DCXError(h.DCXError.INVALID_DATA,"Duplicate absolute path: "+a);if(!l.isValidAbsolutePath(a))throw new h.DCXError(h.DCXError.INVALID_DATA,"Invalid absolute component path: "+a);s[r.id]=r,i[a]=r}let c=e.children;if(Array.isArray(c))for(let e=0;e<c.length;e++){let s=c[e],d=new Y(s,this._readOnly);if(o[d.id])throw new h.DCXError(h.DCXError.INVALID_DATA,"Duplicate node id: "+d.id);if(r=d.path,d._owner=this._owner,d._parentPath=t,r){if(i[a=this._normalizedAbsolutePathForItem(d)])throw new h.DCXError(h.DCXError.INVALID_DATA,"Duplicate absolute path: "+a);if(!l.isValidAbsolutePath(a))throw new h.DCXError(h.DCXError.INVALID_DATA,"Invalid node absolute path: "+a);i[a]=d}o[d.id]=d,n(s,d.path?l.appendPathElements(t,d.path):t)}};return n(e,Y.ROOT_PATH),this._data=e,this._allComponents=s,this._allNodes=o,this._absolutePaths=i,this._isDirty=!1,this}_removeNodeFromCachesRecursively(e){let t=e.components;if(Array.isArray(t))for(let e=0;e<t.length;e++){let r=t[e].id,s=this._allComponents[r];delete this._allComponents[r],delete this._absolutePaths[this._normalizedAbsolutePathForItem(s)],s._owner=void 0}let r=e.children;if(Array.isArray(r))for(let e=0;e<r.length;e++)this._removeNodeFromCachesRecursively(r[e]);let s=e.id,o=this._allNodes[s];delete this._allNodes[s],o.path&&delete this._absolutePaths[this._normalizedAbsolutePathForItem(o)],o._owner=void 0}_local(){return this._data.local||(this._data.local={version:2}),this._data.local}_recursiveReset(e,t){let r=e.components;if(r)for(let e=r.length-1;e>=0;e--){let s=r[e];s.state===U.committedDelete?(delete r[e],delete this._allComponents[s.id],delete s._owner,this._setSourceAssetInfoOfComponent(void 0,s)):(delete s.etag,delete s.version,s.state=U.modified,t&&t(s))}let s=e.children;if(s)for(let e=0;e<s.length;e++)this._recursiveReset(s[e],t)}_nodeIdIsDescendantOf(e,t){let r=t.children;if(r)for(let t=0;t<r.length;t++){let s=r[t];if(s.id===e||this._nodeIdIsDescendantOf(e,s))return!0}return!1}_recursivelyGetAllComponentsOfChild(e,t=[]){let r=e._data||e,s=r.components;if(s){let e=s.length;for(let r=0;r<e;r++)t[t.length]=this._allComponents[s[r].id]}let o=r.children;if(o){let e=o.length;for(let r=0;r<e;r++)t=this._recursivelyGetAllComponentsOfChild(o[r],t)}return t}_nodeDataOfParentOfNode(e,t=this._data){let r=e._data.id,s=t.children;if(s)for(let o=0;o<s.length;o++){let i=s[o];if(i.id===r)return{parentNodeData:t,index:o};let n=this._nodeDataOfParentOfNode(e,i);if(n)return n}return null}_nodeDataOfParentOfComponent(e,t=this._data){let r=e._data.id,s=t.components;if(s){for(let e=0;e<s.length;e++)if(s[e].id===r)return{parentNodeData:t,index:e}}let o=t.children;if(o)for(let t=0;t<o.length;t++){let r=o[t],s=this._nodeDataOfParentOfComponent(e,r);if(s)return s}return null}_determineAbsolutePathChangesRecursively(e,t,r){let s=e.components;if(s)for(let e=0;e<s.length;e++){let o=s[e],i=this._allComponents[o.id];r.push({item:i,parentPath:t,absPath:l.appendPathElements(t,o.path)})}let o=e.children;if(o)for(let e=0;e<o.length;e++){let s=o[e],i=this._allNodes[s.id],n=s.path,a=n?l.appendPathElements(t,n):t;r.push({item:i,parentPath:t,absPath:n?a:void 0}),this._determineAbsolutePathChangesRecursively(s,a,r)}}_setPathOfNode(e,t){let r,s=t?l.appendPathElements(e._parentPath,t):e._parentPath,o=[{item:e,absPath:t?s:void 0}];this._determineAbsolutePathChangesRecursively(e._data,s,o);let i=l.flatCopy(this._absolutePaths);for(let e=0;e<o.length;e++){let t=o[e].item;t._data.path&&delete i[this._normalizedAbsolutePathForItem(t)]}for(let e=0;e<o.length;e++)if((r=o[e]).absPath){let e=r.absPath.toLowerCase();if(i[e])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+e);if(!l.isValidAbsolutePath(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Invalid absolute path: "+e);i[e]=r.item}for(let e=0;e<o.length;e++)(r=o[e]).parentPath&&(r.item._parentPath=r.parentPath);e._data.path=t,this._absolutePaths=i}_setPathOfComponent(e,t){if(!this._allComponents[e.id])throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown component.");let r=l.appendPathElements(e._parentPath,t).toLowerCase();if(this._absolutePaths[r])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path for component: "+r);if(!l.isValidAbsolutePath(r))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Invalid absolute path: "+r);delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._absolutePaths[r]=e,e._data.path=t}_setDirty(e=!1){if(!e){if(this._local().archivalState===H.pending||this._local().archivalState===H.archived)throw new h.DCXError(h.DCXError.INVALID_STATE,"Cannot modify an archived composite.");this._data.state!==U.pendingDelete&&this._data.state!==U.committedDelete||f.default.warn("Modifying deleted composite")}this._isDirty=!0,this._local().change=this.changeCount+1,e||this._data.state!==U.unmodified&&this._data.state||(this._data.state=U.modified)}_normalizedAbsolutePathForItem(e,t){return(t?l.appendPathElements(t.absolutePath||t._parentPath,e.path):e.absolutePath).toLowerCase()}_hasSameEndpoint(e){return!0}_copyComponent(e,t,r,s,o,i){l.validateParams(["component",e,"object"],["callback",i,"function",!0]);let n=e._owner._core;if(!n)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot copy, undefined component owner");let a=this._isSameComposite(n),d=a||this._hasSameEndpoint(e);if(n._local(),!d)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot copy between two different endpoints.");let c=function(e,t,r){G(e,t,a,d,!s)};if(!i)return this._copyComponentModel(e,t,o,r,s,c);try{i(void 0,this._copyComponentModel(e,t,o,r,s,c))}catch(e){i(h.DCXError.wrapError(h.DCXError.UNEXPECTED,"Unexpected error attempting to copy component model",e))}}_copyComponentModel(e,t,r,s,o,i){let n,a;if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "component".');let d=e._owner,c=new F(JSON.parse(JSON.stringify(e._data)));if(s?(c.path=s,c.id=o||l.generateUuid()):o&&(c.id=o),c._owner=this._owner,e.id===c.id&&this._isSameComposite(d._core)||(c.state=U.modified,c.etag=void 0,c.version=void 0,c.md5=void 0,c.length=void 0),this._allComponents[c.id]&&!r)throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Component already exists.");let u=this._allComponents[e.id];if(r&&!u)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Could not find existing component.");if(r){let e=this._nodeDataOfParentOfComponent(u);if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Parent node of existing component not found in this branch.");let t=e.parentNodeData.id;if(!(a=this._allNodes[t]))throw new h.DCXError(h.DCXError.INVALID_STATE,"Unknown parent node.");n=e.index}else if(!(a=t?this._allNodes[t.id]:this.rootNode))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");c._parentPath=a.absolutePath||a._parentPath;let p=this._normalizedAbsolutePathForItem(c),_=this._absolutePaths[p];if(_&&_!==u)throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+p);if(!l.isValidAbsolutePath(p))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Component path must be a valid path for a component.");let f=this._local();i&&i(e,c,f=l.deepCopy(f));let g=a._data.components;return r?g[n]=c.data:g?g.push(c.data):a._data.components=[c.data],this._data.local=f,this._allComponents[c.id]=c,this._absolutePaths[p]=c,this._setDirty(),c}_copyChild(e,t,r,s,o,i,n){if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Expecting param "node".');let a=e._owner._core,l=this._isSameComposite(a),d=l||this._hasSameEndpoint(e);if(a._local(),a._recursivelyGetAllComponentsOfChild(e).length>0&&!d)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot copy components between two different endpoints.");let c=(e,t,r)=>{G(e,t,l,d,!0)};if(!n)return this._copyChildModel(e,t,r,i,s,o,c);try{n(void 0,this._copyChildModel(e,t,r,i,s,o,c))}catch(e){n(e)}}_copyChildModel(e,t,r,s,o,i,n){let a;if(this._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");let d=e._owner,c=new Y(JSON.parse(JSON.stringify(e._data)));o?(c.path=o,c.id=i||l.generateUuid()):i&&(c.id=i),c._owner=this._owner,e.isRoot&&(delete c._data.local,delete c._data.state,delete c._data["manifest-format-version"]);let u=this._allNodes[c.id];if(u&&!s)throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Child node already exists.");if(s&&!u)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Could not find existing node to replace.");if(s){let e=this._nodeDataOfParentOfNode(u);if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Parent of existing node not found in this branch.");let t=e.parentNodeData.id;if(!(a=this._allNodes[t]))throw new h.DCXError(h.DCXError.INVALID_STATE,"Unknown parent node.");r=e.index}else if(!(a=t?this._allNodes[t.id]:this.rootNode))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown parent node.");if(c._parentPath=a.absolutePath||a._parentPath,c.path){let e=this._normalizedAbsolutePathForItem(c),t=this._absolutePaths[e];if(t&&t!==u)throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+e);if(!l.isValidAbsolutePath(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Node path must be a valid path for a node.")}let p=l.flatCopy(this._allNodes),_=l.flatCopy(this._allComponents),f=l.flatCopy(this._absolutePaths),g=l.deepCopy(this._local()),m=function(e,t,r,s,o,i){let n,a;delete r[e.id],e.path&&delete o[t._normalizedAbsolutePathForItem(e)];let l=e._data.children;if(l)for(a=l.length,n=0;n<a;n++)m(r[l[n].id],t,r,s,o);let d=e._data.components;if(d)for(a=d.length,n=0;n<a;n++){let e=s[d[n].id];delete s[e.id],delete o[t._normalizedAbsolutePathForItem(e)]}};u&&m(u,this,p,_,f);let E=(e,t,r,s,o,i,a)=>{let c;if(r[e.id])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate node id: "+e.id);if(r[e.id]=e,e.path){if(o[c=t._core._normalizedAbsolutePathForItem(e)])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+c);o[c]=e}let u=e._data.children;if(u){let n=u.length;for(let a=0;a<n;a++){let n=new Y(u[a]);r[n.id]&&(n.id=l.generateUuid()),n._owner=t,n._parentPath=e.absolutePath||e._parentPath,E(n,t,r,s,o,i)}}let p=e._data.components;if(p){let r=p.length;for(let a=0;a<r;a++){let r=new F(p[a]),u=r.id;if(s[u]&&(r.id=l.generateUuid(),r.state=U.modified,r.etag=void 0,r.version=void 0,r.md5=void 0,r.length=void 0),r._owner=t,r._parentPath=e.absolutePath||e._parentPath,n&&n(d.getComponentWithId(u),r,i),s[r.id])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate component id: "+r.id);if(s[r.id]=r,o[c=t._core._normalizedAbsolutePathForItem(r)])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+c);o[c]=r}}};if(E(c,this._owner,p,_,f,g,d._local()),s)a._data.children[r]=c._data;else{let e=a._data.children;e?(r>=0&&r<=e.length||(r=e.length),r===e.length?e[r]=c._data:e.splice(r,0,c._data)):a._data.children=[c._data]}return this._allNodes=p,this._allComponents=_,this._absolutePaths=f,this._data.local=g,this._setDirty(),c}_verifyIntegrity(e,t,r){let s=[],o=!1,i=e=>(s.push(new h.DCXError(h.DCXError.INVALID_STATE,e)),t&&(o||(t("Branch for composite "+this.rootNode.id+" has the following errors:"),o=!0),t("   "+e)),!1),n=function(e,t){return!!e||i(t)},a=[],d=function(e){(0>a.indexOf(e)||i("Item "+e.id+" encountered more than once"))&&a.push(e)},c=l.flatCopy(this._allComponents),u=l.flatCopy(this._allNodes),p=l.flatCopy(this._absolutePaths),_=Object.keys(p),f=_.length;for(let e=0;e<f;e++){let t=_[e];n("/"===t.charAt(0),"Absolute path "+t+" does not start with a slash.")}let g=(e,t)=>{let r,s,o=e.children;if(o)for(r=0;r<o.length;r++){let e=o[r],a=u[e.id];(a||i("Node "+e.id+" is not in cache."))&&(d(a),n(a._data===e,"Node "+a.id+" _data property incorrect."),delete u[a.id],a.path&&a._owner&&(p[s=this._normalizedAbsolutePathForItem(a)]||i("Absolute path of node "+a.id+" ("+s+") is not in cache."))&&delete p[s],n(a._parentPath===t,"Parent path of node "+a.id+" should be "+t+" but is "+a._parentPath),n(a._owner===this._owner,"Node "+a.id+" _owner property is not correct.")),g(e,e.path?l.appendPathElements(t,e.path):t)}let a=e.components;if(a)for(r=0;r<a.length;r++){let e=a[r],o=c[e.id];(o||i("Component "+e.id+" is not in cache."))&&(d(o),n(o._data===e,"Component "+o.id+" _data property incorrect."),delete c[o.id],o._owner&&(p[s=this._normalizedAbsolutePathForItem(o)]||i("Absolute path "+s+" is not in cache."))&&delete p[s],n(o._parentPath===t,"Parent path of component "+o.id+" should be "+t+" but is "+o._parentPath),n(o._owner===this._owner,"Component "+o.id+" _owner property is not correct."))}},m=p[Y.ROOT_PATH];n(m,"Cannot find root node via path")&&(n(m.id===this._data.id,"Root node has correct id"),n(m.path===Y.ROOT_PATH,"Root node has correct path"),n(""===m._parentPath,"Root node has correct parent path"),n(m._owner===this._owner,"Root node has correct owner"),n(m._data===this._data,"Root node has correct data"),n(u[m.id]===m,"Cannot find root node via id")&&delete u[m.id],delete p[Y.ROOT_PATH]),g(this._data,Y.ROOT_PATH);let E=Object.keys(c);for(let e=0;e<E.length;e++)i("Component "+E[e]+" is in cache but could not be found.");E=Object.keys(u);for(let e=0;e<E.length;e++)i("Node "+E[e]+" is in cache but could not be found.");E=Object.keys(p);for(let e=0;e<E.length;e++)i("Absolute path "+E[e]+" is in cache but could not be found.");return s.length?s:null}}function G(e,t,r,s,o,i,n){if(!t._owner||!e._owner)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Failed to update storage for copied component, missing target or source branch core.");let a=t._owner._core,d=e._owner._core,c=r&&e.id===t.id,u=d._getSourceAssetInfoOfComponent(e),p=a.getComponentWithId(t.id),_=s&&(!p||!p.etag)&&e.state===U.unmodified,f=!c&&!u;if(o&&!p&&(u||f)&&e.id===t.id&&(t._data.id=l.generateUuid(),t.state=U.modified,t.etag=void 0,t.version=void 0,t.md5=void 0,t.length=void 0),f){if(_&&e._owner.compositeAssetId)u={compositeAssetId:e._owner.compositeAssetId,componentId:e.id,componentVersion:e.version,componentPath:e.absolutePath,repositoryId:e._owner.compositeRepositoryId},a._setSourceAssetInfoOfComponent(u,t);else if(f)throw new h.DCXError(h.DCXError.INVALID_STATE,"Could not use server-to-server copy for component "+e.id)}else a._setSourceAssetInfoOfComponent(u,t);u&&(t.state=U.modified)}class K{constructor(e,t,r=!1){(this._owner=t,e)?this._setData(e,r):(e={id:l.generateUuid()},this._core=new z(e,this,r),this._data=e)}get owner(){return this._owner}get rootNode(){return this._core.rootNode}get name(){return this._core.rootNode.name}set name(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}get type(){return this._core.rootNode.type}set type(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}get compositeAssetId(){return this._owner?this._owner.compositeAssetId:void 0}set compositeAssetId(e){throw new h.DCXError(h.DCXError.READ_ONLY,'Property "compositeAssetId" is read-only.')}get compositeRepositoryId(){return this._owner?this._owner.compositeRepositoryId:void 0}set compositeRepositoryId(e){throw new h.DCXError(h.DCXError.READ_ONLY,'Property "compositeRepositoryId" is read-only.')}get _isDirty(){return this._core._isDirty}set _isDirty(e){this._core._isDirty=e}get isDirty(){return this._isDirty}get changeCount(){return this._core.changeCount}getChildWithId(e){return this._core.getChildWithId(e)}getChildWithAbsolutePath(e){return this._core.getChildWithAbsolutePath(e)}getChildrenOf(e){return this._core.getChildrenOf(e)}addChild(e,t,r,s){return this._core.addChild(e,t,r,s)}removeChild(e){return this._core.removeChild(e)}moveChild(e,t,r){return this._core.moveChild(e,t,r)}copyChild(e,t,r,s,o,i){return this._core.copyChild(e,t,r,s,o,i)}allComponents(){return this._core.allComponents()}getComponentWithId(e){return this._core.getComponentWithId(e)}getComponentWithAbsolutePath(e){return this._core.getComponentWithAbsolutePath(e)}getComponentsOf(e){return this._core.getComponentsOf(e)}getMissingComponentsFromError(e){return this._core.getMissingComponentsFromError(e)}addComponentWithUploadResults(e,t,r,s,o){return this._core.addComponentWithUploadResults(e,t,r,s,o)}addComponentWithComponentDescriptor(e,t,r,s,o){return this._core.addComponentWithComponentDescriptor(e,t,r,s,o)}updateComponentWithUploadResults(e,t){return this._core.updateComponentWithUploadResults(e,t)}removeComponent(e){return this._core.removeComponent(e)}moveComponent(e,t){return this._core.moveComponent(e,t)}copyComponent(e,t,r,s,o){return this._core.copyComponent(e,t,r,s,o)}parse(e){let t;if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "data" must be a string');try{t=JSON.parse(e)}catch(e){throw new h.DCXError(h.DCXError.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message,e)}return this._setData(t,this._core._readOnly)}copy(){return new K(JSON.parse(JSON.stringify(this._data)),this._owner)}_verify(e){return"string"!=typeof e.id?new h.DCXError(h.DCXError.INVALID_DATA,"Element is missing an id of type string"):"string"!=typeof e.name?new h.DCXError(h.DCXError.INVALID_DATA,"Element is missing a name of type string"):"string"!=typeof e.type?new h.DCXError(h.DCXError.INVALID_DATA,"Element is missing a type of type string"):null}_setData(e,t){let r=this._verify(e);if(null===r)return this._core=new z(e,this,t),this._data=e,this;throw r}_local(){return this._core._local()}_setDirty(e){this._core._setDirty(e)}_setPathOfNode(e,t){this._core._setPathOfNode(e,t)}_verifyIntegrity(e,t,r){return this._core._verifyIntegrity(e,t,r)}}(s=o||(o={}))[s.NONE=0]="NONE",s[s.COPY=1]="COPY";let $=a.newDebug("dcx:dcxjs:dcxbranch");class J{constructor(e,t,r,s){(this._derivationType=o.NONE,e)?this._setData(e,t,r,s):(e={"manifest-format-version":6,id:l.generateUuid()},this.originalManifestFormatVersion=6,this._core=new z(e,this,t),this._core._compositeAssetId=r,this._core._compositeRepositoryId=s,this._data=e),this._pendingElements=[]}get data(){return this._data}set data(e){this._data=e}get compositeId(){return this._core.rootNode.id}set compositeId(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");if(t.allNodes[e])throw new h.DCXError(h.DCXError.DUPLICATE_VALUE,"There is already a node with the same id.");delete t.allNodes[this._data.id],this._data.id=e,t.allNodes[e]=this._core.rootNode,t._setDirty()}get rootNode(){return this._core.rootNode}set rootNode(e){this._core.rootNode=e}get name(){return this._core.rootNode.name}set name(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}get type(){return this._core.rootNode.type}set type(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}get compositeAssetId(){return this._core._compositeAssetId}set compositeAssetId(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t._compositeAssetId=e}get compositeRepositoryId(){return this._core._compositeRepositoryId}set compositeRepositoryId(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");l.validateParams(["repoId",e,"string",!0]),t._compositeRepositoryId=e}get compositeLinks(){return this._core._compositeLinks}set compositeLinks(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");l.validateParams(["links",e,"object",!0]),t._compositeLinks=e}get _isRepoComposite(){return!!this._core._compositeRepositoryId}get _collaborationType(){return this._data.local?this._data.local.collaborationType:void 0}set _collaborationType(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");e?t._local().collaborationType=e:delete t._local().collaborationType,t._setDirty(!0)}get _clientDataString(){return this._data.local?this._data.local.clientDataString:void 0}set _clientDataString(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");e?t._local().clientDataString=e:delete t._local().clientDataString,t._setDirty(!0)}get manifestEtag(){return this._data.local?this._data.local.manifestEtag:void 0}set manifestEtag(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t._local().manifestEtag=e,t._setDirty(!0)}get compositeState(){return this._data.state||U.unmodified}set compositeState(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.values(U).includes(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');if(this._isRepoComposite&&(e===U.pendingDelete||e===U.committedDelete))throw new h.DCXError(h.DCXError.INVALID_STATE,"R-API composites must be deleted in one step using RepoAPISession.");if(!(this._isRepoComposite||e!==U.pendingDelete&&e!==U.committedDelete||this.compositeArchivalState!==H.pending)||this.compositeArchivalState===H.archived)throw new h.DCXError(h.DCXError.INVALID_STATE,"Cannot delete an archived composite.");this._data.state=e,t._setDirty(!0)}get compositeArchivalState(){return this._core._local().archivalState||H.active}set compositeArchivalState(e){let t=this._core;if(t._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.values(H).includes(e))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'State must be "pending", "archived", or "active".');if(this._isRepoComposite&&e===H.pending)throw new h.DCXError(h.DCXError.INVALID_STATE,"R-API composites must be discarded in one step using RepoAPISession#discardAsset.");if(this.compositeArchivalState===H.archived)throw new h.DCXError(h.DCXError.INVALID_STATE,"Composite has already been archived.");if(e!==H.active&&(this.compositeState===U.pendingDelete||this.compositeState===U.committedDelete))throw new h.DCXError(h.DCXError.INVALID_STATE,"Cannot archive a deleted composite.");e===H.active?delete this._core._local().archivalState:this._core._local().archivalState=e,t._setDirty(!0)}get isBound(){return!(!this.manifestEtag||!this.compositeAssetId)}set isBound(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property isBound. Use resetIdentity instead.")}get versionId(){return this._versionId}set versionId(e){if(this._core._readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");this._versionId=e}get _isDirty(){return this._core._isDirty}set _isDirty(e){this._core._isDirty=e}get isDirty(){return this._core.isDirty}set isDirty(e){this._core.isDirty=e}get localData(){return this._core._stringify(!1,!0)}set localData(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property localData.")}get remoteData(){return this._core._stringify(!0)}set remoteData(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property remoteData.")}get pendingElements(){return this._pendingElements}set pendingElements(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property pendingElements.")}get changeCount(){return this._core.changeCount}set changeCount(e){this._core.changeCount=e}get readOnly(){return this._core._readOnly}set readOnly(e){this._core._readOnly=e}static _newBranchAsCopyOfCore(e){$("_newBranchAsCopyOfCore()");let t=new J(JSON.parse(JSON.stringify(e._data))),r=t._core;return r._sourceCompositeInfo={links:e._compositeLinks,repositoryId:e._compositeRepositoryId,assetId:e._compositeAssetId},t._resetIdentity(function(t){let s=e.getComponentWithId(t.id);if(!s)throw new h.DCXError(h.DCXError.INVALID_STATE,"Could not find original component.");if(s.state===U.modified||!s.etag)throw new h.DCXError(h.DCXError.INVALID_STATE,"Cannot create a new composite from a branch that contains modified or unbound components.");let o=s._owner.compositeAssetId;if(!o)throw new h.DCXError(h.DCXError.INVALID_STATE,"Cannot make a copy of component of a composite that has not been bound with an asset id. Component id ="+s.id);let i=s._owner.compositeRepositoryId;$("_nBACOC() origAssetId",o),$("_nBACOC() origRepositoryId",i),$("_nBACOC() resetComponent",t),r._setSourceAssetInfoOfComponent({compositeAssetId:o,componentId:s.id,componentVersion:s.version,componentPath:s.absolutePath,repositoryId:i},t)}),t}parse(e){let t;if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Param "data" must be a string');try{t=JSON.parse(e)}catch(e){throw new h.DCXError(h.DCXError.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message,e)}return this._setData(t,this._core._readOnly,this._core._compositeAssetId,this._core._compositeRepositoryId)}getElementWithId(e){return this._createElement(this._core.getChildWithId(e))}getElementWithAbsolutePath(e){return this._createElement(this._core.getChildWithAbsolutePath(e))}addElement(e,t,r,s,o,i){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Element must have a name of type string");if("string"!=typeof t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Element must have a type of type string");if("string"!=typeof r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Element must have a path of type string");let n=this._core.addChild(e,s,o,i);try{n.path=r}catch(e){throw this._core.removeChild(n),e}return n._data.type=t,this._createElement(n)}updateElement(e){let t=this.getChildWithId(e.rootNode.id);if(!t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Element does not exist in branch.");let r=this._core.replaceChild(e.rootNode,t.path);return this._deleteElement(e),r}abandonElement(e){this._deleteElement(e)}getChildWithId(e){return this._core.getChildWithId(e)}getChildWithAbsolutePath(e){return this._core.getChildWithAbsolutePath(e)}getChildrenOf(e){return this._core.getChildrenOf(e)}addChild(e,t,r,s){return this._core.addChild(e,t,r,s)}removeChild(e){return this._core.removeChild(e)}moveChild(e,t=null,r=null){return this._core.moveChild(e,t,r)}copyChild(e,t,r,s,o,i){return this._core.copyChild(e,t,r,s,o,i)}replaceChild(e,t,r,s){return this._core.replaceChild(e,t,r,s)}allComponents(){return this._core.allComponents()}getComponentWithId(e){return this._core.getComponentWithId(e)}getComponentWithAbsolutePath(e){return this._core.getComponentWithAbsolutePath(e)}getComponentsOf(e){return this._core.getComponentsOf(e)}getMissingComponentsFromError(e){return this._core.getMissingComponentsFromError(e)}addComponentWithUploadResults(e,t,r,s,o){return this._core.addComponentWithUploadResults(e,t,r,s,o)}addComponentWithComponentDescriptor(e,t,r,s,o){return this._core.addComponentWithComponentDescriptor(e,t,r,s,o)}updateComponentWithUploadResults(e,t){return this._core.updateComponentWithUploadResults(e,t)}removeComponent(e){return this._core.removeComponent(e)}moveComponent(e,t){return this._core.moveComponent(e,t)}copyComponent(e,t,r,s,o){return this._core.copyComponent(e,t,r,s,o)}replaceComponent(e,t,r,s){return this._core.replaceComponent(e,t,r,s)}copy(){let e=new J(JSON.parse(JSON.stringify(this._data)),!1,this._core._compositeAssetId,this._core._compositeRepositoryId);if(e._derivationType=this._derivationType,e._derivationDatetime=this._derivationDatetime,this._core._sourceAssetInfoLookup){let t=JSON.stringify(this._core._sourceAssetInfoLookup);e._core._sourceAssetInfoLookup=JSON.parse(t)}return e}_isNodeLike(e){return l.isObject(e)}_createElement(e){if(!e)return;let t=JSON.parse(JSON.stringify(e._data));t["manifest-format-version"]=this._data["manifest-format-version"],delete t.path;let r=new K(t,this,this._core._readOnly);return this._pendingElements.push(r),r}_deleteElement(e){let t=this._pendingElements.indexOf(e);if(t<0)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unknown element.");this._pendingElements.splice(t,1)}_verify(e){return"string"!=typeof e.id?new h.DCXError(h.DCXError.INVALID_DATA,"Manifest is missing an id of type string"):"string"!=typeof e.name?new h.DCXError(h.DCXError.INVALID_DATA,"Manifest is missing a name of type string"):"string"!=typeof e.type?new h.DCXError(h.DCXError.INVALID_DATA,"Manifest is missing a type of type string"):"number"!=typeof e["manifest-format-version"]?new h.DCXError(h.DCXError.INVALID_DATA,"Manifest is missing a manifest-format-version of type number"):null}_setData(e,t,r,s){this.originalManifestFormatVersion=e["manifest-format-version"],function(e){let t=e["manifest-format-version"];if(t<6){if(t<4)throw new h.DCXError(h.DCXError.INVALID_DATA,"Encountered manifest format version "+e["manifest-format-version"]+". Format version conversion not yet implemented for that version.");t<6&&function e(t,r=!1){r&&t.path&&delete t.path;let s=t.components;if("object"==typeof s)for(let e=0;e<s.length;e++){let t=s[e];"number"==typeof t.version&&(t.version=t.version.toString())}let o=t.children;if("object"==typeof o)for(let t=0;t<o.length;t++)e(o[t])}(e,!0)}}(e),e.local&&(e.local.version=2);let o=this._verify(e);if(null===o)return e["manifest-format-version"]=6,this._core=new z(e,this,t),this._core._compositeAssetId=r,this._core._compositeRepositoryId=s,this._data=e,this;throw o}_reset(e,t){if(this.readOnly)throw new h.DCXError(h.DCXError.READ_ONLY,"This object is read-only.");this._data.local&&(delete this._data.local.manifestEtag,delete this._core._compositeAssetId,delete this._core._compositeRepositoryId),e||(this._data.id=l.generateUuid()),this._data.state=U.modified,this._core._recursiveReset(this._data,t),this._core._setDirty()}_resetBinding(e){this._reset(!0,e)}_resetIdentity(e){this._reset(!1,e)}_local(){return this._core._local()}_setDirty(e){this._core._setDirty(e)}_setPathOfNode(e,t){this._core._setPathOfNode(e,t)}_verifyIntegrity(e,t,r){return this._core._verifyIntegrity(e,t,r)}}let Z=a.newDebug("dcx:dcxjs:dcxcomposite"),Q={PRIVATE:void 0,SHARED_BY_USER:"sharedByUser",SHARED_WITH_USER:"sharedWithUser"};class ee{constructor(e,t,r,s,o,i={}){this._collaborationType=Q.PRIVATE,null!=o&&"object"==typeof o&&(i=o,o=void 0),this._repoId=o,this._current=new J,o&&(this._current.compositeRepositoryId=o),(e||""===e)&&(this._current.data.name=e),t&&(this._current.data.type=t),r&&(this._current.compositeId=r),this._current._collaborationType=this._collaborationType,this._current.data.state=U.modified,this._current._setDirty(!0),this._options=i,s&&(this._assetId=s,this._current.compositeAssetId=s,(e||""===e)&&(this._name=e),t&&(this._type=t),r&&(this._id=r)),this._options.xhrBaseBranchSupport&&(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0)}get href(){return this._href}set href(e){this._href=e}get links(){return this._links}set links(e){l.validateParams(["links",e,"object"]),this._current&&(this._current.compositeLinks=e),this._links=e}get repositoryId(){return this._current?this._current.compositeRepositoryId:this._repoId}set repositoryId(e){l.validateParams(["repoId",e,"string"]),this._current&&(this._current.compositeRepositoryId=e),this._repoId=e}get id(){return this._current?this._current.compositeId:this._id}set id(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeId=e),this._id=e}get name(){return this._current?this._current.name:this._name}set name(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.name=e),this._name=e}get type(){return this._current?this._current.type:this._type}set type(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.type=e),this._type=e}get assetId(){return this._current?this._current.compositeAssetId:this._assetId}set assetId(e){if("string"!=typeof e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeAssetId=e),this._assetId=e}get collaborationType(){return this._current?this._current._collaborationType:this._collaborationType}set collaborationType(e){if(e!==Q.PRIVATE&&e!==Q.SHARED_BY_USER&&e!==Q.SHARED_WITH_USER)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Invalid value: ."+e);this._current&&(this._current._collaborationType=e),this._collaborationType=e}get clientDataString(){return this._current?this._current._clientDataString:this._clientDataString}set clientDataString(e){if("string"!=typeof e&&void 0!==e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Invalid clientDataString: must be a string or undefined.");let t=this._options.maxClientDataLength||1024;if(e&&e.length>t)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Invalid clientDataString: cannot be greater than 1KB");this._current&&(this._current._clientDataString=e),this._clientDataString=e}get isBound(){return!!(this._current&&this._current.isBound||!this._current&&this._assetId)}set isBound(e){throw new h.DCXError(h.DCXError.READ_ONLY,"Cannot set the property isBound. Use resetIdentity or resetBinding instead.")}get current(){return this._current}set current(e){throw new h.DCXError(h.DCXError.READ_ONLY,'Property "current" is read-only.')}static newCompositeAsCopyOf(e,t,r,s,i){let n=e._core;if(n||e.current&&(n=e.current._core),!n)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"compositeBranchOrElement must be a branch, an element or a composite with a current branch.");let a=new ee(void 0,void 0,void 0,void 0,void 0,i);return a._current=J._newBranchAsCopyOfCore(n),a._current._derivationType=o.COPY,a._current._derivationDatetime=(new Date).toISOString(),a.id=s||l.generateUuid(),t&&(a.name=t),r&&(a.type=r),a}loadBaseBranch(e){let t,r;if(!this._baseBranchData)throw new h.DCXError(h.DCXError.NO_BASE_BRANCH_DATA,"No base branch data.");try{if(r=new J(void 0,!0,this.assetId).parse(this._baseBranchData),!e)return E.default.resolve(r)}catch(r){if(!e)return E.default.reject(r);t=r}e(t,r)}resolvePullWithBranch(e,t){if(!e)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Need a branch.");if(e===this._current)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Cannot resolve current.");if(this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pulledBranchData,this._pulledBranchData=void 0),e.readOnly=!1,e._collaborationType=this.collaborationType,e._clientDataString=this.clientDataString,this._current=e,!t)return this._current;t(void 0,this._current)}acceptPush(e){let t,r=this._pushJournal;if(r)try{r.applyToBranch(this._current,!0),this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pushedBranchData,this._pushedBranchData=void 0),this._pushJournal=void 0,e&&e()}catch(e){t=e}else e&&e();if(t){if(!e)throw t;e(t)}if(!e)return this._current}resetBinding(e){delete this._assetId,this._current&&this._current._resetBinding(),this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e()}resetIdentity(e){delete this._assetId,this._current?(this._current._resetIdentity(),this._id=this._current.compositeId):this._id=l.generateUuid(),this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e()}_setPath(e){this._path=e}get _isRepoComposite(){return l.isObject(this._current)&&"boolean"==typeof this._current._isRepoComposite?this._current._isRepoComposite:!!this.repositoryId}}function et(e,t,r){if(Z("convertToDCXComposite()"),e.format&&!e.format.endsWith("+dcx"))throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Format must end in "+dcx"');return new ee(e.name,e.format,t,e.assetId,e.repositoryId,r)}ee.COLLABORATION=Q;class er{constructor(){this._originURL=null,this._manageUIURL=null,this._licenseType=null,this._licenseUrl=null,this._attributionURL=null,this._attributionName=null}get originURL(){return this._originURL}set originURL(e){this._originURL=e}get manageUIURL(){return this._manageUIURL}set manageUIURL(e){this._manageUIURL=e}get licenseType(){return this._licenseType}set licenseType(e){this._licenseType=e}get licenseUrl(){return this._licenseUrl}set licenseUrl(e){this._licenseUrl=e}get attributionURL(){return this._attributionURL}set attributionURL(e){this._attributionURL=e}get attributionName(){return this._attributionName}set attributionName(e){this._attributionName=e}}let es=(e,t)=>`It looks like you're using a ${e} bundle in a ${t} environment. \r
This may lead to unexpected results. 

See https://git.corp.adobe.com/DMA/dcx-js/blob/dev/docs/guides/bundles.md for main field definitions.`;class eo{constructor(e,t,r){this._aborted=!1,this._session=e,this._callback=t,this._cleanup=r,this._componentsPending=0,this._bytesTransfered=0,this._bytesTotal=0,this._onProgress=l.noOp,this._reportProgress=e=>{if(e>0){this._bytesTransfered+=e;let t=this._onProgress;t&&t(this._bytesTransfered,this._bytesTotal)}}}get xferComplete(){return this._xferComplete}get aborted(){return this._aborted}get bytesTransfered(){return this._bytesTransfered}get bytesTotal(){return this._bytesTotal}set onProgress(e){this._onProgress=e}get onProgress(){return this._onProgress}_callCallback(e,t){let r=this._callback;if(r)return this._callback=void 0,r(e,t)}_xferComplete(e,t){let r=this._cleanup;if(!r)return this._callCallback(e,t);this._cleanup=void 0,r(e,t)}abort(e){return this._aborted||(this._aborted=!0,this._session._service.abortAllWithToken(this)),e||(this._callback=void 0,e=Error("Aborted")),this._xferComplete(e,null)}}class ei{constructor(){}static createCompositeAtPubs(e,t,r){return j(this,void 0,void 0,function*(){return ei.pubsAsset||(ei.pubsAsset=yield d.getPubsAsset(e.serviceConfig)),yield e.createComposite({assetId:ei.pubsAsset.assetId,repositoryId:ei.pubsAsset.repositoryId},t,r)})}static publishCompositeAlreadyPushedToPubs(e,t,r,s,o,i){let n;if(!t||null==t.resourcePath||null==t.communityId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"ResourcePath & communityId must be set on publication record for the composite to be published.");let a=new eo(o,i),l=null!==t.assetId;return e.current&&o.updatePublicationRecordData(t,e.current),l?(n=o.updateCpMetadataAtResource(e.type,t,function(e,r){return a.xferComplete(e,e?void 0:t)}))&&(n.token=a):(n=o.publishCompositeAtResource(e.type,t,function(e,r){return a.xferComplete(e,e?void 0:t)}))&&(n.token=a),a}static getCpMetadata(e,t,r){if(!t||null==t.assetId||null==t.communityId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Asset Id & communityId must be set on publication record to fetch its CP metadata.");return e.getCpMetadata(t,r)}}class en{constructor(e){this._waitingCallbacks=[],this._commitInProgress=!1,this._needAnotherCommit=!1,this._data={"composite-href":e.href,"uploaded-components":{}}}get compositeHref(){return this._data["composite-href"]}set compositeHref(e){throw new h.DCXError(h.DCXError.READ_ONLY,"This property is read-only.")}get derivationType(){return this._data["derivation-type"]}set derivationType(e){this._data["derivation-type"]=e}get manifestEtag(){return this._data.etag}set manifestEtag(e){e?this._data.etag=e:delete this._data.etag}get versionId(){return this._data.versionId}set versionId(e){e?this._data.versionId=e:delete this._data.versionId}get currentBranchEtag(){return this._data["current-branch-etag"]}set currentBranchEtag(e){e?this._data["current-branch-etag"]=e:delete this._data["current-branch-etag"]}get changeCount(){return this._data.change}set changeCount(e){e?this._data.change=e:delete this._data.change}get compositeHasBeenDeleted(){return!!this._data["composite-deleted"]}set compositeHasBeenDeleted(e){e?this._data["composite-deleted"]=!0:delete this._data["composite-deleted"]}get compositeHasBeenArchived(){return!!this._data["composite-archived"]}set compositeHasBeenArchived(e){e?this._data["composite-archived"]=!0:delete this._data["composite-archived"]}get isEmpty(){return 0===Object.keys(this._data["uploaded-components"]).length&&!this.compositeHasBeenDeleted&&!this.compositeHasBeenArchived&&!this.manifestEtag}set isEmpty(e){throw new h.DCXError(h.DCXError.READ_ONLY,"This property is read-only.")}get isComplete(){return!!(this._data.etag&&this._data.change||this._data["composite-deleted"]||this._data["composite-archived"])}set isComplete(e){throw new h.DCXError(h.DCXError.READ_ONLY,"This property is read-only.")}recordUploadedComponent(e,t,r,s,o,i){let n={etag:t,length:o,version:r,md5:s,timestamp:(new Date).toISOString()};i&&(n["source-asset-info"]=i),this._data["uploaded-components"][e]=n}idsOfAllUploadedComponents(){return Object.keys(this._data["uploaded-components"])}getRecordForUploadedComponent(e){let t=this._data["uploaded-components"][e];if(t&&!this.isComplete){let r=t.timestamp;if(!r||isNaN((r=new Date(r)).getTime())||Date.now()-r.getTime()>=6012e5)return void this.removeRecordForUploadedComponent(e)}return t}removeRecordForUploadedComponent(e){delete this._data["uploaded-components"][e]}applyToBranch(e,t){if(!this.isComplete)throw new h.DCXError(h.DCXError.INVALID_STATE,"Journal is not complete.");let r=e.isDirty;if(this.compositeHasBeenDeleted)e._data.state=U.committedDelete,e.manifestEtag=this.manifestEtag;else{this.compositeHasBeenArchived&&(e.compositeArchivalState=H.archived);let t=e.compositeState!==U.unmodified&&this.changeCount!==e.changeCount,r=this.idsOfAllUploadedComponents(),s=r.length;for(let t=0;t<s;t++){let s=r[t],o=e.getComponentWithId(s);if(o){let t=this.getRecordForUploadedComponent(o.id);if(o._data.etag=t.etag,o._data.length=t.length,o._data.version=t.version,o._data.md5=t.md5,t["source-asset-info"]){let r=e._core._getSourceAssetInfoOfComponent(o),s=t["source-asset-info"];r&&s&&r.compositeAssetId===s.compositeAssetId&&r.componentId===s.componentId&&r.componentVersion===s.componentVersion&&(o._data.state=U.unmodified,e._core._setSourceAssetInfoOfComponent(void 0,o))}else o._data.state=U.unmodified}}e.manifestEtag=this.manifestEtag,"string"==typeof this.versionId&&(e.versionId=this.versionId),void 0!==this.derivationType&&(e._derivationType=this.derivationType),t||(e._data.state=U.unmodified)}t&&(e._isDirty=r)}}function ea(e){let t=0;return(r,s,o)=>{e(r-t,o),t=r}}let el=a.newDebug("dcx:dcxjs:compositexfer:pull");function ed(e){let t;el("_pullCompositeManifest()");let{_composite:r,_session:s,_additionalData:{versionId:o,referenceBranch:i},additionalHeaders:n}=e;if(r._links){let{assetId:e,repositoryId:t}=s.registerLinks(r._links,r.repositoryId,r.assetId);r.assetId=e,r.repositoryId=t,delete r._links}if("string"!=typeof r.assetId)throw new h.DCXError(h.DCXError.INVALID_STATE,"Composite must have an asset id.");return el("_pCM() pullManifest()",e),i&&!o&&(t=i.manifestEtag),E.default.resolve(void 0,e).then(()=>{let i=s.getCompositeManifest(r,o,t,n);return e.hasProgressHandler&&(i.progress=ea(e._reportProgress.bind(e))),i}).then(t=>{let s,{manifestData:i,manifestEtag:n,response:a}=t;e._additionalData.response=a;try{r.links=d.parseLinksFromResponseHeader(a)}catch(e){}if(el("_pCM() pM() getCompositeManifest() cb",n),null===i)return;try{(s=l.isObject(i)?new J(i):(new J).parse(i)).compositeAssetId=r.assetId,s.compositeRepositoryId=r.repositoryId,s._collaborationType=r.collaborationType,s._clientDataString=r.clientDataString,s.versionId=null!=a.headers.version?a.headers.version:o,s.manifestEtag=n}catch(e){throw el("_pCM() pM() gCM() bad manifest"),new h.DCXError(h.DCXError.INVALID_JSON,"Corrupted manifest",e)}if(s.compositeState===U.committedDelete||s.compositeState===U.pendingDelete)throw new h.DCXError(h.DCXError.INVALID_STATE,"R-API composites should be deleted using a single step with RepoAPISession#deleteAsset");let c=s._core.allComponents();for(let e=0;e<c.length;++e){let t=c[e];t.state===U.pendingDelete||t.state===U.committedDelete?s.removeComponent(t):t.state=U.unmodified}return s}).then(e=>{if(null!=e)return e.compositeState=U.unmodified,e.readOnly=!0,r._options.xhrBaseBranchSupport&&!o&&(r._pulledBranchData=e.localData),e}).catch(e=>{if(e.code===h.DCXError.NOT_FOUND)throw new h.DCXError(h.DCXError.NO_COMPOSITE,"Composite missing or deleted",e.underlyingError||e);throw e})}let eh=a.newDebug("dcx:dcxjs:compositexfer:push"),ec="META-INF/metadata.xml";function eu(e){return e.getComponentWithAbsolutePath(`/${ec}`)}function ep(){let{_composite:e,_session:r,_additionalData:{xmpConfig:s,owner:i,compositeIsNew:n}}=this,a=function(e,r,s){if(r.mode===t.XMPModes.CLIENT_MANAGED&&r.initialXMPXML)return r.initialXMPXML;let{creatorTool:i,modifyDate:n}=r,a=l.generateUuid(),d=[];if(e._derivationType===o.COPY){let t=e._derivationDatetime,r=p.makeHistoryEventXML(i,"copied",a,t);d.push(r)}else if(s){let e=p.makeHistoryEventXML(i,"created",a,n);d.push(e)}if(!s||e._derivationType===o.COPY){let e=p.makeHistoryEventXML(i,"saved",a,n);d.push(e)}return p.initializeXMPXML(i,a,n,d,void 0)}(i,s,n);return r.putCompositeComponent(e,l.generateUuid(),a,d.EmbeddedMetadataMediaTypes.XML,!0,a.length).then(t=>r.uploadResultsFromAdobeRepoUploadResult(t,e.id)).then(e=>(this._additionalData.xmpPushed=!0,i.addComponentWithUploadResults("xmp-metadata","metadata",ec,void 0,e)))}function e_(e){eh("_handleError()",e);let{_session:t,_composite:r,_additionalData:{compositeIsNew:s}}=this;if(s||0===this.failedComponents.length&&(e.response&&400===e.response.statusCode||e.additionalData&&e.additionalData.bulkResponse))throw e;let o=!1;return t.headCompositeManifest(r).then(()=>{throw o=!0,e}).catch(t=>{if(!o&&404===t.response.statusCode)throw new h.DCXError(h.DCXError.NO_COMPOSITE,"Composite does not exist; may have been deleted",e,e.response,{failedComponents:this.failedComponents});throw e.additionalData={failedComponents:this.failedComponents},e})}function ef(){let e;eh("_pushManifest()");let r=this._additionalData.owner;if(r.compositeState!==U.modified)return;let{_session:s,_additionalData:{overwriteExisting:i,validationLevel:n,xmpConfig:a,compositeIsNew:c,shouldPushWithXMP:u,xmpPushed:_}}=this;r.compositeState=U.unmodified;let f=r.remoteData,g=f.length;this._bytesTotal+=g,this._indeterminateTotalBytes=!1;let m=(eh("_updateManifestEtag()"),this._journal.manifestEtag&&this._journal.currentBranchEtag===r.manifestEtag&&(eh("_uME() updating etag, previous: ",r.manifestEtag),r.manifestEtag=this._journal.manifestEtag),eh("_uME() using if-match: ",r.manifestEtag),r.manifestEtag);return!u||_?(e=s.updateCompositeManifest(r,f,i,n,m),this.hasProgressHandler&&(e.progress=ea(this._reportProgress.bind(this))),e):function e(r,s,i,n,a,c,u,_,f=0){let{_session:g,_composite:m}=r,A=function(e,r){if(r.mode===t.XMPModes.CLIENT_MANAGED)return r.xmpPatch;let{creatorTool:s,modifyDate:i}=r,n=[];return e._derivationType===o.COPY&&p.makeDerivedWithAction.call({patchDocument:n},s,"copied",void 0,i),p.appendHistoryEvent.call({patchDocument:n},"saved",s,i),n}(s,_),y=g.getLinkHrefForAsset(m,d.LinkRelation.EMBEDDED_METADATA),D=l.pruneUndefined({[d.HeaderKeys.IF_MATCH]:"*",[d.HeaderKeys.CONTENT_TYPE]:d.JSONPatchMediaType}),C=g.getLinkHrefForAsset(m,d.LinkRelation.MANIFEST),I=l.pruneUndefined({[d.HeaderKeys.IF_MATCH]:c,[d.HeaderKeys.CONTENT_TYPE]:`${d.ManifestMediaType};validation-level=${a}`});return E.default.allSettled([C,y]).then(([e,t])=>{if("rejected"===t.status||"rejected"===e.status)throw new h.DCXError(h.DCXError.INVALID_STATE,"Could not retrieve required links.");return g.performBulkRequest(m,[{method:d.HTTPMethods.PUT,href:e.value,headers:I,body:i},{method:d.HTTPMethods.PATCH,href:t.value,headers:D,body:JSON.stringify(A)}])}).then(t=>(function(t,r,s,o,i,n,a,l,c,u=0){eh("_handleManifestAndXMPResponse()");let[_,f]=c.result,{statusCode:g}=_,{statusCode:m}=f;if(eh("_hMAXR() manifest, embedded status: ",g,m),u>2&&(g>=400||m>=400))throw eh("_hMAXR() circuit break retries"),new h.DCXError(h.DCXError.INVALID_STATE,"Repairing failed or repeated failures during XMP/manifest push. Check additionalData.",void 0,c[0],{bulkResponse:c});let E=o,A=a,y=n;function D(o=s){return eh("_hMAXR() retry bulk; isNew, etag, overwrite: ",A,y,E),e(t,r,o,E,i,y,A,l,u+1)}if(g>=400){if(404===g)throw new h.DCXError(h.DCXError.NO_COMPOSITE,"Composite not found.",void 0,_,{bulkResponse:c});if(424===g);else{if(o&&409===g)throw new h.DCXError(h.DCXError.UPDATE_CONFLICT,"Manifest has been changed",void 0,_,{bulkResponse:c});if(o&&412===g)throw new h.DCXError(h.DCXError.PRECONDITION_FAILED,"Precondition failed",void 0,_,{bulkResponse:c});if(409===g)E=!1;else{if(412!==g)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from manifest PUT in bulk.",void 0,_,{bulkResponse:c});E=!1,y=void 0}}}if(m>=400){if(424===m);else{if(404!==m){if(400===m){let e=eu(r);if(e)return(function(e,t,r){let{_session:s,_composite:o,_additionalData:{owner:i}}=e;return s.getCompositeComponent(o,t.id,t.version,"text").then(({response:e})=>{let i=p.repairXMPXML(e,r.creatorTool,r.modifyDate);if(e!==i)return s.putCompositeComponent(o,t.id,i,d.EmbeddedMetadataMediaTypes.XML,!1,i.length)}).then(e=>e&&s.uploadResultsFromAdobeRepoUploadResult(e,o.id)).then(e=>{if(e)return i.updateComponentWithUploadResults(t,e),e.records[t.id].etag})})(t,e,l).then(()=>D(r.remoteData));throw new h.DCXError(h.DCXError.INVALID_STATE,"Manifest appears to be corrupted.",void 0,_,{bulkResponse:c})}throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from embedded request in bulk.",void 0,_,{bulkResponse:c})}A=!0}return D()}let C=eu(r);return t._journal.recordUploadedComponent(C.id,"*",`${parseInt(C.version)+1}`,f.headers["content-md5"]||C.md5,C.length),_})(r,s,i,n,a,c,u,_,t,f))}(this,r,f,i,n,m,c,a)}function eg(e){if(void 0===e)return this._additionalData.owner;this._additionalData.manifestResponse=e;let{_journal:t,_composite:r,_additionalData:{owner:s}}=this,i=e.headers.etag,n=e.headers.version,a=s.changeCount;return t.manifestEtag=i,t.derivationType=o.NONE,t.currentBranchEtag=s.manifestEtag,t.changeCount=a,t.versionId=n,t.applyToBranch(s),s.compositeState=U.unmodified,r._options.xhrBaseBranchSupport&&(r._pushedBranchData=s.localData),s}function em(e){if(eh("_handleFailedComponents()"),0===e.length)return this._additionalData.owner;if(e.filter(e=>e.error&&e.error.code===h.DCXError.EXCEEDS_QUOTA).length>0)throw new h.DCXError(h.DCXError.EXCEEDS_QUOTA,"One or more components failed to upload.",void 0,void 0,{failedComponents:e});throw new h.DCXError(h.DCXError.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.",void 0,void 0,{failedComponents:e})}function eE(e){return eh("_getCurrentCopyOpCollector()"),(0===e.length||e[e.length-1].docBuilder.entryCount>=(this._additionalData._test_operationsPerBatch||50))&&(eh("_gCCOC() new copy op collector"),e.push({docBuilder:d.newOperationDocBuilder(),orderedPendingComponents:[]})),e[e.length-1]}function eA(e,t){eh("_reduceComponent()");let{_journal:r,_composite:s,_additionalData:{owner:o}}=this,{state:i=U.unmodified,etag:n}=t,a=null==n;if(!a&&i===U.unmodified)return eh("_rC() not new, not modified"),void r.removeRecordForUploadedComponent(t.id);if(!a&&(i===U.committedDelete||i===U.pendingDelete))return eh("_rC() not new, committedDelete or pendingDelete"),void o.removeComponent(t);let l=o._core._getSourceAssetInfoOfComponent(t);if(eh("_rC() source asset",l),null==l)return void this._failedComponents.push({component:t,error:new h.DCXError(h.DCXError.INVALID_STATE,"Component should not be modified or new without local storage")});let c=r.getRecordForUploadedComponent(t.id);if(l&&c){let e=c["source-asset-info"];if(e&&e.compositeAssetId===l.compositeAssetId&&e.componentId===l.componentId&&e.componentVersion===l.componentVersion)return t.etag=c.etag,t.version=c.version,t.md5=c.md5,t.length=c.length,void(t.state=U.unmodified)}let u=eE.call(this,e);u.docBuilder.copyResources({assetId:l.compositeAssetId,repositoryId:l.repositoryId},s,[{source:{component_id:l.componentId,revision:l.componentVersion,reltype:d.LinkRelation.COMPONENT},target:{component_id:t.id,reltype:d.LinkRelation.COMPONENT}}],!0),u.orderedPendingComponents.push([t,l])}function ey(e){eh("_handleBatchResults(): ",e);let{_journal:t,_failedComponents:r}=this;e.map(e=>{if("rejected"===e.status)throw eh("_hBR() error",e.reason),e.reason;let{orderedPendingComponents:s,results:o,response:i}=e.value;o.forEach(({resources:e})=>{e.forEach(e=>{let o=s.find(([,t])=>t.componentId===e.target.component_id);if(o){let[s,n]=o;try{let{etag:r,id:o,version:a,md5:d,length:c}=function(e,t,r){if(eh("_validateCopyResponse()"),!l.isObject(e))throw new h.DCXError(h.DCXError.INVALID_DATA,"Invalid result",void 0,t);let s={etag:e.etag,version:e.revision,md5:r.md5,length:r.length,state:U.unmodified};for(let e in s)if(null==s[e])throw new h.DCXError(h.DCXError.INVALID_DATA,`No ${e}`,void 0,t);return Object.assign(r,s)}(e.target,i,s);t.recordUploadedComponent(o,r,a,d,c,n)}catch(e){r.push({component:s,error:e})}}})})})}function eD(e,t){eh("_parallelBatchOperations()");let{value:r,done:s}=t.next();return eh("_pBO() next generator: ",r,s),E.default.resolve(r).then(t=>{let r=t.filter(e=>e.orderedPendingComponents.length).map(t=>{let r=JSON.stringify(t.docBuilder.getDocument());this._bytesTotal+=r.length;let s=e.performBatchOperation(r).then(({result:e,response:r})=>({results:e,response:r,orderedPendingComponents:t.orderedPendingComponents}));return this.hasProgressHandler&&(s.progress=ea(this._reportProgress.bind(this))),s});return E.default.allSettled(r)}).then(ey.bind(this)).then(()=>s?this.failedComponents:eD.call(this,e,t))}function*eC(e){eh("_makeCopyOpGenerator()");let t=[];for(let r=0;r<e.length;r++){let s=e[r];eA.call(this,t,s);let o=eE.call(this,t);o.orderedPendingComponents.length===d.COPY_RESOURCES_RESOURCE_LIMIT&&(yield[o],t=[])}return t}function eI(){eh("_pushComponents()");let{_session:e,_additionalData:{owner:t}}=this,r=t.allComponents();eh("_pC() component count: ",r.length);let s=eC.call(this,r);return E.default.resolve(void 0,this).then(()=>eD.call(this,e,s))}t.XMPModes=void 0,(i=t.XMPModes||(t.XMPModes={}))[i.MANAGED=0]="MANAGED",i[i.PARTIALLY_MANAGED=1]="PARTIALLY_MANAGED",i[i.CLIENT_MANAGED=2]="CLIENT_MANAGED",i[i.UNMANAGED=3]="UNMANAGED";let ev=a.newDebug("dcx:dcxjs:compositexfer:upload");function eb(e,t){ev("_uploadComponent()");let{additionalHeaders:r,_additionalData:{componentId:s,componentType:o,componentIsNew:i,size:n,md5:a},_composite:d,_session:c,_blockSize:p}=e;l.validateObject(d,"composite",["id","string"],["repositoryId","string"],["assetId","string"]),l.validateParams(["session",c,"object"],["dataOrSliceCallback",t,["object","function","string"]],["componentType",o,"string"],["componentId",s,"string",!0],["size",n,"+number",!0],["md5",a,"string",!0]);let{id:_,repositoryId:f}=d,g=n||t.length||t.byteLength||t.size;return e._bytesTotal=g,E.default.resolve(void 0,e).then(()=>c.putCompositeComponent(d,s,t,o,i,g,a,e.hasProgressHandler?ea(e._reportProgress.bind(e)):void 0,r,p)).then(({result:t,response:r})=>{e._additionalData.response=r;let i=u.createUploadResults(_,d.assetId,f);return i.records[s]=function(e,t,r,s){if("object"!=typeof s)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"Invalid upload result, expecting object");let{md5:o,etag:i,revision:n,length:a=t}=s;if(null==a)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"No length");if(null==i)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"No etag");if(null==n)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"No version");if(null==o)throw new h.DCXError(h.DCXError.UNEXPECTED_RESPONSE,"No md5");return u.createUploadRecord(e,i,n,o,a,r)}(s,g,o,t),i})}let eT=a.newDebug("dcx:dcxjs:repocompositexfer:xferctx");class eP{constructor(e,t,r,s,o,i){this.additionalHeaders=o,this._aborted=!1,this._bytesTransfered=0,this._abortHandlers=[],this._bytesTotal=0,this._additionalData={},this._failedComponents=[],this._session=e,this._composite=t,this.onProgress=s,r&&(this._additionalData=r),this._blockSize=i}get aborted(){return this._aborted}get bytesTransfered(){return this._bytesTransfered}get bytesTotal(){return this._bytesTotal}get failedComponents(){return this._failedComponents}get hasProgressHandler(){return void 0!==this._progressHandler}set onProgress(e){l.isAnyFunction(e)&&(this._progressHandler=e)}get onProgress(){return this._progressHandler}onAbort(e){this._abortHandlers.push(e)}abort(e){this._aborted||(this._abortHandlers.forEach(t=>l.isAnyFunction(t)&&t.call(void 0,e)),this._session._service.abortAllWithToken(this),this._aborted=!0)}_reportProgress(e,t){if(eT("progress",e),t&&(this._indeterminateTotalBytes=!0),e>0&&(this._bytesTransfered+=e,l.isAnyFunction(this._progressHandler)))try{this._progressHandler(this._bytesTransfered,this._bytesTotal,this._indeterminateTotalBytes)}catch(e){console.error("Error in progress callback",e)}}}let eR=a.newDebug("dcx:dcxjs:compositexfer");function ew(e,t,r,s){let o=e._additionalData.response;if((o||r&&r.response)&&a.emitAnalyticsEvent(t,{composite:e._composite,error:r,response:o||r.response,branch:s}),r)throw r}function eO(e,t,r,s,o){let i=e._additionalData.response;if((i||s&&s.response)&&a.emitAnalyticsEvent(a.AnalyticsEvent.UploadComponent,{composite:e._composite,error:s,response:i||s.response,isBlockTransferred:t,component:r}),s)throw s;return o}let ek=n.AdobeNetworkHTTPService;l.isBrowserSDK()&&l.isNode()?f.default.warn(es("browser","Node")):!l.isBrowserSDK()&&l.isBrowser()&&f.default.warn(es("Node","browser"));let eS=a.getGlobalLogger(),eN=ee.COLLABORATION;Object.defineProperty(t,"createHTTPService",{enumerable:!0,get:function(){return n.createHTTPService}}),Object.defineProperty(t,"AdobeDCXLogger",{enumerable:!0,get:function(){return a.AdobeDCXLogger}}),Object.defineProperty(t,"getGlobalLogger",{enumerable:!0,get:function(){return a.getGlobalLogger}}),Object.defineProperty(t,"AdobeDCXError",{enumerable:!0,get:function(){return h.AdobeDCXError}}),Object.defineProperty(t,"DCXError",{enumerable:!0,get:function(){return h.DCXError}}),Object.defineProperty(t,"isAdobeDCXError",{enumerable:!0,get:function(){return h.isAdobeDCXError}}),t.AdobeCommunityPlatform=ei,t.AdobeCommunityPublicationRecord=A,t.AdobeCommunitySession=B,t.AdobeDCXBranch=J,t.AdobeDCXComponent=F,t.AdobeDCXComposite=ee,t.AdobeDCXElement=K,t.AdobeDCXNode=Y,t.AdobeDCXPushJournal=en,t.AdobeDCXUtil=g,t.AdobeNetworkHTTPService=ek,t.AdobeRemixData=er,t.COLLABORATION=eN,t.CommunityPublicationRecord=A,t.CommunitySession=B,t.HTTPService=ek,t.RemixData=er,t.communityPlatform=ei,t.convertToDCXComposite=et,t.copyResources=function(e,t,r,s,o,i){return e.copyResources(t,r,s,o,i)},t.createCommunityPublicationRecord=()=>new A,t.createCommunitySession=(e,t)=>new B(e,t),t.createComposite=function(e,t,r,s,o,i,n,a){if(Z("createComposite()"),l.validateParams(["session",e,"object"],["composite",t,"object"],["parentDir",r,"object"],["relPath",s,"string"]),t.assetId)throw new h.DCXError(h.DCXError.INVALID_STATE,"Composite must not already have an assigned asset id.");if("string"!=typeof r.repositoryId&&"string"!=typeof t.repositoryId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Either composite or parentDir must contain valid repositoryId.");if("string"==typeof r.repositoryId&&"string"==typeof t.repositoryId&&r.repositoryId!==t.repositoryId)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Composite contains a repositoryId that does not match parentDir.");if("string"!=typeof t.type)throw new h.DCXError(h.DCXError.INVALID_STATE,"Composite must contain a valid type.");let c="string"==typeof t.repositoryId?t.repositoryId:r.repositoryId;if(Object.getOwnPropertyNames(r).forEach(e=>{r[e]=r[e],r.repositoryId=c}),!d.isMinimalAdobeAsset(r))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"parentDir must contain links or repositoryId & assetId or path");return function(e,t,r,s,o,i,n,a,h){let{repositoryId:c}=r;return e.createComposite(r,s,o,i,n,a,h).then(r=>j(this,void 0,void 0,function*(){let{assetId:s,links:o}=r.result;if(t.assetId=s,t.repositoryId=c,t.links=o,a){let{manifestData:r}=yield e.getCompositeManifest(t);t.resolvePullWithBranch(new J(r))}return i?r.result:t})).catch(r=>{try{if(r.response&&l.isObject(r.response.headers)){let s=r.response.headers["asset-id"]||r.response.headers["x-resource-id"],o=d.parseLinksFromResponseHeader(r.response);t.links=o,"string"==typeof s&&l.isObject(o)&&e.updateCachedAssetLinks({assetId:s,repositoryId:c,links:o})}}catch(e){}throw r})}(e,t,r,s,t.type,o||void 0,i,n,a)},t.createRemixData=()=>new er,t.getCompositeManifestAndComponentsByPath=function(e,t,r,s,o,i){let n=d.isAdobeDCXCompositeLike(t)?t:et(t);return e.getManifestAndComponentsByPath(n,r,s,o,i).then(e=>Object.assign(e,{composite:n}))},t.getURLForComponent=function(e,t,r,s){return e.getCompositeComponentUrl(t,t.id,void 0!==r?r:t.version,s)},t.logger=eS,t.newCompositeAsCopyOf=(e,t,r,s,o={})=>ee.newCompositeAsCopyOf(e,t,r,s,o),t.newDCXComposite=function(e,t,r,s,o,i,n={}){if(null==e&&null==i){if("string"!=typeof o)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unbound DCXComposite must have a type.");if("string"!=typeof r)throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Unbound DCXComposite must have a name.")}let a=new ee(r,o,s,e,t,n);return i&&(a.links=i),a},t.pullCompositeManifestOnly=function(e,t,r){let s=new eP(e,t,{referenceBranch:t.current},void 0,r),o=(e,t)=>(ew(s,a.AnalyticsEvent.PullComposite,e,t),t);return ed(s).then(o.bind(void 0,void 0)).catch(o)},t.pullCompositeVersionManifestOnly=function(e,t,r,s){let o=new eP(e,t,{versionId:r,referenceBranch:t.current},void 0,s),i=(e,t)=>(ew(o,a.AnalyticsEvent.PullCompositeVersion,e,t),t);return ed(o).then(i.bind(void 0,void 0)).catch(i)},t.pushComposite=function(e,r,s,o=1,i={mode:t.XMPModes.MANAGED},n){eR("pushComposite()"),l.validateParams(["session",e,"object"],["composite",r,"object"],["overwriteExisting",s,"boolean"],["validationLevel",o,"+number"],["options",i,"object",!0]);let d=function(e){void 0===e.mode&&(e.mode=t.XMPModes.MANAGED);let r=e.modifyDate||(new Date).toISOString(),s=e.creatorTool||"dcx-js";if(e.mode===t.XMPModes.MANAGED||e.mode===t.XMPModes.PARTIALLY_MANAGED)return eR("push: using managed XMP mode"),l.validateObject(e,"options",["creatorTool","string",!0],["modifyDate","string",!0]),{mode:e.mode,creatorTool:s,modifyDate:r};if(e.mode===t.XMPModes.CLIENT_MANAGED){eR("push: using client managed XMP mode"),l.validateObject(e,"options",["xmpPatch","object[]",!0],["initialXMPXML","string",!0]);let t=e.xmpPatch||[],o=l.validateJSONPatchDocument(t);if(!0!==o)throw new h.DCXError(h.DCXError.INVALID_PARAMS,'Invalid parameter "options.xmpPatch".',void 0,void 0,{issues:o});return Object.assign(Object.assign({},e),{modifyDate:r,creatorTool:s})}if(e.mode===t.XMPModes.UNMANAGED)return eR("push: using unmanaged XMP mode"),e;throw new h.DCXError(h.DCXError.INVALID_PARAMS,`Invalid XMP mode '${e.mode}'`)}(i),c=!r.isBound;d.mode===t.XMPModes.PARTIALLY_MANAGED||d.mode===t.XMPModes.MANAGED||d.mode===t.XMPModes.CLIENT_MANAGED&&(c||c||d.xmpPatch);let u=r._current.copy(),p=u._derivationType,_=new eP(e,r,{owner:u,overwriteExisting:s,compositeIsNew:c,validationLevel:o,xmpConfig:d,shouldPushWithXMP:!1,xmpPushed:!1},void 0,n);_._journal=_._composite._pushJournal||new en(r);let f=function(e,t){let s=_._additionalData.manifestResponse;(s||t&&t.response)&&a.emitAnalyticsEvent(a.AnalyticsEvent.PushComposite,{composite:r,branch:u,error:t,response:s||t.response,derivationType:p});let o=_._journal;return _._composite._pushJournal=o.isEmpty?void 0:o,e};return(function(e,t){if(eh("_pushComposite()"),!t.assetId||!t.repositoryId)throw new h.DCXError(h.DCXError.INVALID_STATE,"Composite is not bound to a cloud asset. createComposite() must be called to assign an asset ID and repository ID before calling push.");let{owner:r,compositeIsNew:s,shouldPushWithXMP:o}=e._additionalData;return(eh("_isNoOpPush()"),!s&&r.compositeState===U.unmodified||0)?E.default.resolve(r,e):(function(e){if(eh("_assertStateIsValidForPush()"),e.compositeState===U.committedDelete)throw new h.DCXError(h.DCXError.DELETED_COMPOSITE,"Attempt to push a deleted composite");if(e.compositeState===U.pendingDelete)throw new h.DCXError(h.DCXError.INVALID_STATE,"R-API composites should be deleted using a single step with RepoAPISession#deleteAsset");if(e.compositeArchivalState===H.pending||e.compositeArchivalState===H.archived)throw new h.DCXError(h.DCXError.INVALID_STATE,"R-API composites cannot be archived")}(r),e._bytesTotal=0,e._indeterminateTotalBytes=!0,eI.call(e).then(em.bind(e)).then(o&&!eu(r)?ep.bind(e):void 0).then(ef.bind(e)).then(eg.bind(e)).catch(e_.bind(e)))})(_,r).then(f).catch(e=>{throw f(void 0),e})},t.uploadComponent=function(e,t,r,s,o,i,n,a){eR("uploadComponent()"),l.validateObject(r,"component",["id","string"],["type","string"]);let{id:d,type:h}=r,c=new eP(e,t,{componentType:h,componentIsNew:!1,componentId:d,size:o,md5:i},n,a),u=(e,t)=>(eO(c,!!p.blockUpload,r,e,t),t),p=eb(c,s).then(u.bind(void 0,void 0)).catch(u);return p},t.uploadNewComponent=function(e,t,r,s,o,i,n,a,d,c){if(eR("uploadNewComponent()"),o&&!l.verifyUuid(o))throw new h.DCXError(h.DCXError.INVALID_PARAMS,"Component id is not a uuid ");let u=new eP(e,t,{componentType:s,componentIsNew:!0,componentId:o||l.generateUuid(),size:i,md5:n},a,d,c),p=(e,t)=>(eO(u,!!_.blockUpload,{length:i,type:s},e,t),t),_=eb(u,r).then(p.bind(void 0,void 0)).catch(p);return _},Object.keys(c).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}),Object.keys(u).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},4861:function(e,t,r){let s;Object.defineProperty(t,"__esModule",{value:!0});var o=r(247673),i=r(111829),n=r(866525),a=r(42173),l=n&&"object"==typeof n&&"default"in n?n:{default:n};function d(e,t,r,s){return new(r||(r=Promise))(function(o,i){function n(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((s=s.apply(e,t||[])).next())})}let h=i.newDebug("dcx:http:auth");class c{constructor(e,t,r){this._authToken=e,this._apiKey=t,this._pendingAuth=!1,this._hasBaseRefreshCb=!1,this._authListeners=[],this._persistentListeners=[],this._authenticationAllowList=["adobe.com","adobe.io","adobelogin.com","fotolia.net"],this._authTokenScheme="Bearer",a.validateParams(["authToken",e,"string",!0],["apiKey",t,"string",!0],["refreshCb",r,"function",!0]),r&&(this._hasBaseRefreshCb=!0,this.onChange((e,t)=>{"unauthenticated"===e&&r.call(null,t)},!0)),e&&t||(h("init unauthenticated"),this._pendingAuth=!0,setTimeout(()=>{h("after tick",this._pendingAuth),this._pendingAuth&&this.refreshAuth()}))}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new o.DCXError(o.DCXError.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}get isNoAuthMode(){return!this._hasBaseRefreshCb}set isNoAuthMode(e){this._hasBaseRefreshCb=!e}get apiKey(){return this._apiKey}get authToken(){return this._authToken}get authTokenScheme(){return this._authTokenScheme}set authTokenScheme(e){this._authTokenScheme=e}setAuthToken(e){h("setAuthToken"),this._authToken=e,this._pendingAuth=!1,this._authChanged("updated")}setApiKey(e){this._apiKey=e}resume(){h("resume()"),this._pendingAuth=!1,this._authChanged("updated")}get pendingAuth(){return this._pendingAuth}onChange(e,t=!1){h("onChange, persistent:",t);let r=this._authListeners.push(e)-1;return t&&this._persistentListeners.push(r),()=>{try{t&&(this._persistentListeners=this._persistentListeners.filter(e=>e!==r)),delete this._authListeners[r]}catch(e){}}}clearListeners(e=!1){if(h("clearListeners, persistent:",e),!0===e)return this._authListeners=[],void(this._persistentListeners=[]);this._authListeners=this._authListeners.map((e,t)=>{if(this._persistentListeners.includes(t))return e})}get refreshPromise(){return this._refreshPromise}_authChanged(e){return d(this,void 0,void 0,function*(){h("authChanged",e),this._pendingAuth="unauthenticated"===e,queueMicrotask(()=>d(this,void 0,void 0,function*(){let t=[];this._authListeners.map(r=>{if("function"==typeof r){let s=r.call(null,e,this);s&&"object"==typeof s&&s.then&&t.push(s)}}),yield Promise.all(t),"updated"===e&&this._resolveRefresh()}))})}_resolveRefresh(){h("_resolveRefresh"),this._refreshResolve&&this._refreshResolve(this.getAuthData()),this._refreshResolve=void 0,this._refreshPromise=void 0}refreshAuth(){return h("refreshAuth"),this._refreshPromise||(this._refreshPromise=new Promise(e=>{this._refreshResolve=e}),this._authChanged("unauthenticated")),this._refreshPromise}getAuthData(){return{authToken:this._authToken,apiKey:this._apiKey}}getAuth(){return d(this,void 0,void 0,function*(){return Promise.resolve(this.getAuthData())})}isAuthorizedURL(e){let t=a.getDomainFromURL(e);return this._authenticationAllowList.includes(t)}logout(){h("logout"),this._apiKey=void 0,this._authToken=void 0,!1===this._pendingAuth&&(this._pendingAuth=!0,this._authChanged("unauthenticated"))}applyAuthHeaders(e,t){let r={"x-api-key":void 0,authorization:void 0};return this.isAuthorizedURL(e)&&(null!==t["x-api-key"]&&this.apiKey&&(r["x-api-key"]=this.apiKey),null!==t.authorization&&this.authToken&&(r.authorization=(this.authTokenScheme?`${this.authTokenScheme} `:"")+this.authToken)),t=a.pruneUndefined(Object.assign(Object.assign({},t),r))}}let u=i.newDebug("dcx:http:xhr");if(null==(s="undefined"!=typeof window?window.XMLHttpRequest:XMLHttpRequest))throw new o.AdobeDCXError(o.AdobeDCXError.INVALID_STATE,"XMLHttpRequest module not found.");let p={NO_ERROR:"",ABORTED:o.ErrorCodes.ABORTED,NETWORK:o.ErrorCodes.NETWORK_ERROR,TIMEOUT:o.ErrorCodes.TIMED_OUT,TOO_MANY_REDIRECTS:o.ErrorCodes.TOO_MANY_REDIRECTS,INSECURE_REDIRECT:o.ErrorCodes.INSECURE_REDIRECT};class _{constructor(e={}){this._autoParseJson=!1,this._bytesReported=0,this._errorCode=p.NO_ERROR,this._isFetchRequest=!1,this._fetchAbort=()=>{},this._preferFetch=!1,this._sent=!1,this.headers={},this.responseType="text",this._progressListeners=[];let{forceXhr:t,preCallback:i,postCallback:n,timeout:a,preferFetch:l}=e;this._preCallback=i,this._postCallback=n,this._timeout=null==a?12e4:a,this._xhr=t?new t:new s,this._xhr.timeout=this._timeout,this._preferFetch=!0===l,this._fetch=e.fetch?e.fetch:"undefined"!=typeof window&&"fetch"in window&&"function"==typeof window.fetch?window.fetch.bind(window):"undefined"!=typeof self&&"fetch"in self&&"function"==typeof self.fetch?self.fetch.bind(self):void 0!==r.g&&"fetch"in r.g&&"function"==typeof r.g.fetch?r.g.fetch.bind(r.g):void 0,this._parseFetchResponse=this._parseFetchResponse.bind(this),this.onProgress=this.onProgress.bind(this),this._autoParseJson=null==e.autoParseJson||e.autoParseJson,e.additionalNodeOptions&&this._xhr.setNodeOptions&&this._xhr.setNodeOptions(e.additionalNodeOptions),this._promise=new Promise(e=>{this._resolve=e,this._xhr.addEventListener("abort",()=>{u("aborted",this._errorCode,this._timeout),this._errorCode=this._errorCode||p.ABORTED,this._finalize()}),this._xhr.addEventListener("error",e=>{switch(u("err",this._errorCode,e,this._xhr.status,this._timeout),this._underlyingError=e,e?e.code:void 0){case"ERR_FR_TOO_MANY_REDIRECTS":this._errorCode=p.TOO_MANY_REDIRECTS;break;case o.AdobeDCXError.INSECURE_REDIRECT:this._errorCode=p.INSECURE_REDIRECT;break;case p.TIMEOUT:this._errorCode=p.TIMEOUT;break;default:this._errorCode=p.NETWORK}this._finalize()}),this._xhr.addEventListener("load",()=>{u("load"),this._estimatedTotalBytes&&this._estimatedTotalBytes>this._bytesReported&&this._notifyProgressListeners(this._estimatedTotalBytes,this._estimatedTotalBytes,!1),this._finalize()}),this._xhr.addEventListener("timeout",()=>{u("timeout",this._timeout),this._errorCode=p.TIMEOUT,this._finalize()})})}get xhr(){return this._xhr}_parseFetchResponse(e){return d(this,void 0,void 0,function*(){if(204===e.status)return e;if("chunked"===e.headers.get("transfer-encoding")||parseInt(e.headers.get("content-length")||"0")>0)switch(this.responseType){case"json":a.isJsonContentType(e.headers.get("content-type")||"")&&(this._fetchBodyAsResponseType=yield e.json());break;case"arraybuffer":this._fetchBodyAsResponseType=yield e.arrayBuffer();break;case"blob":this._fetchBodyAsResponseType=yield e.blob();break;case"text":this._fetchBodyAsResponseType=yield e.text();break;case"void":break;case"buffer":case"defaultbuffer":this._fetchBodyAsResponseType=yield e.arrayBuffer().then(e=>new Uint8Array(e))}return"stream"===this.responseType&&(this._fetchBodyAsResponseType=e.body),e})}_shouldAutoParseResponse(){let e=this._errorCode===p.NO_ERROR&&this._sent&&!this._isFetchRequest&&"text"===this._xhr.responseType&&this._autoParseJson&&"string"==typeof this._xhr.response&&this._xhr.response.length<102400&&a.isJsonContentType(this.getResponseHeader("content-type"));return u("_shouldAutoParseResponse()",e),e}_fetchWithTimeout(e,t={}){if("function"!=typeof this._fetch)throw new o.DCXError(o.DCXError.UNEXPECTED,"fetch method not found but was invoked");let{timeout:r}=t,s=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)0>t.indexOf(s[o])&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r}(t,["timeout"]);this._isFetchRequest=!0;let i=e=>()=>{this._errorCode=this._errorCode||p.TIMEOUT,e(new o.DCXError(o.DCXError.TIMED_OUT,"request aborted due to timeout")),this._finalize()};if("function"!=typeof AbortController)return new Promise((t,o)=>d(this,void 0,void 0,function*(){this._timeoutTimeout=setTimeout(i(o),r);let n=yield this._fetch(e,s);return clearTimeout(this._timeoutTimeout),this._parseFetchResponse(n).then(t)})).finally(()=>{clearTimeout(this._timeoutTimeout)});let n=new AbortController;return this._timeoutTimeout=setTimeout(i(n.abort.bind(n)),r),this._fetchAbort=()=>{this._errorCode=this._errorCode||p.ABORTED,n.abort(),this._finalize()},this._fetch(e,Object.assign({signal:n.signal},s)).then(this._parseFetchResponse).finally(()=>{clearTimeout(this._timeoutTimeout)})}_finalize(){if(u("_finalize",this._xhr.status,this._errorCode),this._shouldAutoParseResponse())try{let e=JSON.parse(this._xhr.response);this._autoParsedResponse=e,this._xhr.responseType="json"}catch(e){}this._postCallback&&this._postCallback(this),this._timeoutTimeout&&clearTimeout(this._timeoutTimeout),this._progressListeners=[],this._resolve(this)}_validateResponseType(e){if("buffer"===e){if("function"!=typeof Buffer)throw new o.AdobeDCXError(o.AdobeDCXError.INVALID_PARAMS,"No Buffer class")}else if("blob"===e){if("function"!=typeof Blob)throw new o.AdobeDCXError(o.AdobeDCXError.INVALID_PARAMS,"No Blob class")}else if("text"!==e&&"json"!==e&&"arraybuffer"!==e&&"stream"!==e)throw new o.AdobeDCXError(o.AdobeDCXError.INVALID_PARAMS,"Unsupported response type");return e.toLowerCase()}send(e,t,r,s={},i="text",n={}){if(u("send"),this._sent)throw Error("Xhr already sent");this.href=e,this.method=t.toUpperCase(),this.body=r,this.body?this._estimatedTotalBytes=this.body.byteLength||this.body.length||this.body.size:this._estimatedTotalBytes=Number.MAX_SAFE_INTEGER;let l=e=>{var t;u(`progress ${e.loaded}/${e.total}`),this._bytesReported=e.loaded,e.lengthComputable?(this._estimatedTotalBytes=e.total,this._notifyProgressListeners(this._bytesReported,null!=(t=this._estimatedTotalBytes)?t:1/0,!1)):this._estimatedTotalBytes&&this._estimatedTotalBytes>this._bytesReported&&this._notifyProgressListeners(this._bytesReported,this._estimatedTotalBytes||e.total,!0)};["POST","PUT","PATCH"].includes(this.method)&&this._xhr.upload?this._xhr.upload.onprogress=l:this._xhr.addEventListener("progress",l),this._timeout=n.timeout||this._timeout||12e4,u("setting timeout",this._timeout),this._xhr.timeout=this._timeout,i&&(u("responseType: ",i=this._validateResponseType(i)),this.responseType="buffer"===i?"arraybuffer":"stream"===i?"stream":"void"===i?"text":i);let d=a.normalizeHeaders(s);if(this.headers=d,this.href.startsWith("http:")&&null!==this.headers.authorization)throw new o.AdobeDCXError(o.AdobeDCXError.INVALID_PARAMS,"Must not send auth token over unsecured connection");if(this._preCallback&&this._preCallback(this),(this._preferFetch||"stream"===i)&&"function"==typeof this._fetch)return this._xhr.responseType=this.responseType,this._promise=new Promise(e=>{this._resolve=e,this._fetchWithTimeout(this.href,{body:["GET","HEAD"].includes(this.method.toUpperCase())?void 0:r,credentials:n.withCredentials?"include":void 0,headers:d,method:this.method,timeout:this._timeout}).then(e=>{this._fetchResponse=e,this._finalize()}),this._sent=!0}),this._promise;for(let[e,t]of(this._xhr.open(this.method,this.href,!0),this._xhr.responseType=this.responseType,Object.entries(d)))this._xhr.setRequestHeader(e,t);return null!=n.withCredentials&&(this._xhr.withCredentials=n.withCredentials),null!=r?this._xhr.send(r):this._xhr.send(),this._sent=!0,this._promise}abort(){if(u("abort()"),!this._sent)throw Error("Cannot abort before sending.");this._isFetchRequest?this._fetchAbort():this._xhr.abort()}getResponseHeader(e){if(!this._sent)throw Error("Cannot getResponseHeader before sending.");let t=e.toLowerCase(),r=this.getAllResponseHeaders();if(t in r)return r[t]}getAllResponseHeaders(){var e,t;if(!this._sent)throw Error("Cannot getAllResponseHeaders before sending.");if(this._parsedResponseHeaders)return this._parsedResponseHeaders;let r=this._isFetchRequest?a.objectFromEntries(null!=(t=null==(e=this._fetchResponse)?void 0:e.headers.entries())?t:[]):this._xhr.getAllResponseHeaders();return this._parsedResponseHeaders="string"==typeof r?a.parseHeaders(r):a.normalizeHeaders(r),this._parsedResponseHeaders}isError(){if(!this._sent)throw Error("Cannot check isError before sending.");return this._errorCode!==p.NO_ERROR}isAborted(){if(!this._sent)throw Error("Cannot check isAborted before sending.");return this._errorCode===p.ABORTED}isTimedOut(){if(!this._sent)throw Error("Cannot check isTimedOut before sending.");return this._errorCode===p.TIMEOUT}isSent(){return this._sent}getErrorCode(){return this._errorCode}getStatus(){if(!this._sent)throw Error("Cannot getStatus before sending.");return this._fetchResponse?this._fetchResponse.status:this._xhr.status}getResponse(){var e;if(!this._sent)throw Error("Cannot getResponse before sending.");return this._response||(this._response={statusCode:this.getStatus(),headers:this.getAllResponseHeaders(),responseType:this._autoParsedResponse?"json":this.responseType,response:this.getResponseData(),message:this._isFetchRequest?(null==(e=this._fetchResponse)?void 0:e.statusText)||"":this._xhr.statusText,xhr:this},this._autoParsedResponse&&(this._response.originalResponseData=this._xhr.response)),this._response}toJSON(){return{statusCode:this.getStatus(),headers:this.getAllResponseHeaders(),responseType:this._autoParsedResponse?"json":this.responseType,response:this.getResponseData(),message:this._xhr.statusText}}getResponseDataAsJSON(){return d(this,void 0,void 0,function*(){try{if(this._fetchResponse)return yield this._fetchResponse.json();if(this._autoParsedResponse)return this._autoParsedResponse;if("json"===this._xhr.responseType){if("string"==typeof this._xhr.response)return JSON.parse(this._xhr.response);if(null===this.xhr.response&&["application/problem+json","application/json"].includes(this.xhr.getResponseHeader("content-type")))throw new o.DCXError(o.DCXError.UNEXPECTED,"Unexpected response type");return this.xhr.response}let e=this._xhr.response;if("text"===this._xhr.responseType&&null!==this._xhr.responseText)e=this._xhr.responseText;else if("arraybuffer"===this._xhr.responseType)e=a.arrayBufferToString(this._xhr.response);else{if("blob"===this._xhr.responseType&&(e instanceof Blob||a.isAnyFunction(e.text)))return JSON.parse((yield e.text()));"stream"===this.responseType?yield new Promise((t,r)=>{if(e="","function"==typeof this.xhr.response.on)return this.xhr.response.on("data",t=>{e+=t}),this.xhr.response.on("end",t),void this.xhr.response.on("error",r);if("string"==typeof this.xhr.response)return t(e=this.xhr.response);throw new o.DCXError(o.DCXError.UNEXPECTED,"Unexpected response type")}):e=this._xhr.responseText?this._xhr.responseText:e}return"string"==typeof e?JSON.parse(e):e}catch(e){throw new o.DCXError(o.DCXError.INVALID_JSON,"Could not parse response as JSON",e,this.toJSON())}})}getResponseData(){if(!this._sent)throw Error("Cannot getResponseData before sending.");return this._isFetchRequest&&this._fetchBodyAsResponseType?this._fetchBodyAsResponseType:this._autoParsedResponse||this._xhr.response}onProgress(e){let t=this._progressListeners.push(e)-1;return()=>{try{delete this._progressListeners[t]}catch(e){}}}_notifyProgressListeners(e,t,r){this._progressListeners.map(s=>s&&s.call&&s.call(null,e,t,r))}}let f=i.newDebug("dcx:http:backoff");class g{constructor(e,t,r,s,n="text",l,h,c={}){let{descriptor:u}=c;delete c.descriptor;let{cancel:g,getPromise:m,onProgress:E,getSnapshot:A}=function(e,t,r,s={},n,l={},h=!1){let c,{disableRetry:u=!1,retryNetworkError:g=!0,responseType:m="text",authCallback:E=null,progressListeners:A=[],initialWait:y=2e3,maxWait:D=32e3,preCallback:C,postCallback:I,preScheduleCallback:v,postScheduleCallback:b,preferRetryAfterHeader:T=!0,pollCodes:P=[],pollHeader:R,pollMethod:w="get",problemWithCode:O={problemType:"",code:null,url:""}}=l,{retryCodes:k=[],timeoutAfter:S=72e3}=l;f("retry codes",k=h?[...P,...k]:u||a.isReadableStream(r)?[]:l.retryCodes||a.DEFAULT_RETRY_CODES);let N=l.increase||((e,t,r)=>1===e?r:t*t>D?D:t*t),L=0,M=0,X=!1,x=a.now(),B,j,U,H,V=a.now(),F=0,Y=!1,W=!1,q=[];function z(){f("getSnapshot()",X,L,a.now(),V,F);let e=X||null!=B?0:L-(a.now()-V),t=F;t+=X?a.now()-V:0;let r=(B||a.now())-x;return{count:M,canceled:Y,timedOut:W,requests:q,duration:r,totalWaited:t,requestPending:X,waitingFor:e}}function G(){return Math.min(N(M,L,y),D)}function K(e){if(e)return t=>e(t,z())}function $(e){let t=e.getResponseHeader("retry-after");if(T&&t){if(isNaN(t)){let e=Date.parse(t)-Date.now();return f("nextWait from retry-after",e),e<0?G():e}return 1e3*parseInt(e.getResponseHeader("retry-after"))}}let J=new Promise((u,p)=>{j=u,U=p,function u(p=L){return d(this,void 0,void 0,function*(){if(F>=S)return f("timed out",F,S),W=!0,j(H);V=a.now(),v&&(yield v(z())),f("retry in ",p),c=setTimeout(()=>{var c;for(let r of(f("retry start"),i.log(`Request: ${t.toUpperCase()} ${e} ${null!=(c=null==s?void 0:s["x-request-id"])?c:""}`),X=!0,F+=p,H=new _(Object.assign(Object.assign({},l),{timeout:n,preCallback:K(C),postCallback:K(I)})),q.push(H),M++,A))H.onProgress(r);H.send(e,t,r,s,m).then(n=>d(this,void 0,void 0,function*(){var l,d,c;if(i.log(`Response: ${t.toUpperCase()} ${e} ${null==(l=n.headers)?void 0:l["x-request-id"]} ${n.getStatus()}`),X=!1,!n.isError()&&!a.checkRetriable(n.getStatus(),k)&&(401!==n.getStatus()||null==E)&&("string"!=typeof R||null==P||!a.checkRetriable(n.getStatus(),P))||(null==O?void 0:O.code)===n.getStatus()&&(null==O?void 0:O.problemType)!==(null==(d=n.getResponseData())?void 0:d.type))return B=a.now(),j(n);if(n.isAborted()||Y)return B=a.now(),Y=!0,j(n);if(!h&&"string"==typeof R&&null!=P&&a.checkRetriable(n.getStatus(),P)){let s=n.getResponseHeader(R.toLowerCase()),o=O.url;if(s||o&&O.code===n.getStatus()&&O.problemType===(null==(c=n.getResponseData())?void 0:c.type)){h=!0,e=s||o,t=w,r=void 0,k=[...k,...P],F=0,S*=3;let i=n.getResponseHeader("retry-after");if(T&&i){let e=$(n);if(null!=e)return u(L=e)}return u(0)}}if(401===n.getStatus()){if(E){try{s=yield E(e,s)}catch(e){return U(new o.DCXError(o.DCXError.UNAUTHORIZED,"Authentication Failed",n))}return F+=a.now()-V,u(0)}return B=a.now(),U(new o.DCXError(o.DCXError.UNAUTHORIZED,"Authentication Failed",n))}if(a.checkRetriable(n.getStatus(),k)||g&&n.getErrorCode()===o.ErrorCodes.NETWORK_ERROR){let e=n.getResponseHeader("retry-after");if(T&&e){let e=$(n);if(null!=e)return u(L=e)}return u(L=G())}return B=a.now(),j(n)}))},p),b&&(yield b(z()))})}(0)});return{getPromise:()=>J,cancel:function(){f("cancel()"),Y=!0,null!=H&&H.abort(),X||(f("abort"),clearTimeout(c),j({getErrorCode:()=>p.ABORTED}))},onProgress:function(e){if(!A.includes(e))return A.push(e),null!=H?H.onProgress&&H.onProgress(e):void 0},getSnapshot:z}}(e,t,r,s,c.timeout,Object.assign(Object.assign(Object.assign(Object.assign({},c),{responseType:n,authCallback:h}),c.retryOptions),{descriptor:u,forceXhr:c.forceXhr,autoParseJson:c.autoParseJson}));this.onProgress=E,"function"==typeof l&&E((e,t)=>l("progress",{total:t,sentOrReceived:e})),this._cancel=g,this._promise=m(),this._getSnapshot=A}getSnapshot(){return this._getSnapshot()}getPromise(){return this._promise}cancel(e){this._cancel(e)}}let m=i.newDebug("dcx:http:req");class E{constructor(e){var t;if(this._pausable=!1,this._listeners={progress:[],cancel:[]},this._isStatusValid=e.isStatusValid||o._defaultStatusValidator,this._isExternalRequest=e.isExternalRequest,this._authProvider=e.authProvider,this._id=e.id,this._descriptor=e.descriptor,e.descriptor&&e.descriptor.progress){let t=e.descriptor.progress;this.on("progress",({sentOrReceived:e,total:r})=>{t.call(void 0,e,r)})}let r=this._authProvider.applyAuthHeaders(e.url,a.normalizeHeaders(e.headers||{}));this._isExternalRequest&&E._internalOnlyHeaders.forEach(e=>delete r[e]),this._networkRequest=new g(e.url,e.method,e.body,r,e.responseType,(null==(t=e.descriptor)?void 0:t.progress)?this._emit.bind(this):void 0,this._getAuthCb(),e),this._promise=this._networkRequest.getPromise().then(t=>{let r=t.getErrorCode(),s=r||this._isStatusValid(t.getStatus(),t.getResponse());if(r||!0!==s){if(r===p.ABORTED)throw new o.DCXError(o.DCXError.ABORTED,"Aborted");if(r===p.NETWORK)throw new o.DCXError(o.DCXError.NETWORK_ERROR,"Network error",void 0,t.getResponse());if(r===p.TIMEOUT)throw new o.DCXError(o.DCXError.TIMED_OUT,"Timeout",void 0,t.getResponse());if(s instanceof o.DCXError||s instanceof Error)throw new o.DCXError(s.code||o.DCXError.UNEXPECTED_RESPONSE,s._message||s.message,s.underlyingError,t.getResponse());throw new o.DCXError(o.DCXError.UNEXPECTED_RESPONSE,"Unexpected response",void 0,t.getResponse())}let i=this._networkRequest.getSnapshot().requests;return m("resolve",e.id),Object.assign(Object.assign({},t.getResponse()),{xhr:i[i.length-1]})}).catch(t=>{throw m("reject",e.id),t})}get id(){return this._id}get descriptor(){return this._descriptor}_getAuthCb(){if(!this._authProvider.isNoAuthMode)return this._authCb.bind(this)}_authCb(e,t){return m("_authCb()"),this._authProvider.isAuthorizedURL(e)?this._authProvider.refreshAuth().then(()=>this._authProvider.applyAuthHeaders(e,t)):Promise.reject(new o.DCXError(o.DCXError.UNAUTHORIZED,"URL is not part of authenticationAllowList.",void 0,void 0,{url:e}))}_emit(e,t){this._listeners[e].map(e=>e.call(null,t))}getPromise(){return this._promise}cancel(e){return this._networkRequest.cancel(e)}on(e,t){var r;"progress"===e&&0===this._listeners[e].length&&(null==(r=this._networkRequest)||r.onProgress((t,r)=>this._emit(e,{total:r,sentOrReceived:t}))),this._listeners[e].push(t)}}E._internalOnlyHeaders=["x-request-id","x-api-key","authorization"];let A=i.newDebug("dcx:http:map");class y{constructor(){this._map=new Map}addRequest(e,t){return A("addRequest()",e),this._map.set(e,t),t.getPromise().then(t=>{A("then",e),this._map.delete(e)}).catch(t=>{A("catch",e,t),this._map.delete(e)}),e}get(e){return this._map.get(e)}get length(){return this._map.size}has(e){return this._map.has(e)}removeById(e){let t=this._map.get(e);t&&this.remove(t)}remove(e,t){return e&&e.cancel&&e.cancel(t)}clear(e){this._map.forEach(t=>{this.remove(t,e)}),this._map.clear()}removeAllWithToken(e){this._map.forEach(t=>{t.descriptor.token===e&&this.remove(t)})}}let D=i.newDebug("dcx:http:q"),C=e=>"head"===e.method.toLowerCase();class I{constructor(){this._queue=[],this._later={},this._headEndPtr=0,this._isPriority=C,this._usePriority=!1}push(e,t,r){return d(this,void 0,void 0,function*(){let s,o=new Promise(e=>{s=e});if("number"!=typeof t||t<=0){let t={descriptor:e,notifySent:e=>s(e),notifyCanceled:this._notifyCanceled(s)};return this._push(t),o}let{id:i}=e,n=setTimeout(()=>{this._ready(i)},t),a=e=>s(e);return this._later[i]={readyTimeout:n,wait:t,descriptor:e,notifySent:a,notifyCanceled:this._notifyCanceled(s),notifyReady:()=>{r&&r.call(null,{wait:t,descriptor:e,notifySent:a})}},o})}_notifyCanceled(e){return t=>{if(!t)return e({canceled:!0});e({canceled:!0,error:t})}}_push(e){this._usePriority&&this._isPriority(e.descriptor)?this._queue.splice(this._headEndPtr++,0,e):this._queue.push(e)}remove(e){if(e.id in this._later)return D("remove from later",e.id),this._remove(e.id);let t=this._indexOf(e);return D("remove from q",t),t>=0?this._remove(t):void 0}_remove(e,t){if(D("_remove",e),"string"==typeof e){let r=this._later[e];return r.notifyCanceled.call(null,t),r.readyTimeout&&clearTimeout(r.readyTimeout),void delete this._later[e]}this._queue[e].notifyCanceled.call(null,t),this._queue.splice(e,1),e<this._headEndPtr&&this._headEndPtr--}_indexOf(e){let t=!!e.method,r=t&&this._usePriority&&this._isPriority(e),s=r?this._headEndPtr:this._queue.length,o=r||!t?0:this._headEndPtr;for(let t=o;t<o+s;t++)if(e.id===this._queue[t].descriptor.id)return t;return -1}exists(e){return e.id in this._later||this._indexOf(e)>=0}_ready(e){let t=this._later[e],r=t.notifyReady;delete this._later[e],delete t.notifyReady,delete t.readyTimeout,delete t.wait,this._push(t),"function"==typeof r&&r.call(null)}pop(){let e=this._queue.shift();return this._headEndPtr>0&&this._headEndPtr--,e}get length(){return D("length: ",this._queue.length,Object.keys(this._later).length),this._queue.length+Object.keys(this._later).length}clear(e){for(let t=this._queue.length-1;t>=0;t--)this._remove(t,e);this._queue=[];let t=Object.keys(this._later);for(let r in t){let s=t[r];this._remove(s,e)}this._later={}}removeAllWithToken(e){for(let t=this._queue.length-1;t>=0;t--)this._queue[t].descriptor.token===e&&this._remove(t);let t=Object.keys(this._later);for(let r in t){let s=t[r];this._later[s].descriptor.token===e&&this._remove(s)}}}let v=i.newDebug("dcx:http:service");class b{constructor(e,t={}){this.name="AdobeHTTPService",this._requestQueue=new I,this._requestsOutstanding=new y,this._authProvider=void 0,this._isActive=!0,this._preferFetch=!1,this._handlesRedirects=!0,this._withCredentials=!1,this._additionalNodeOptions={},this._retryOptions={},this._serviceGuid=a.generateUuid(),this._reqNum=0,this.featureFlags={},e instanceof c||a.isObject(e)&&a.isAnyFunction(e.onChange)?this._authProvider=e:a.isAnyFunction(e)&&(t.useAuthProvider?this._authProvider=new c(void 0,void 0,e):this._authProvider=new c(void 0,void 0,()=>e.call(null,this)),this._waitingForAuthentication=!0),this._authProvider?this._authProvider.onChange(this._onAuthChange.bind(this)):(this._authProvider=new c,this._authProvider.resume()),this._maxOutstanding=t.maxOutstanding||5,this._withCredentials=t.crossOriginCredentials||!1,this._timeout=null==t.timeout?12e4:t.timeout,this._preferFetch=!0===t.preferFetch,this._requestIdPrefix=t.requestIdPrefix,t.server&&(this.server=t.server)}get isActive(){return this._isActive}set isActive(e){this._isActive!==e&&(this._isActive=e,e||this._authProvider.logout(),this._checkQueue())}get crossOriginCredentials(){return this._withCredentials}set crossOriginCredentials(e){this._withCredentials=e}get maxOutstanding(){return this._maxOutstanding}set maxOutstanding(e){this._maxOutstanding=e,this._checkQueue()}get handlesRedirects(){return this._handlesRedirects}get server(){return this._server}set server(e){this._server=e&&e.endsWith("/")?e.substr(0,e.length-1):e}_forceXhr(e,t=!1){this._forcedXhr=e,this._handlesRedirects=!t}_useFetchApi(e){this._fetch=e}setAdditionalHeaders(e){this._additionalHeaders=e||{}}setValidateStatus(e){this._isStatusValid=e}setAdditionalNodeOptions(e){this._additionalNodeOptions=e,a.isNode()&&e&&0===e.maxRedirects&&(this._handlesRedirects=!1)}setRetryOptions(e){this._retryOptions=e}set authenticationAllowList(e){this._authProvider.authenticationAllowList=e}get authenticationAllowList(){return this._authProvider.authenticationAllowList}get authProvider(){return this._authProvider}setApiKey(e){this._authProvider.setApiKey(e)}setTimeout(e){this._timeout=e}setAuthToken(e){e?this._authProvider.setAuthToken(e):this._authProvider.logout()}_onAuthChange(e,t){v("_oAC",e);let r=this._waitingForAuthentication;"unauthenticated"===e?this._waitingForAuthentication=!0:(this._waitingForAuthentication=!1,!1!==r&&this._checkQueue())}resume(){this._waitingForAuthentication=!1,this._authProvider.resume(),this._checkQueue()}setRequestHooks(e,t){this._beforeHook=e,this._afterHook=t}invoke(e="GET",t,r={},s,i={},n){var d;v("invoke",e,t,i);let h=(i=i||{}).autoParseJson||!1,c=i.responseType;if(null!=c&&"void"!==c||(h=null==i.autoParseJson||i.autoParseJson,c=i.responseType="text"),"defaultbuffer"===c&&(c=a.isNode()?i.responseType="buffer":i.responseType="arraybuffer"),"buffer"===c){if("function"!=typeof Buffer)throw new o.DCXError(o.DCXError.INVALID_PARAMS,"No Buffer class")}else if("blob"===c){if("function"!=typeof Blob)throw new o.DCXError(o.DCXError.INVALID_PARAMS,"No Blob class")}else if(c&&"text"!==c&&"json"!==c&&"arraybuffer"!==c&&"stream"!==c)throw new o.DCXError(o.DCXError.INVALID_PARAMS,"Unsupported response type: "+c);!a.endPointOf(t)&&this.server&&(t=`${this.server}/${t.startsWith("/")?t.substr(1,t.length):t}`),v("invoke href",t);let u=a.merge({},r,this._additionalHeaders);v("invoke headers",r),u["x-request-id"]=[this._requestIdPrefix,this._serviceGuid,u["x-request-id"],""+this._reqNum++].filter(e=>e).join("."),i.additionalNodeOptions=Object.assign({},this._additionalNodeOptions||{},i.additionalNodeOptions||{}),i.isStatusValid=i.isStatusValid||this._isStatusValid,i.retryOptions=Object.assign({},this._retryOptions||{},i.retryOptions||{});let p={method:e,href:t,headers:u,token:void 0,body:s,options:i,progress:null==(d=i.reuseRequestDesc)?void 0:d.progress,autoParseJson:h},_=i.reuseRequestDesc;_&&_ instanceof l.default&&"props"in _&&(_=_.props),_&&((this._requestQueue.exists(_)||_.id&&null!=this._requestsOutstanding.get(_.id))&&v("requestDesc still in use"),p=a.merge(_,p)),p.id=p.id||a.generateUuid(),n&&("maxRedirects"in i.additionalNodeOptions&&(i.additionalNodeOptions.maxRedirects=0),i.retryOptions&&0!==Object.keys(i.retryOptions).length||(i.retryOptions={disableRetry:!0}));let f=this._getRequestPromise(p);return f.getPromise().then(this._checkQueue.bind(this)).catch(this._checkQueue.bind(this)),a.isAnyFunction(n)&&(v("invoke - cb"),f.then(e=>{v("invoke - cb - resolve ",e.statusCode);try{n(void 0,e,e.response)}catch(e){console.error("[dcx:http] error in success callback",e,e.stack)}}).catch(e=>{v("invoke - cb - reject: ",e);try{n(e,e.response)}catch(e){console.error("[dcx:http] error in failure callback",e,e.stack)}})),this._checkQueue(),f}_makeRequest(e){v("_makeRequest(): ",e.id);let t=e.options||{},r=new E(a.pruneUndefined(Object.assign(Object.assign({url:e.href,autoParseJson:e.autoParseJson,descriptor:e},e),{timeout:t.timeout||this._timeout,authProvider:this._authProvider,forceXhr:this._forcedXhr,fetch:this._fetch,responseType:t.responseType,preCallback:this._beforeHook,postCallback:this._afterHook,isStatusValid:t.isStatusValid,additionalNodeOptions:t.additionalNodeOptions,retryOptions:t.retryOptions,isExternalRequest:t.isExternalRequest,preferFetch:this._preferFetch})));return this._requestsOutstanding.addRequest(e.id,r),e.startTime=(new Date).valueOf(),r}_checkQueue(){queueMicrotask(this._checkQueueLoop.bind(this))}_checkQueueLoop(){if(v("_checkQueueLoop()",this._waitingForAuthentication,this.isActive,this._requestsOutstanding.length,"<?",this.maxOutstanding),!this._isActive){v("_cQL inactive");let e=new o.DCXError(o.DCXError.SERVICE_IS_INACTIVE,"Network request in inactive state");this._requestsOutstanding.clear(e),this._requestQueue.clear(e)}let e=!0;for(;e&&!this._waitingForAuthentication&&this._requestsOutstanding.length<this.maxOutstanding&&null!=(e=this._requestQueue.pop());){let t=this._makeRequest(e.descriptor);e.notifySent(t)}v("_cQL done")}_getRequestPromise(e){return v("_getRequestPromise()"),new l.default((t,r,s)=>{if(!this._isActive)return v("_gRP inactive"),r(new o.DCXError(o.DCXError.SERVICE_IS_INACTIVE,"Network request in inactive state"));s(()=>{v("_gRP cancel 1",e.id),this._requestQueue.remove(e)});let i=e.noSoonerThen||null;return i&&(i-=a.now(),i=i<0?0:i>3e5?3e5:i),delete e.noSoonerThen,this._requestQueue.push(e,i,this._checkQueue.bind(this)).then(i=>(v("_gRP sent",e.id),i.canceled?(v("_gRP reject 1: ",e.id),r(new o.DCXError(o.DCXError.ABORTED,"Request aborted",i.error))):(s(t=>{v("_gRP cancel 2",e.id,t),i.cancel(new o.DCXError(o.DCXError.ABORTED,"Request aborted",t))}),i.getPromise().then(r=>(v("_gRP resolve 1",e.id,r),t(r))).catch(t=>(v("_gRP reject 2: ",e.id,t),r(t)))))).catch(r)},e)}abort(e){e&&e.cancel?e.cancel():this._requestQueue.exists(e)?this._requestQueue.remove(e):this._requestsOutstanding.removeById(e.id)}abortAllWithToken(e){v("abortAllWithToken()"),this._requestsOutstanding.removeAllWithToken(e),this._requestQueue.removeAllWithToken(e)}}t.AdobeNetworkHTTPService=b,t.AuthProvider=c,t.HTTPService=b,t.Xhr=_,t.XhrErrorCodes=p,t.createHTTPService=(e,t)=>new b(e,t||{})},111829:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s,o,i,n,a,l=r(42173);function d(e,r,s="css"){var o,i,n;l.validateParams(["data",r,"object"]),l.validateObject(r,"data",["composite","object"],["response","object"],["error","object",!0]);let{component:a,error:h,composite:c,branch:u,derivationType:p,isBlockTransferred:_}=r,f=(null==(o=r.error)?void 0:o.response)||r.response,g,m=!1;switch(e){case t.AnalyticsEvent.CreateComposite:m=!0,g=t.AnalyticsEventSubCategory.Create;break;case t.AnalyticsEvent.PushComposite:m=!0,g=t.AnalyticsEventSubCategory.Push;break;case t.AnalyticsEvent.PullComposite:m=!0,g=t.AnalyticsEventSubCategory.MinPull;break;case t.AnalyticsEvent.PullCompositeVersion:m=!0,g=t.AnalyticsEventSubCategory.VersionPull;break;case t.AnalyticsEvent.DownloadComponent:case t.AnalyticsEvent.UploadComponent:l.validateParams(["component",a,"object"]),l.validateObject(a,"data.component",["type","string"]),g=e===t.AnalyticsEvent.DownloadComponent?t.AnalyticsEventSubCategory.Download:t.AnalyticsEventSubCategory.Upload;break;default:g=t.AnalyticsEventSubCategory.Unknown}m&&l.validateParams(["branch",u,"object",!0]);let E={"env.com.name":"dcx-js","env.svc.name":s,"env.com.version":"9.1.0","event.request_id":f.headers["x-request-id"],"event.cloud_id":c.assetId,"custom.content.repository_id":c.repositoryId,"event.type":t.AnalyticsEventType.Success,"event.category":t.AnalyticsEventCategory.CompositeXfer,"event.subcategory":g},A=null==(i=null==h?void 0:h.underlyingError)?void 0:i.code,y=null==(n=null==h?void 0:h.underlyingError)?void 0:n.message;return h&&(E["event.error_code"]=h.code,E["event.error_desc"]=h.message,E["dcx.underlying_error_code"]=A,E["dcx.underlying_error_desc"]=y,E["event.type"]=t.AnalyticsEventType.Error),g===t.AnalyticsEventSubCategory.Unknown||(m?(E["dcx.num_total_components"]=null==u?void 0:u.allComponents().length,E["custom.content.xmp_derivation_type"]=p,h&&(E["dcx.root_error_desc"]=y)):(E["content.mimetype"]=a.type,h&&(E["dcx.block_transferred"]=null!=_&&_,E["content.type"]=a.type,E["content.size"]=a.length,E["dcx.component_rel"]=a.relationship))),function(e){let t={};for(let r in e){let s=e[r];l.isUndefined(s)||Array.isArray(s)||l.isObject(s)||(t[r]=s)}return t}(E)}t.AnalyticsEventType=void 0,(s=t.AnalyticsEventType||(t.AnalyticsEventType={}))[s.Success=0]="Success",s[s.Error=1]="Error",t.AnalyticsEventCategory=void 0,(o=t.AnalyticsEventCategory||(t.AnalyticsEventCategory={}))[o.CompositeXfer=0]="CompositeXfer",t.AnalyticsEventSubCategory=void 0,(i=t.AnalyticsEventSubCategory||(t.AnalyticsEventSubCategory={}))[i.Push=0]="Push",i[i.MinPull=1]="MinPull",i[i.VersionPull=2]="VersionPull",i[i.Upload=3]="Upload",i[i.Download=4]="Download",i[i.Create=5]="Create",i[i.Unknown=6]="Unknown",t.AnalyticsEvent=void 0,(n=t.AnalyticsEvent||(t.AnalyticsEvent={})).PushComposite="analyticsPush",n.CreateComposite="analyticsCreate",n.PullComposite="analyticsPull",n.PullCompositeVersion="analyticsPullVersion",n.UploadComponent="analyticsUpload",n.DownloadComponent="analyticsDownload",n.All="*",t.LogLevel=void 0,(a=t.LogLevel||(t.LogLevel={}))[a.Deprecated=0]="Deprecated",a[a.Error=1]="Error",a[a.Warn=2]="Warn",a[a.Log=3]="Log",a[a.Debug=4]="Debug";let h={[t.LogLevel.Deprecated]:"error",[t.LogLevel.Error]:"error",[t.LogLevel.Log]:"log",[t.LogLevel.Warn]:"warn",[t.LogLevel.Debug]:"debug"};class c extends l.EventEmitter{constructor(e){super([t.AnalyticsEvent.CreateComposite,t.AnalyticsEvent.UploadComponent,t.AnalyticsEvent.PushComposite,t.AnalyticsEvent.PullComposite,t.AnalyticsEvent.PullCompositeVersion,t.AnalyticsEvent.DownloadComponent]),this._logLevel=t.LogLevel.Warn,this._prevDebugTime=l.now(),this._debugFormatter=(e,t,r,s)=>`[${e} (+${(1e3*(t-r)).toFixed(0)})] ${s.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" ")}`,this._debugNamespaces=[],this._debugSkips=[],this.suppressDeprecationWarnings=!1,e&&(this._logCallback=e),this._initNamespaces()}get debugNamespaces(){return this._debugNamespaces}get debugSkips(){return this._debugSkips}set logLevel(e){if(!Object.values(t.LogLevel).includes(e))throw Error(`Invalid LogLevel, must be one of: ${Object.values(t.LogLevel).join(", ")}.`);this._logLevel=e}get logLevel(){return this._logLevel}on(e,r){let s;if(e!==t.AnalyticsEvent.All)return super.on(e,r);let o=Object.values(t.AnalyticsEvent);for(let e=0,t=o.length;e<t;e++){let t=o[e];s=super.on(t,r)}return s}static getInstance(){return null==c._instance&&(c._instance=new c),c._instance}static newLogger(e){return new c(e)}set logCallback(e){this._logCallback=e}get logCallback(){return this._logCallback}_initNamespaces(){l.isNode()?this.setDebugNamespaces(process.env.DCX_DEBUG||""):l.isObject(globalThis)&&l.isObject(globalThis.dcxjs)&&this.setDebugNamespaces(globalThis.dcxjs.debug||""),this._debugNamespaces.length>0&&(this._logLevel=t.LogLevel.Debug)}_log(e,r,s){try{if(e===c.LEVEL_DEPRECATED)!this.suppressDeprecationWarnings&&this._logLevel>=e&&console.warn(...s);else if("function"==typeof this._logCallback&&this._logLevel>=e)this._logCallback.call(void 0,...s);else if(this._logLevel>=e)if(e===t.LogLevel.Debug){if(this._debugEnabled(r)){let e=this._prevDebugTime;this._prevDebugTime=l.now(),(console.debug||console.log)(this._debugFormatter(r,this._prevDebugTime,e,s))}}else console[h[e]](...s.slice(0,-2))}catch(e){}}log(...e){this._log(t.LogLevel.Log,void 0,e)}warn(...e){this._log(t.LogLevel.Warn,void 0,e)}error(...e){this._log(t.LogLevel.Error,void 0,e)}deprecated(...e){this._log(t.LogLevel.Deprecated,void 0,e)}_debugEnabled(e){let t,r;if("*"===e[e.length-1])return!0;for(t=0,r=this._debugSkips.length;t<r;t++)if(this._debugSkips[t].test(e))return!1;for(t=0,r=this._debugNamespaces.length;t<r;t++)if(this._debugNamespaces[t].test(e))return!0;return!1}setDebugFormatter(e){this._debugFormatter=e}setDebugNamespaces(e){let t;this._debugNamespaces=[],this._debugSkips=[];let r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(t=0;t<s;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?this._debugSkips.push(RegExp("^"+e.substr(1)+"$")):this._debugNamespaces.push(RegExp("^"+e+"$")))}Debug(e){return(...r)=>{this._log(t.LogLevel.Debug,e,r)}}}c.LEVEL_DEBUG=t.LogLevel.Debug,c.LEVEL_LOG=t.LogLevel.Log,c.LEVEL_WARN=t.LogLevel.Warn,c.LEVEL_ERROR=t.LogLevel.Error,c.LEVEL_DEPRECATED=t.LogLevel.Deprecated;let u=()=>{let e=p();return void 0!==e._logCallback?e:c.getInstance()},p=()=>{if("object"==typeof globalThis&&"object"==typeof globalThis.dcxjs&&globalThis.dcxjs.logger&&globalThis.dcxjs.logger.getInstance)return globalThis.dcxjs.logger.getInstance();let e=()=>{};return{log:e,warn:e,error:e,deprecated:e,debug:e,newLogger:p}};var _=u();t.AdobeDCXLogger=c,t.default=_,t.emitAnalyticsEvent=(e,t)=>{let r=u(),s=d(e,t);try{r.emit(e,[s])}catch(t){let e=t instanceof Error?t.message:"Unknown Error";r.error("Error in analytics hook: ",e)}},t.getGlobalLogger=p,t.getGlobalOrLocalLogger=u,t.log=(...e)=>{let t=u();e.forEach(t.log.bind(t))},t.makeAnalyticsEvent=d,t.newDebug=e=>u().Debug(e),t.setLogCallback=e=>{u().logCallback=e}},737719:function(e,t,r){var s,o,i,n=void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}var d=a,h=l;function c(e){if(d===setTimeout)return setTimeout(e,0);if((d===a||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}"function"==typeof n.setTimeout&&(d=setTimeout),"function"==typeof n.clearTimeout&&(h=clearTimeout);var u,p=[],_=!1,f=-1;function g(){_&&u&&(_=!1,u.length?p=u.concat(p):f=-1,p.length&&m())}function m(){if(!_){var e=c(g);_=!0;for(var t=p.length;t;){for(u=p,p=[];++f<t;)u&&u[f].run();f=-1,t=p.length}u=null,_=!1,function(e){if(h===clearTimeout)return clearTimeout(e);if((h===l||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}(e)}}function E(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new A(e,t)),1!==p.length||_||c(m)}function A(e,t){this.fun=e,this.array=t}function y(){}A.prototype.run=function(){this.fun.apply(null,this.array)};var D=n.performance||{},C=D.now||D.mozNow||D.msNow||D.oNow||D.webkitNow||function(){return(new Date).getTime()},I=new Date,v={nextTick:E,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:y,addListener:y,once:y,off:y,removeListener:y,removeAllListeners:y,emit:y,binding:function(e){throw Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*C.call(D),r=Math.floor(t),s=Math.floor(t%1*1e9);return e&&(r-=e[0],(s-=e[1])<0&&(r--,s+=1e9)),[r,s]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-I)/1e3}},b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};(s=i={path:void 0,exports:{},require:function(e,t){throw null==t&&i.path,Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},o=i.exports,s.exports=function(){function e(e){return"function"==typeof e}var t,r,s,o,i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,a=void 0,l=void 0,d=function(e,t){g[n]=e,g[n+1]=t,2===(n+=2)&&(l?l(m):A())},h="undefined"!=typeof window?window:void 0,c=h||{},u=c.MutationObserver||c.WebKitMutationObserver,p="undefined"==typeof self&&void 0!==v&&"[object process]"===({}).toString.call(v),_="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(m,1)}}var g=Array(1e3);function m(){for(var e=0;e<n;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;n=0}var A=void 0;function y(e,t){var r=this,s=new this.constructor(I);void 0===s[C]&&X(s);var o=r._state;if(o){var i=arguments[o-1];d(function(){return L(o,s,i,r._result)})}else S(r,s,e,t);return s}function D(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(I);return R(t,e),t}A=p?function(){return E(m)}:u?(t=0,r=new u(m),s=document.createTextNode(""),r.observe(s,{characterData:!0}),function(){s.data=t=++t%2}):_?((o=new MessageChannel).port1.onmessage=m,function(){return o.port2.postMessage(0)}):void 0===h?function(){try{var e=Function("return this")().require("vertx");return a=e.runOnLoop||e.runOnContext,void 0!==a?function(){a(m)}:f()}catch(e){return f()}}():f();var C=Math.random().toString(36).substring(2);function I(){}var T=void 0;function P(t,r,s){r.constructor===t.constructor&&s===y&&r.constructor.resolve===D?1===r._state?O(t,r._result):2===r._state?k(t,r._result):S(r,void 0,function(e){return R(t,e)},function(e){return k(t,e)}):void 0===s?O(t,r):e(s)?d(function(e){var t=!1,o=function(e,t,r,s){try{e.call(t,r,s)}catch(e){return e}}(s,r,function(s){t||(t=!0,r!==s?R(e,s):O(e,s))},function(r){t||(t=!0,k(e,r))},"Settle: "+(e._label||" unknown promise"));!t&&o&&(t=!0,k(e,o))},t):O(t,r)}function R(e,t){if(e===t)k(e,TypeError("You cannot resolve a promise with itself"));else if(r=typeof t,null!==t&&("object"===r||"function"===r)){var r,s=void 0;try{s=t.then}catch(t){return void k(e,t)}P(e,t,s)}else O(e,t)}function w(e){e._onerror&&e._onerror(e._result),N(e)}function O(e,t){e._state===T&&(e._result=t,e._state=1,0!==e._subscribers.length&&d(N,e))}function k(e,t){e._state===T&&(e._state=2,e._result=t,d(w,e))}function S(e,t,r,s){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+1]=r,o[i+2]=s,0===i&&e._state&&d(N,e)}function N(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var s=void 0,o=void 0,i=e._result,n=0;n<t.length;n+=3)s=t[n],o=t[n+r],s?L(r,s,o,i):o(i);e._subscribers.length=0}}function L(t,r,s,o){var i=e(s),n=void 0,a=void 0,l=!0;if(i){try{n=s(o)}catch(e){l=!1,a=e}if(r===n)return void k(r,TypeError("A promises callback cannot return that same promise."))}else n=o;r._state!==T||(i&&l?R(r,n):!1===l?k(r,a):1===t?O(r,n):2===t&&k(r,n))}var M=0;function X(e){e[C]=M++,e._state=void 0,e._result=void 0,e._subscribers=[]}var x=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(I),this.promise[C]||X(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&O(this.promise,this._result))):k(this.promise,Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===T&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,s=r.resolve;if(s===D){var o=void 0,i=void 0,n=!1;try{o=e.then}catch(e){n=!0,i=e}if(o===y&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===B){var a=new r(I);n?k(a,i):P(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(s(e),t)},e.prototype._settledAt=function(e,t,r){var s=this.promise;s._state===T&&(this._remaining--,2===e?k(s,r):this._result[t]=r),0===this._remaining&&O(s,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;S(e,void 0,function(e){return r._settledAt(1,t,e)},function(e){return r._settledAt(2,t,e)})},e}(),B=function(){function t(e){this[C]=M++,this._result=this._state=void 0,this._subscribers=[],I!==e&&("function"!=typeof e&&function(){throw TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){R(e,t)},function(t){k(e,t)})}catch(t){k(e,t)}}(this,e):function(){throw TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return B.prototype.then=y,B.all=function(e){return new x(this,e).promise},B.race=function(e){var t=this;return new t(i(e)?function(r,s){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,s)}:function(e,t){return t(TypeError("You must pass an array to race."))})},B.resolve=D,B.reject=function(e){var t=new this(I);return k(t,e),t},B._setScheduler=function(e){l=e},B._setAsap=function(e){d=e},B._asap=d,B.polyfill=function(){var e=void 0;if(void 0!==b)e=b;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=B},B.Promise=B,B}(),i.exports).polyfill(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t||0,e.length)===e})},866525:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s=r(42173);let o=e=>"[object Function]"===toString.call(e);class i{constructor(e,t){return this._promise=null,this._props={},this._registeredProps=[],this._handlers={cancel:[]},this._done=!1,this._canceled=!1,this._internalKeys=[],this.name="AdobePromise",this._internalKeys=[...Object.keys(this),...Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(this))),"_cancelReason"],t&&"object"==typeof t&&this._setProps(t),this._promise=new Promise((t,r)=>e.call(this,e=>{this._done||(this._done=!0,t(e))},e=>{this._done||(this._done=!0,r(e))},this._registerCancelHandler.bind(this))),new Proxy(this,{set:function(e,t,r){if(e._internalKeys.includes(t)){if(!["_promise","_canceled","_cancelReason","_props","_registeredProps"].includes(t))throw Error("Cannot overwrite internal AdobePromise property.");e[t]=r}else e._registeredProps.includes(t)||e._registeredProps.push(t),e.props[t]=r;return!0},get:function(e,t){return"symbol"==typeof t||e._internalKeys.includes(t)?e[t]:e.props[t]}})}get[Symbol.toStringTag](){return this.name}static reject(e,t){return new n((t,r)=>Promise.reject(e).catch(e=>{r&&r(e)}),t)}static resolve(e,t){return new n(t=>{s.isObject(e)&&o(e.then)?e.then(e=>{t(e)}):t(e)},t)}static allSettled(e,t){return 0===e.length?n.resolve([],t):new n(t=>{let r=[];e.map((s,o)=>{s.then(e=>{r[o]={status:"fulfilled",value:e}}).catch(e=>{r[o]={status:"rejected",reason:e}}).then(()=>{r.filter(e=>!!e).length===e.length&&t(r)})})},t)}get canceled(){return this._canceled}getPromise(){return this._promise}_resolveOrReject(e,t){return this._promise.then(r=>this._canceled?t&&t(this._cancelReason):e(r)).catch(e=>t&&t(this._cancelReason||e))}then(e,t){if(null==e&&null==t)return this;let r=new n((e,t,r)=>(r&&r(e=>{this.cancel.call(this,e),t&&t(e)}),this._resolveOrReject.call(this,e,t)),this._props);return r._promise=r.getPromise().then(t=>{let s=e&&e(t);if(s instanceof n){for(let e in this.onCancel(e=>s.cancel(e)),this.props)null==s.props[e]&&(s.props[e]=this.props[e]);s._setProps(s.props),this._setProps(s.props),r._setProps(s.props)}return s}).catch(t),r}parallel(e,t){return this._promise.then(e,t)}catch(e){return this._promise=this._promise.catch(e),this}finally(e){return this._promise=this._promise.finally(e),this}cancel(e){this._canceled||(this._canceled=!0,this._cancelReason=e,this._callHandlers("cancel",e||Error("Aborted")))}abort(e){this.cancel(e)}onCancel(e){o(e)&&this._registerCancelHandler(e)}get props(){return this._props}_setProps(e){if(this._props===e)return;this._props=e;let t=[],r=Object.getOwnPropertyDescriptors(n),s=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e));if(s.constructor.value!==Object)for(let o in s){if(o in r||o in this&&!this._registeredProps.includes(o))continue;t.push(o);let i=s[o],n=Object.assign({},i);delete n.get,delete n.set,(i.get||i.set)&&(delete n.value,delete n.writable,i.get&&(n.get=i.get.bind(e)),i.set&&(n.set=i.set.bind(e))),Object.defineProperty(this,o,n)}for(let s of Object.keys(e))t.push(s),s in r||s in this&&!this._registeredProps.includes(s)||Object.defineProperty(this,s,{get:()=>this._props[s],set:e=>{this._props[s]=e},configurable:!0});return this._registeredProps=t,this}_registerCancelHandler(e){this._handlers.cancel.push(e)}_callHandlers(e,t){this._handlers[e].map(e=>e&&e(t))}_destroy(){this._handlers.cancel=[]}}let n=i;t.AdobePromise=n,t.default=n},738513:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s=r(397503),o=r(247673),i=r(111829),n=r(866525),a=r(42173);function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=l(o),h=l(n);class c{constructor(e,t,r,s,o,i){this.id=e,this.etag=t,this.version=r,this.md5=s,this.length=o,this.type=i}}class u{constructor(e,t,r){this.compositeId=e,this.compositeAssetId=t,this.repositoryId=r,this.records={}}addUploadRecord(e,t){a.validateParams(["componentId",e,"string"],["record",t,"object"]),this.records[e]=t}getComponentDescriptor(e){let t=this._checkRAPIComponentParams(e);return JSON.stringify(function(e,t,r,s){try{a.validateObject(s,"UploadRecord",["id","string"],["version","string"],["length","number"],["etag","string"],["type","string"])}catch(e){throw new o.DCXError(o.DCXError.INVALID_STATE,"Invalid record data",e)}let i={versionId:"0",componentId:s.id,cloudAssetId:e,compositeId:t,repositoryId:r,componentRevisionId:s.version,type:s.type,cloudExpiration:void 0,size:s.length,etag:s.etag,hashType:"md5",hashValue:s.md5};return a.pruneUndefined(i)}(this.compositeAssetId,this.compositeId,this.repositoryId,t))}getComponentURL(e,t){let r=this._checkRAPIComponentParams(t);return e.getCompositeComponentUrlForDownload({repositoryId:this.repositoryId,assetId:this.compositeAssetId},t,r.length,r.version)}getComponent(e,t,r){let s=this._checkRAPIComponentParams(t);return e.getCompositeComponent({repositoryId:this.repositoryId,assetId:this.compositeAssetId},t,s.version,r)}_checkRAPIComponentParams(e){if(!this.repositoryId)throw new o.DCXError(o.DCXError.INVALID_STATE,"Repository ID must be defined.",void 0,void 0,{componentId:e});let t=this.records[e];if(!t)throw new o.DCXError(o.DCXError.INVALID_PARAMS,"UploadRecord does not exist",void 0,void 0,{componentId:e});return t}}function p(e,t,r){return a.validateParams(["compositeId",e,"string",!0],["compositeAssetId",t,"string"],["repositoryId",r,["string","undefined"]]),new u(e,t,r)}function _(e,t,r,s,o,i){return a.validateParams(["componentId",e,"string"],["etag",t,"string"],["version",r,"string"],["md5",s,"string"],["length",o,"number"],["type",i,"string"]),new c(e,t,r,s,o,i)}function f(e,t,r){let o;a.validateParams(["repoUploadResults",t,"object"],["compositeId",r,"string",!0]),a.validateObject(t,"repoUploadResults",["result","object"]);let i=t.asset||t.compositeAsset,{result:n}=t;if(!(i.assetId&&i.repositoryId||i.links||n.links))throw new d.default(d.default.INVALID_PARAMS,"AdobeRepoUploadResult#asset object missing repositoryId or assetId, and links");let l=_(n.id,n.etag,n.revision,n.md5,n.length,n.type);if(i.assetId&&i.repositoryId)o=h.default.resolve(p(r,i.assetId,i.repositoryId));else{a.validateParams(["session",e,"object"]);let t=i.links||n.links,l=s.assertLinksContainAny(t,[s.LinkRelation.PRIMARY,s.LinkRelation.ID,s.LinkRelation.PATH,s.LinkRelation.COMPONENT]),h=a.getLinkHrefTemplated(t,l,{component_id:"manifest"});o=e.headHTTPResource(h).then(e=>{let t=e.headers["repository-id"],s=e.headers["asset-id"];if(!t||!s)throw new d.default(d.default.INVALID_DATA,"Fetched data missing repositoryId or assetId");return p(r,s,t)})}return o.then(e=>(e.addUploadRecord(n.id,l),e))}let g=i.newDebug("dcx:repoapisession"),m=i.AdobeDCXLogger.getInstance(),E="+dcx";class A{constructor(e,t,r){this._authenticationAllowList=["adobe.com","adobe.io","adobelogin.com","fotolia.net"],this._blockUploadThreshold=s.DEFAULT_BLOCK_UPLOAD_THRESHOLD,a.validateParams(["httpService",e,"object"],["server",t,"string"]),this._service=e,this._service._repoAPIBaseUrl=t;let o=a.endPointOf(t);if(!o)throw new d.default(d.default.INVALID_PARAMS,"Could not determine endpoint from: "+t);this._endPoint=o,a.isObject(r)&&a.isAnyFunction(r.getIndexLinks)?this._linksCache=r:this._linksCache=new s.RepositoryLinksCache}get serviceConfig(){return{service:this._service,cache:this._linksCache}}get blockUploadThreshold(){return this._blockUploadThreshold}set blockUploadThreshold(e){a.validateParam("threshold",e,"+number"),this._blockUploadThreshold=e}get blockDownloadThreshold(){return s.getBlockDownloadThreshold()}set blockDownloadThreshold(e){a.validateParam("threshold",e,"+number"),s.setBlockDownloadThreshold(e)}createAsset(e,t,r,o,i,n,a,l,d){return s.createAsset(this._service,e,t,r,o,i,n,a,l,d)}createComposite(e,t,r,i,n,l,h,c){if(g("createComposite()"),a.validateParams(["parentDir",e,"object"],["relPath",t,"string"],["contentType",r,"string"]),!r.endsWith(E))throw new d.default(d.default.INVALID_PARAMS,`Composite contentType must end in "${E}"`);if(!s.isMinimalAdobeAsset(e))throw new d.default(d.default.INVALID_PARAMS,"parentDir must contain links or repositoryId & assetId or path");return this.createAsset(e,t,!0,l&&r.endsWith("dcx")?r+"ucf":r,i,n,l,h,c).catch(r=>{if(!r.response||409!==r.response.statusCode)throw o.unexpectedResponse("Error creating composite",r,r.response);if(r.response.headers.link){let t=s.parseLinksFromResponseHeader(r.response);this._linksCache.setValueWithAsset(t,{assetId:r.response.headers["asset-id"]||r.response.headers["x-resource-id"],repositoryId:e.repositoryId})}throw new d.default(d.default.ALREADY_EXISTS,"Composite already exists at "+t,void 0,r.response)})}copyResources(e,t,r,o,i,n){return s.copyAssetResources(this._service,e,t,r,o,i,n)}getIndexLinks(e){return s.getIndexLinks(this.serviceConfig,e)}getIndexRepository(e){return s.getIndexRepository(this.serviceConfig,e)}getIndexDocument(e){return s.getIndexDocument(this.serviceConfig,e)}getDiscoverableAssets(e={},t){return s.getDiscoverableAssets(this.serviceConfig,e,t)}getDiscoverableRepos(e={},t){return s.getDiscoverableRepos(this.serviceConfig,e,t)}headHTTPResource(e,t){return s.headHTTPResource(this._service,e,t)}headCompositeManifest(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.COMPONENT],t).then(()=>s.headCompositeManifest(this._service,e,t))}resolveAsset(e,t="id",r,o,i){return s.resolveAsset(this.serviceConfig,e,t,r,o,i)}headPrimaryResource(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY],t).then(()=>s.headPrimaryResource(this.serviceConfig,e,t))}getRepoMetadata(e,t){return this.useLinkOrResolveResource(e,s.LinkRelation.REPO_METADATA,"json",t).then(e=>({result:s.deserializeAsset(e.response.response),response:e.response}))}getEmbeddedMetadata(e,t="json",r){return a.validateParams(["asset",e,"object"],["format",t,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA],r).then(()=>s.getEmbeddedMetadata(this._service,e,t))}putEmbeddedMetadata(e,t,r,o="json",i){return a.validateParams(["asset",e,"object"],["data",t,["string","object","object[]"]],["etag",r,"string",!0],["format",o,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA],i).then(()=>s.putEmbeddedMetadata(this._service,e,t,r,o,i))}patchEmbeddedMetadata(e,t,r,o){return a.validateParams(["asset",e,"object"],["data",t,["string","object","object[]"]],["etag",r,"string",!0]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA],o).then(()=>s.patchEmbeddedMetadata(this._service,e,t,r,o))}getDirectory(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE],r).then(()=>s.getPagedChildren(this._service,e,t,r).then(e=>({result:s.directoryTransformer(e.paged.data)[1],paged:e.paged,response:e.response})))}getDirectoryByURL(e){return s.getDirectoryByURL(this._service,e).then(e=>({response:e.response,result:s.deserializeAsset(e.result)}))}getLinksForAsset(e,t){return s.getLinksForAsset(this.serviceConfig,e,t)}getACLPolicy(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.ACL_POLICY],t).then(()=>s.getACLPolicy(this._service,e,t))}getPrimaryResource(e,t,r){let o={};return this._withSourcePromise(o).then(()=>this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY],r)).then(()=>s.getPrimaryResource.call(o,this._service,e,t,r))}updatePrimaryResource(e,t,r,o,i,n,a){return this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY],a).then(()=>s.updatePrimaryResource(this._service,e,t,r,o,i,n,a))}getRepositoryResource(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.REPOSITORY],t).then(()=>s.getRepositoryResource(this._service,e,t))}getVersions(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE],r).then(()=>s.getPagedVersions(this._service,e,t,r).then(e=>({result:s.deserializeVersionSet(e.result),response:e.response,paged:e.paged})))}getVersionResource(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE],r).then(()=>s.getVersionResource(this._service,e,t,r).then(e=>({result:s.deserializeVersion(e.result),response:e.response})))}blockDownloadAsset(e,t,r,o,i,n,a,l){if("string"==typeof e)return s.doBlockDownload(this._service,e,t,r,o,i,n,a,l);let d={};return this._withSourcePromise(d).then(()=>this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY])).then(()=>s.doBlockDownload.call(d,this._service,e,t,r,o,i,n,a,l))}fetchLinksIfMissing(e,t,r){return s.fetchLinksIfMissing(this.serviceConfig,e,t,void 0,r)}useLinkOrResolveResource(e,t,r,o){return s.useLinkOrResolveResource(this.serviceConfig,e,t,r,o).then(t=>(e.links!==t.result.links&&(e.links=a.merge(e.links||{},t.result.links),this._linksCache.setValueWithAsset(e.links,e)),t))}getLinkHrefForAsset(e,t,r="id",s){return this.fetchLinksIfMissing(e,[t],s).then(e=>a.getLinkHref(e,t,r))}getEffectivePrivileges(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.EFFECTIVE_PRIVILAGES],t).then(()=>s.getEffectivePrivileges(this._service,e,t))}checkACLPrivilege(e,t,r,o){return this.fetchLinksIfMissing(e,[s.LinkRelation.ACCESS_CHECK],o).then(()=>s.checkACLPrivilege(this._service,e,t,r,o))}headAppMetadata(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA],t).then(()=>s.headAppMetadata(this.serviceConfig,e,t))}getAppMetadata(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA],r).then(()=>s.getAppMetadata(this._service,e,t,r))}putAppMetadata(e,t,r,o){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA],o).then(()=>s.putAppMetadata(this._service,e,t,r,o))}patchAppMetadata(e,t,r,o){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA],o).then(()=>s.patchAppMetadata(this._service,e,t,r))}getCompositeManifestUrl(e,t,r){a.validateParams(["asset",e,"object"],["version",t,"string",!0]);let o=this._getAsAdobeAsset(e);return o.version=t||o.version,this.fetchLinksIfMissing(o,[s.LinkRelation.MANIFEST],r).then(()=>s.getCompositeManifestUrl(this._service,o,t,r))}getCompositeManifest(e,t,r,o){a.validateParams(["asset",e,"object"],["version",t,"string",!0],["etag",r,"string",!0]);let i=this._getAsAdobeAsset(e);return i.version=t||i.version,this.fetchLinksIfMissing(i,[s.LinkRelation.MANIFEST],o).then(()=>s.getCompositeManifest(this._service,i,t,r,o))}getManifestAndComponentsByPath(e,t,r,o,i){return s.getManifestAndComponentsByPath(this.serviceConfig.service,e,t,r,o,i)}getRendition(e,t,r,o,i){return this.fetchLinksIfMissing(e,[s.LinkRelation.RENDITION]).then(()=>s.getRendition(this._service,e,t,r,o,i))}getCompositeComponentUrlForDownload(e,t,r,o,i){var n;let a=this._getAsAdobeAsset(e),l=null!=(n=this._isDCXComponentLike(e)?e.length:r)?n:0,{id:d,revision:h}=this._resolveComponentIdAndRevision(e,t,o);return l>this.blockDownloadThreshold?s.getCompositeComponentPresignedUrl(this.serviceConfig,a,d,h,i).then(({response:e,result:t})=>({response:e,isPresignedUrl:!0,url:t})):this.getCompositeComponentUrl(a,d,h,i).then(e=>({response:void 0,url:e,isPresignedUrl:!1}))}getCompositeComponentUrl(e,t,r,o){let i=this._getAsAdobeAsset(e),{id:n,revision:l}=this._resolveComponentIdAndRevision(e,t,r,!1);return this.fetchLinksIfMissing(i,[s.LinkRelation.COMPONENT],o).then(()=>(a.validateParams(["asset",i,"object"],["componentId",n,"string"],["componentRevision",l,"string",!0]),s.getCompositeComponentUrl(this._service,i,n,l)))}getCompositeComponentByPath(e,t,r,o,i){return s.getCompositeComponentByPath(this._service,this._getAsAdobeAsset(e),t,r,o,i)}getCompositeComponent(e,t,r,o,i,n){let l=this._getAsAdobeAsset(e),{id:d,revision:h}=this._resolveComponentIdAndRevision(e,t,r);return this.fetchLinksIfMissing(l,[s.LinkRelation.COMPONENT],i).then(()=>(a.validateParams(["asset",e,"object"],["componentId",d,"string"],["componentRevision",h,"string"],["responseType",o,"enum",!0,s.STREAMABLE_RESPONSE_TYPES]),s.getCompositeComponent(this._service,l,d,h,o,i,this._isDCXComponentLike(e)?e.length:n)))}putCompositeComponent(e,t,r,o,i,n,l,h,c,u){if(a.validateParams(["asset",e,"object"],["componentId",t,"string"],["contentType",o,"string"],["maybeIsNew",i,"boolean",!0],["size",n,"number",!0],["md5",l,"string",!0]),i&&!a.verifyUuid(t))throw new d.default(d.default.INVALID_PARAMS,"Component id is not a uuid");a.verifyUuid(t)||m.warn("Existing component id is not a uuid");let p=this._getAsAdobeAsset(e);return this.fetchLinksIfMissing(p,[s.LinkRelation.COMPONENT,s.LinkRelation.BLOCK_UPLOAD_INIT],c).then(()=>s.putCompositeComponent(this.serviceConfig,e,t,r,o,i,n,l,h,c,u))}getCompositeComponentsUrlsForUpload(e,t,r){return s.getCompositeComponentsUrlsForUpload(this._service,e,t,r)}performBulkRequest(e,t,r,o){return this.fetchLinksIfMissing(e,[s.LinkRelation.BULK_REQUEST],o).then(()=>s.performBulkRequest(this._service,e,t,r,o))}updateCompositeManifest(e,t,r,o=1,i,n){g("updateCompositeManifest()"),a.validateParams(["asset",e,"object"],["manifest",t,["object","string"]],["overwrite",r,"boolean"],["validationLevel",o,"+number"],["etag",i,"string",!0]);let l=this._getAsAdobeAsset(e);return this.fetchLinksIfMissing(l,[s.LinkRelation.MANIFEST],n).then(()=>s.updateCompositeManifest(this._service,l,t,r,o,i,n))}patchVersions(e,t,r,o){return a.validateParams(["asset",e,"object"],["patchDoc",t,["string","array"]],["etag",r,"string",!0]),this.fetchLinksIfMissing(e,[s.LinkRelation.VERSION_HISTORY],o).then(()=>s.patchVersions(this._service,e,t,r,o))}patchACLPolicy(e,t,r,o){return a.validateParams(["asset",e,"object"],["policy",t,["string","object"]],["etag",r,"string",!0]),this.fetchLinksIfMissing(e,[s.LinkRelation.VERSION_HISTORY],o).then(()=>s.patchACLPolicy(this._service,e,t,r,o))}deleteACLPolicy(e,t){return a.validateParams(["asset",e,"object"]),this.fetchLinksIfMissing(e,[s.LinkRelation.ACL_POLICY],t).then(()=>s.deleteACLPolicy(this._service,e,t))}copyAsset(e,t,r,o,i,n){return s.copyAsset(this.serviceConfig,e,t,r,o,i,n)}moveAsset(e,t,r,o,i){return s.moveAsset(this.serviceConfig,e,t,r,o,i)}deleteAsset(e,t,r,o){return s.deleteAsset(this.serviceConfig,{repositoryId:e.repositoryId,path:e.path,assetId:e.assetId},t,r,o).then(t=>(this._linksCache.deleteWithAsset(e),t))}discardAsset(e,t,r,o){return s.discardAsset(this.serviceConfig,{repositoryId:e.repositoryId,path:e.path,assetId:e.assetId},t,r,o)}restoreAsset(e,t){return s.restoreAsset(this.serviceConfig,e,t)}packageAssets(e,t,r,o,i){return s.packageAssets(this.serviceConfig,e,t,r,o,i)}performOperation(e,t){return s.getOpsHref(this.serviceConfig,t).then(r=>s.doOperation(this._service,r,e,t))}performBatchOperation(e,t){return s.getOpsHref(this.serviceConfig).then(r=>s.doBatchOperation(this._service,r,e,t))}uploadResultsFromAdobeRepoUploadResult(e,t){return f(this,e,t)}updateCachedAssetLinks(e){if(!e.assetId)throw new d.default(d.default.INVALID_PARAMS,"Asset must contain an assetId");this._linksCache.setValueWithAsset(e.links||e._links,e)}updateCachedIndexLinks(e){if(!e)throw new d.default(d.default.INVALID_PARAMS,"Index LinkSet must not be null");this._linksCache.setIndexLinks(e)}getLinksCache(){return this._linksCache}setLinksCache(e){this._linksCache=e}clearLinksCache(){this._linksCache.clear()}_resolveComponentIdAndRevision(e,t,r,o=!0){var i;if(this._isDCXComponentLike(e))return{revision:e.version,id:e.id};if(!t)throw new d.default(d.default.INVALID_PARAMS,"Missing componentId.");if(!1===o||r)return{revision:r,id:t};if(!s.isAdobeDCXCompositeLike(e)||!t)throw new d.default(d.default.INVALID_PARAMS,"Could not determine component revision");let n=null==(i=e.current)?void 0:i.getComponentWithId(t);if(void 0===(null==n?void 0:n.version))throw new d.default(d.default.INVALID_PARAMS,"Could not determine component revision");return{revision:n.version,id:t}}_isDCXComponentLike(e){return!!a.isObject(e)&&null!=e.owner&&s.isAdobeDCXBranchLike(e.owner)}_withSourcePromise(e){return h.default.resolve(void 0,e)}_getAsAdobeAsset(e){if("object"!=typeof e||Array.isArray(e))throw new d.default(d.default.INVALID_PARAMS,"Invalid asset-like object.");if(s.isMinimalAdobeAsset(e))return e;let t,r={};if(("repositoryId"in e||"assetId"in e||"links"in e||"version"in e)&&(r={repositoryId:e.repositoryId,assetId:e.assetId,links:e.links,version:e.version}),s.isAdobeDCXBranchLike(e)&&(t=e._core),this._isDCXComponentLike(e)||t){let s=t||(e&&e.owner&&e.owner._core?e.owner._core:void 0);if(s){let e=s._getSourceAssetInfoOfComponent(r);e&&"object"==typeof e&&(r.assetId=e.compositeAssetId||r.assetId,r.repositoryId=e.compositeRepositoryId||r.repositoryId,r.links=e.links||r.links,r.version=e.version||r.version)}}return r.assetId=r.assetId?r.assetId:e.owner?e.owner.compositeAssetId:e.compositeAssetId,r.repositoryId=r.repositoryId?r.repositoryId:e.owner?e.owner.compositeRepositoryId:e.compositeRepositoryId,r}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new d.default(d.default.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}_resolveUrl(e){return a.endPointOf(e)?e:a.appendPathElements(this._service._repoAPIBaseUrl||this._service.server,e)}registerLinks(e,t,r){e=e._links||e;let s={assetId:r||"urn:aaid:faux:"+a.generateUuid(),repositoryId:t||"faux-repo-id"};return this._linksCache.setValueWithAsset(e,s),s}}t.AdobeRepoAPISession=A,t.CURRENT_COMPONENT_DESCRIPTOR_HASH_TYPE="md5",t.CURRENT_COMPONENT_DESCRIPTOR_VERSION="0",t.createRepoAPISession=(e,t,r)=>new A(e,t,r),t.createUploadRecord=_,t.createUploadResults=p,t.uploadResultsFromAdobeRepoUploadResult=f,t.uploadResultsFromComponentDescriptor=function(e){let t;a.validateParams(["decriptor",e,"string"]);try{t=JSON.parse(e)}catch(e){throw new d.default(d.default.INVALID_JSON,"Invalid component descriptor",e)}switch(t.versionId){case"0":case void 0:if(!t.repositoryId)throw new d.default(d.default.INVALID_DATA,"Component descriptor missing repositoryId");try{let e=p(t.compositeId,t.cloudAssetId,t.repositoryId),r=_(t.componentId,t.etag,t.componentRevisionId,t.hashValue,t.size,t.type);return e.addUploadRecord(t.componentId,r),e}catch(e){throw new d.default(d.default.INVALID_DATA,"Invalid component descriptor",e)}default:throw new d.default(d.default.INVALID_DATA,"ComponentDescriptor serialization versionId not valid or not yet handled.")}}},42173:function(e,t,r){let s;Object.defineProperty(t,"__esModule",{value:!0});var o=r(254914),i=r(247673);let n=e=>a(e)&&(l(e.pipe)||l(e.pipeTo)),a=e=>null!=e&&"object"==typeof e,l=e=>"function"==typeof e,d=e=>Array.isArray(e),h=()=>{try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(e){return!1}},c=()=>"object"==typeof self&&self.self===self,u=()=>"browser",p=(...e)=>e&&Array.isArray(e)&&!(e.length<1)?e.reduce((e,t)=>{let r=a(e)?e:{};if(a(t))for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e]);return r}):{},_=(e,...t)=>{if(!t.length)return e;let r=t.shift();if(a(e)&&a(r))for(let t in r)a(r[t])&&!d(r[t])?(e[t]||Object.assign(e,{[t]:{}}),_(e[t],r[t])):(d(e[t])&&d(r[t]),Object.assign(e,{[t]:r[t]}));return _(e,...t)},f=/^(CON|PRN|AUX|NUL|COM\d|LPT\d)(\..+)?$/,g=/[\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F\u007C]/,m=(e,t=!1)=>{try{if(e.length>65535)return!1;let r=(t?e.slice(1):e).split("/");if(!r||0===r.length)return!1;for(let e of r)if(e.length<1||e.length>255||g.test(e)||e.endsWith(".")||e.endsWith(" ")||f.test(e)||e.startsWith("dcx")||e.startsWith(".dcx")||"manifest"===e||"mimetype"===e)return!1;return!(t&&(!e.startsWith("/")||e.endsWith("/")))}catch(e){return!1}},E=()=>{},A=(e,t,r)=>{let s={},o,i=Object.keys(e),n=i.length;for(let l=0;l<n;l++){if(o=i[l],!r||!r[o]){let s=e[o],i=t[o];if(typeof s!=typeof i)return!1;if(a(s)&&a(i)){if(!A(s,i,r))return!1}else if(s!==i)return!1}s[o]=!0}n=(i=Object.keys(t)).length;for(let e=0;e<n;e++)if(!s[o=i[e]])return!1;return!0},y=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),D=e=>{let t=e.match(y)||[];return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},C=e=>{let t=e.charCodeAt(0);return t>=48&&t<=57||t>=97&&t<=102||t>=65&&t<=70},I=e=>e.length>=3&&"%"===e.charAt(0)&&C(e.charAt(1))&&C(e.charAt(2)),v=e=>{let t=e.charCodeAt(0);return t>=48&&t<=57?t-48:t>=97&&t<=102?10+t-97:t>=65&&t<=70?10+t-65:0},b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.~",T="0123456789ABCDEF",P=e=>{let t=[];for(let r=0;r<128;++r)t.push(-1!==e.indexOf(String.fromCharCode(r)));return t},R=P(b+":/?#[]@!$&'()*+,;="),w=P(b),O=P(b+"/"),k=(e,t)=>{if(e<128&&t[e])return String.fromCharCode(e);let r="%";return r+=T.charAt(e>>4&15),r+=T.charAt(15&e)},S=e=>{let t=[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t.push(s):s<2048?t.push(192|s>>6,128|63&s):s<55296||s>=57344?t.push(224|s>>12,128|s>>6&63,128|63&s):++r<e.length&&(s=65536+((1023&s)<<10|1023&e.charCodeAt(r)),t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return t},N=(e,t)=>{let r=S(e),s="";for(let e=0;e<r.length;e++)s+=k(r[e],t);return s},L=e=>N(e=e.normalize("NFC"),w),M=e=>{e=e.normalize("NFC");let t=0,r="";for(;t<e.length;)I(e.substr(t))?(r+=e.substr(t,3),t+=3):r+=N(e.charAt(t++),R);return r},X=(e,t)=>{var r;let s=0,o="",i=!1,n=!1,a=!1,l=!0,d=!0,h=!1,c="",u="",p=",",_=-1,f=e=>{if(o+=l?u:h||d?p:",",n&&c&&(l||h||d)&&(o+=L(c),(!a||e.length>0)&&(o+="=")),e){let t;t=i?M(e):L(e),_>0&&(t=((e,t)=>{let r=0;for(;r<e.length&&t>0;){if(I(e.substr(r))){let t=(v(e.substr(r+1))<<4)+v(e.substr(r+2));if(r+=3,!(192&~t))for(;r<e.length&&I(e.substr(r))&&(t=(v(e.substr(r+1))<<4)+v(e.substr(r+2)),r+=3,128==(192&t)););}else++r;--t}return e.substr(0,r)})(t,_)),o+=t}l=!1,d=!1};for(;s<e.length;)if("{"===e.charAt(s)){if(++s<e.length){switch(i=!1,n=!1,u="",p=",",a=!1,e.charAt(s++)){case"+":i=!0;break;case"#":u="#",i=!0;break;case".":u=".",p=".";break;case"/":u="/",p="/";break;case";":u=";",p=";",n=a=!0;break;case"?":u="?",p="&",n=!0;break;case"&":u="&",p="&",n=!0;break;default:--s}for(c="",l=!0,d=!0;s<e.length;)if("}"===e.charAt(s)||","===e.charAt(s)||"*"===e.charAt(s)||":"===e.charAt(s)){if(h=!1,_=-1,"*"===e.charAt(s)){if(h=!0,++s>=e.length)break}else if(":"===e.charAt(s)){if(++s>=e.length)break;for(e.charCodeAt(s)>=49&&57>=e.charCodeAt(s)&&(_=0);s<e.length&&e.charCodeAt(s)>=48&&57>=e.charCodeAt(s)&&_<1e4;)_=10*_+(e.charCodeAt(s++)-48);if(s>=e.length)break}for(;s<e.length&&"}"!==e.charAt(s)&&","!==e.charAt(s);)++s;if(c.length>0&&"*"===c.charAt(c.length-1)&&(h=!0,c=c.substr(0,c.length-1)),c.length>0){let e=t?t[c]:void 0;if(e||""===e)if(Array.isArray(e)){_=-1;for(let t=0;t<e.length;t++)f(String(e[t]))}else if("object"==typeof e&&null!==e)for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r=String(e[t]),o+=l?u:h||d?p:",",n&&c&&l&&!h&&(o+=L(c),(!a||r.length>0)&&(o+="=")),t&&(o+=i?M(t):L(t),o+=h?"=":",",r&&(o+=i?M(r):L(r))),l=!1,d=!1);else f(String(e))}if("}"===e.charAt(s++))break;c="",d=!0}else c+=e.charAt(s++)}}else I(e.substr(s))?(o+=e.substr(s,3),s+=3):o+=N(e.charAt(s++),R);return o},x=(e,t)=>e&&t?e.indexOf(t):-1,B=e=>e?e.search("(text|image|audio|video|ingredient|document|model|application|font)\\/"):-1;function j(e,t,r,s){return new(r||(r=Promise))(function(o,i){function n(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,a)}l((s=s.apply(e,t||[])).next())})}function U(e){return this instanceof U?(this.v=e,this):new U(e)}function H(e,t){return e?(null!=t&&(e=e.slice(0,t)),(new TextDecoder).decode(e)):""}function V(e){return(new TextEncoder).encode(e)}let F=[/^(?!^501$|^507$)^(5\d{2})$|429|423$/],Y=(e,t)=>"object"==typeof e&&"function"==typeof e.test?e.test(t.toString()):t===e,W=/^([^:]+):(.*)$/,q=/^\s+|\s+$/g,z=(e,t,r)=>d(t)?new i.DCXError(i.DCXError.INVALID_PARAMS,`Param '${e}' type must be one of: [${t.join(",")}].${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`):new i.DCXError(i.DCXError.INVALID_PARAMS,`Param '${e}' must be of type '${t}'.${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`),G=(e,t,r,s=!1,o=[])=>{if(s&&null==t)return!0;if(d(r)){for(let i in r){let n=r[i];try{return G(e,t,n,s,o),!0}catch(e){}}throw z(e,r,o)}if("null"===r&&null!==t||"undefined"===r&&void 0!==t||"nullish"===r&&null!=t)throw z(e,r,o);if("null"===r||"undefined"===r||"nullish"===r)return!0;if(!s&&null==t)throw z(e,r,o);if(r.endsWith("[]")){if(!d(t))throw z(e,r,o);return t.forEach((t,s)=>{G(`${e}[${s}]`,t,r.substr(0,r.length-2))}),!0}let i=r.toLowerCase();switch(r){case"integer":case"+number":case"-number":i="number"}if("array"===i){if(!d(t))throw z(e,r,o)}else if("enum"!==i&&(typeof t!==i||"integer"===r&&("number"!=typeof t||!Number.isInteger(t))||"+number"===r&&("number"!=typeof t||t<0)||"-number"===r&&("number"!=typeof t||t>0)))throw z(e,r,o);if(o.length>0){let s=o.length,i=!1;for(let e=0;e<s;e++)if(o[e]===t){i=!0;break}if(!i)throw z(e,r,o)}return!0};function K(...e){return e.map(e=>G(...e))}function $(e,t){let r={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&void 0!==e[t]&&(r[t]=1);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0!==t[e]&&delete r[e];return Object.keys(r)}function J(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function Z(e,t,r,s=Z){if(e===t)return[];let o=d(e),i=d(t);return o&&i?function(e,t,r,s){let o={"0,0":{operations:[],cost:0}},i=isNaN(e.length)||e.length<=0?0:e.length,[n]=(function r(i,n){let a=`${i},${n}`,l=o[a];if(void 0===l){if(i>0&&n>0&&!s(e[i-1],t[n-1],new et).length)l=r(i-1,n-1);else{let s=[];if(i>0){let e=r(i-1,n);s.push(J(e,{op:"remove",index:i-1}))}if(n>0){let e=r(i,n-1),o={op:"add",index:i-1,value:t[n-1]};s.push(J(e,o))}if(i>0&&n>0){let o=r(i-1,n-1),a={op:"replace",index:i-1,original:e[i-1],value:t[n-1]};s.push(J(o,a))}l=s.sort((e,t)=>e.cost-t.cost)[0]}o[a]=l}return l})(i,isNaN(t.length)||t.length<=0?0:t.length).operations.reduce(([e,t],o)=>{if("add"===o.op){let s=o.index+1+t,n=s<i+t?String(s):"-",a={op:o.op,path:r.add(n).toString(),value:o.value};return[e.concat(a),t+1]}if("remove"===o.op){let s={op:o.op,path:r.add(String(o.index+t)).toString()};return[e.concat(s),t-1]}let n=r.add(String(o.index+t)),a=s(o.original,o.value,n);return[e.concat(...a),t]},[[],0]);return n}(e,t,r,s):!o&&!i&&a(e)&&a(t)?function(e,t,r,s){let o=[];return $(e,t).forEach(e=>{o.push({op:"remove",path:r.add(e).toString()})}),$(t,e).forEach(e=>{o.push({op:"add",path:r.add(e).toString(),value:t[e]})}),(function(e){let t=e.length,r={};for(let s=0;s<t;s++){let t=e[s];for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0!==t[e]&&(r[e]=(r[e]||0)+1)}for(let e in r)r[e]<t&&delete r[e];return Object.keys(r)})([e,t]).forEach(i=>{o.push(...s(e[i],t[i],r.add(i)))}),o}(e,t,r,s):[{op:"replace",path:r.toString(),value:t}]}function Q(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ee(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}class et{constructor(e=[""]){this.tokens=e}static fromJSON(e){let t=e.split("/").map(Q);if(""!==t[0])throw new i.DCXError(i.DCXError.INVALID_DATA,`Invalid JSON Pointer: ${e}`);return new et(t)}toString(){return this.tokens.map(ee).join("/")}evaluate(e){let t=null,r="",s=e;for(let e=1,o=this.tokens.length;e<o;e++)s=((t=s)||{})[r=this.tokens[e]];return{parent:t,key:r,value:s}}get(e){return this.evaluate(e).value}set(e,t){let r=e;for(let e=1,t=this.tokens.length-1,s=this.tokens[e];e<t;e++)r=(r||{})[s];r&&(r[this.tokens[this.tokens.length-1]]=t)}push(e){this.tokens.push(e)}add(e){return new et(this.tokens.concat(String(e)))}}class er{get operations(){return this._operations}constructor(e=[]){this._operations=e}getDocument(){return JSON.stringify(this._operations)}add(e,t){return K(["path",e,"string"]),this._operations.push({op:"add",path:e,value:t}),this}addToList(e,t,r){if(K(["path",e,"string"]),"number"!=typeof r&&"end"!==r&&"-"!==r)throw new i.DCXError(i.DCXError.INVALID_PARAMS,'Index must be a number, or either "end"/"-" to append to end.');return this._operations.push({op:"add",value:t,path:`${e.endsWith("/")?e:e+"/"}${"end"===r?"-":r}`}),this}remove(e){return K(["path",e,"string"]),this._operations.push({op:"remove",path:e}),this}replace(e,t){return K(["path",e,"string"]),this._operations.push({op:"replace",path:e,value:t}),this}move(e,t){return K(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"move",from:e,path:t}),this}copy(e,t){return K(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"copy",from:e,path:t}),this}}function es(e,t){return{property:e,issue:t}}function eo(e){let t=[];if("object"!=typeof e||null==e||d(e))return t.push(es("*","Operation not an object.")),t;switch("string"!=typeof e.path&&t.push(es("path","Missing or invalid.")),e.op){case"remove":break;case"add":case"replace":null==e.value&&t.push(es("value","Missing or invalid. Required for add/replace."));break;case"move":case"copy":"string"!=typeof e.from&&t.push(es("from","Missing or invalid. Required for move/copy."));break;default:t.push(es("op","Missing or invalid."))}return!(t.length>0)||t}function ei(e,t={mode:"id"}){let r=e[0],s=0;for(let o of e){let e=0;for(let r in o)r in t&&o[r]===t[r]&&e++;e>s&&(s=e,r=o)}return r}function en(e){if(!a(e))throw Error("Expecting object");let t={};for(let r in e)null!=e[r]&&(t[r]=e[r]);return t}let ea=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,el=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ed=/\s|\uFEFF|\xA0/,eh=/\r?\n[\x20\x09]+/g,ec=/[;,"]/,eu=/[;,"]|\s/;function ep(e){return e.replace(el,"")}function e_(e){return ed.test(e)}class ef{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){let t=[];for(let r=0;r<this.refs.length;r++)this.refs[r].rel===e&&t.push(this.refs[r]);return t}get(e,t){e=e.toLowerCase();let r=[];for(let s=0;s<this.refs.length;s++)this.refs[s][e]===t&&r.push(this.refs[s]);return r}set(e){return this.refs.push(e),this}has(e,t){e=e.toLowerCase();for(let r=0;r<this.refs.length;r++)if(this.refs[r][e]===t)return!0;return!1}parse(e,t=0){let r=t?e.slice(t):e;r=ep(r).replace(eh,"");let s=1,o=r.length,i=0,n=null;for(;i<o;)if(1===s){if(e_(r[i])){i++;continue}if("<"!==r[i])throw Error('Unexpected character "'+r[i]+'" at offset '+i);{let e=r.indexOf(">",i);if(-1===e)throw Error("Expected end of URI delimiter at offset "+i);n={uri:r.slice(i+1,e)},this.refs.push(n),i=e,s=2}i++}else if(2===s){if(e_(r[i])){i++;continue}if(";"===r[i])s=4,i++;else{if(","!==r[i])throw Error('Unexpected character "'+r[i]+'" at offset '+i);s=1,i++}}else{if(4!==s)throw Error('Unknown parser state "'+s+'"');{if(";"===r[i]||e_(r[i])){i++;continue}let e=r.indexOf("=",i);if(-1===e)throw Error("Expected attribute delimiter at offset "+i);let t=ep(r.slice(i,e)).toLowerCase(),a="";if(i=function(e,t){for(;e_(e[t]);)t++;return t}(r,i=e+1),'"'===r[i])for(i++;i<o;){if('"'===r[i]){i++;break}"\\"===r[i]&&i++,a+=r[i],i++}else{let e=i+1;for(;!ec.test(r[e])&&e<o;)e++;a=r.slice(i,e),i=e}if(n&&n[t]&&em(t));else if(n&&"*"===t[t.length-1])n[t]=eA(a);else if(a="rel"===t||"type"===t?a.toLowerCase():a,n&&null!=n[t]){let e=n[t];d(e)?e.push(a):n[t]=[n[t],a]}else{if(!n)throw Error("Unexpected null ref");n[t]=a}switch(r[i]){case",":s=1;break;case";":s=4}i++}}return n=null,this}toString(){let e,t=[];for(let r=0;r<this.refs.length;r++)e=this.refs[r],t.push(Object.keys(this.refs[r]).reduce(function(t,r){return"uri"===r?t:t+"; "+ey(r,e[r])},"<"+e.uri+">"));return t.join(", ")}}let eg=e=>ea.test(e),em=e=>"rel"===e||"type"===e||"media"===e||"title"===e||"title*"===e,eE=e=>e.replace(/"/g,'\\"'),eA=e=>{let t=/([^']+)?(?:'([^']+)')?(.+)/.exec(e)||[];return{language:t[2].toLowerCase(),encoding:eg(t[1])?null:t[1].toLowerCase(),value:eg(t[1])?decodeURIComponent(t[3]):t[3]}},ey=(e,t)=>{var r,s;return Array.isArray(t)?t.map(t=>ey(e,t)).join("; "):"*"===e[e.length-1]||"string"!=typeof t?((e,t)=>{let r=(t.encoding||"utf-8").toUpperCase(),s=t.language||"en",o="";return o=Buffer.isBuffer(t.value)&&eg(r)?t.value.toString(r):Buffer.isBuffer(t.value)?t.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodeURIComponent(t.value),e+"="+r+"'"+s+"'"+o})(e,t):("rel"===e||"type"===e||"anchor"===e?(r=t,t=eu.test(r)?'"'+eE(t)+'"':eE(t)):(s=t,eu.test(s)&&(t='"'+(t=(t=encodeURIComponent(t)).replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"))+'"')),e+"="+t)};function eD(e,t,r,s="id"){let o=eb(e)[t];if(o){if(Array.isArray(o)){let e=o.filter(e=>e.mode===s);return e.length>0?e[0][r]:o.length>0?o[0][r]:void 0}return o[r]}}function eC(e,t,r="id"){let s,o=eb(e),n=o[t];if(a(n)&&"string"==typeof n.href?s=n.href:Array.isArray(n)&&(s=eD(o,t,"href",r)),"string"!=typeof s)throw new i.DCXError(i.DCXError.INVALID_PARAMS,"Missing or invalid link href.");return s}function eI(e,t,r,s="id"){return X(eC(eb(e),t,s),en(r))}let ev=(e,t=0)=>(new ef).parse(e,t);function eb(e){return a(e)?"_links"in e?e._links:"links"in e?e.links:e:{}}let eT=()=>{if(s)return s;let e=h();return s=e&&a(r.g.performance)&&l(r.g.performance.now)?r.g.performance:e&&a(r.g.perf_hooks)&&a(r.g.perf_hooks.performance)&&l(r.g.perf_hooks.performance.now)?r.g.perf_hooks.performance:c()&&a(self.performance)&&l(self.performance.now)?self.performance:Date},eP=()=>eT().now(),eR=e=>j(void 0,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))}),ew=Object.freeze({__proto__:null,Link:ef,getLinkProperty:eD,getLinkHref:eC,getLinkHrefTemplated:eI,parse:ev});t.DEFAULT_RETRY_CODES=F,t.EventEmitter=class{constructor(e){this._handlers={},e.forEach(e=>{this._handlers[e]=[]})}on(e,t){return this._handlers[e].push(t)-1}emit(e,t){this._handlers[e].forEach(e=>{l(e)&&e(...t)})}removeHandler(e,t){delete this._handlers[e][t]}removeAllHandlers(e){e?this._handlers[e]=[]:this._handlers={}}},t.JSONPatchPointer=et,t.Link=ef,t.LinkUtils=ew,t.SDKType=u,t.WatchProxy=function(e){if(e.__watch_proxy__)return e;if("watchProperty"in e)throw Error("Cannot proxy object, watchProperty already exists.");let t={},r=((e,r)=>{t[e]=t[e]||[],t[e].push(r)}).bind({listeners:t}),{proxy:s,revoke:o}=Proxy.revocable(e,{set:function(e,r,s){try{r in t&&d(t[r])&&t[r].map(t=>t.call(void 0,s,e[r],e))}catch(e){throw e}return e[r]=s,!0}});return Object.defineProperty(s,"__watch_proxy__",{value:!0,enumerable:!1,configurable:!0}),Object.defineProperty(s,"revokeWatchProxy",{value:()=>(o(),t={},delete e.__watch_proxy__,delete e.revokeWatchProxy,delete e.watchProperty,e),enumerable:!1,configurable:!0}),Object.defineProperty(s,"watchProperty",{value:r,enumerable:!1,configurable:!0}),s},t._toUTF8Array=S,t.appendPathElements=(...e)=>{if(!e||!Array.isArray(e))return"";let t=[],r=e.length;for(let s=0;s<r;s++){let o=e[s];"string"==typeof o&&""!==o&&(0===s&&1!==o.length||"/"===o.charAt(0)&&(o=o.slice(1)),s!==r-1&&"/"===o.charAt(o.length-1)&&(o=o.slice(0,o.length-1)),t.push(o))}return t.join("/")},t.arrayBufferToString=H,t.assert=(e,t)=>{if(!1===e())throw new i.DCXError(i.DCXError.INVALID_PARAMS,t)},t.asyncIterableFromStream=function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=r.apply(e,t||[]),i=[];return s={},n("next"),n("throw"),n("return"),s[Symbol.asyncIterator]=function(){return this},s;function n(e){o[e]&&(s[e]=function(t){return new Promise(function(r,s){i.push([e,t,r,s])>1||a(e,t)})})}function a(e,t){var r;try{(r=o[e](t)).value instanceof U?Promise.resolve(r.value.v).then(l,d):h(i[0][2],r)}catch(e){h(i[0][3],e)}}function l(e){a("next",e)}function d(e){a("throw",e)}function h(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();try{for(;;){let{done:e,value:r}=yield U(t.read());if(e)return yield U(void 0);yield yield U(r)}}finally{t.releaseLock()}})},t.checkRetriable=function(e,t=F){return!!e&&(Array.isArray(t)?t.some(t=>Y(t,e)):Y(t,e))},t.chunkArray=function(e,t){return e.reduce((e,r,s)=>(s%t==0?e.unshift([r]):e[0].push(r),e),[]).reverse()},t.combineInPlace=function(...e){if(e.length<2)return;let t=e.shift();p(t,...e),e.map(e=>{Object.assign(t,e)})},t.concatUint8Arrays=function(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},t.consumeStream=(e,t,r)=>{e.on("data",r||E),e.on("end",t||E)},t.createJSONPatch=function(e,t,r){return(r?function e(t,s,o){let i=r(t,s,o);return d(i)?i:Z(t,s,o,e)}:Z)(e,t,new et)},t.createPatchDocumentBuilder=function(e){return new er(e)},t.dataToBuffer=function(e){return"string"==typeof e?V(e):e},t.deepCopy=e=>JSON.parse(JSON.stringify(e)),t.endPointOf=e=>{let t,r=D(e),s=r.scheme,o=r.authority,i="https"===s?443:"http"===s?80:-1;return s&&o&&(t=(s+"://"+o).toLowerCase(),i>=0&&0>o.indexOf(":")&&(t=t+":"+i)),t},t.ensureRelativeHrefStartsWithSlash=e=>{if(e){let t=D(e),r=t.scheme,s=t.authority;r||s||"/"!==e.charAt(0)&&(e="/"+e)}return e},t.escapeURLPath=e=>(String.prototype.normalize?e=e.normalize("NFC"):console.warn("String.normalize not found while escaping URL path. You may be missing a polyfill."),e.length>0&&"/"===e.charAt(0)&&(e=e.substr(1)),N(e,O)),t.expandURITemplate=X,t.flatCopy=e=>{let t={},r=Object.keys(e),s=r.length;for(let o=0;o<s;o++){let s=r[o];t[s]=e[s]}return t},t.generateUuid=()=>o.v4(),t.getDomainFromURL=e=>{if(!e||"string"!=typeof e)return e;let t=(e=(e=(e=(e=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split("?")[0]).split("/")[0]).split(":")[0]).split(".");return t.slice(Math.max(t.length-2,0)).join(".")},t.getFirstRegexpCapture=(e,t)=>{let r;return e&&"string"==typeof e&&t&&(r="string"==typeof t?e.match(t):t.exec(e))?r[1]:""},t.getLinkHref=eC,t.getLinkHrefTemplated=eI,t.getLinkProperty=eD,t.getPerformance=eT,t.getStartIdxOfMimeType=B,t.getSuffixIdxOfMimeType=x,t.hexVal=v,t.isAnyFunction=l,t.isArray=d,t.isArrayBuffer=e=>a(e)&&l(e.constructor)&&"ArrayBuffer"===e.constructor.name&&l(e.slice),t.isArrayBufferView=e=>a(e)&&l(e.constructor)&&"DataView"===e.constructor.name&&a(e.buffer)&&l(e.buffer.slice),t.isBrowser=c,t.isBrowserSDK=()=>"browser"===u(),t.isBuffer=e=>a(e)&&l(e.constructor)&&"Buffer"===e.constructor.name&&l(e.slice),t.isDefined=e=>null!=e,t.isHexChar=C,t.isJsonContentType=e=>{if("string"!=typeof e)return!1;let t=e.toLowerCase().split("application/");if(t.length<2)return!1;let r=t[1].split(";")[0].trim();return"json"===r||r.endsWith("+json")},t.isNode=h,t.isNodeReadableStream=e=>n(e)&&l(e.on),t.isObject=a,t.isPctEncoding=I,t.isPromise=e=>null!=e&&a(e)&&l(e.then),t.isReadableStream=n,t.isUndefined=e=>null==e,t.isValidAbsolutePath=e=>m(e,!0),t.isValidAdobeURN=e=>/^urn:aaid:[a-zA-Z]{2}:[a-zA-Z0-9]{2,6}:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),t.isValidPath=m,t.isVoid=e=>null==e,t.isWHATWGReadableStream=e=>n(e)&&l(e.pipeTo),t.isWebWorker=()=>c()&&!!self.WorkerGlobalScope,t.merge=p,t.mergeDeep=_,t.noOp=E,t.normalizeHeaders=e=>{if(null===e||"object"!=typeof e)return{};let t={};for(let[r,s]of Object.entries(e))t[r.toLowerCase()]=d(s)?s.join(";"):s;return t},t.now=eP,t.objectFromEntries=function(e){let t={};for(let[r,s]of e)t[r]=s;return t},t.objectsEqual=A,t.parse=ev,t.parseHeaders=e=>{let t,r,s={},o=e.split(/\r?\n/);for(let e=0;e<o.length;++e){let i=o[e];if(i.length>0){let e=i.charCodeAt(0);if(t&&(9===e||32===e))s[t]=s[t]+" "+i.replace(q,"");else{let e=W.exec(i);e&&e.length>1&&(t=e[1].toLowerCase(),r=(r=e[2]||"").replace(q,""),s[t]?s[t]=s[t]+","+r:s[t]=r)}}}return s},t.parseURI=D,t.provideLink=function(e,t={},r){let s="function"==typeof t.selector?t.selector:ei,o=Array.isArray(e)?s(e,r):e;if(!o)throw new i.DCXError(i.DCXError.INVALID_PARAMS,"Could not select appropriate link for usage");return o.templated?"function"==typeof t.expander?t.expander(o.href,r):X(o.href,r):o.href},t.pruneUndefined=en,t.removeLeadingSlashForPath=e=>(e.length>0&&"/"===e.charAt(0)&&(e=e.substr(1)),e),t.retriesWithDelayOnError=function e(t,r,s,o,n){return j(this,void 0,void 0,function*(){return t().catch(a=>j(this,void 0,void 0,function*(){var l,d,h;if(eP()-s.startTime>=s.timeoutAfter)throw new i.DCXError(i.DCXError.TIMED_OUT,"request aborted due to timeout");o||(o=null==(l=a.response)?void 0:l.response.type);let c=1e3*parseInt(null==(d=a.response)?void 0:d.headers["retry-after"],10)||n||1e3;if((null==(h=a.response)?void 0:h.statusCode)===r&&a.response.response.type===o)return yield eR(c),e(t,r,s,o,n);throw a}))})},t.safeGet=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},t.sleep=eR,t.stringToBuffer=V,t.timeStamp=(e=!1)=>{let t=(new Date).getTime();return e&&(t-=t%1e3),t},t.validateJSONPatchDocument=function(e){if(!d(e))return[es("doc","Invalid type.")];let t=[];return e.forEach((e,r)=>{let s=eo(e);!0!==s&&s.forEach(e=>{e.property=`doc[${r}].${e.property}`,t.push(e)})}),!(t.length>0)||t},t.validateJSONPatchOperation=eo,t.validateObject=function(e,t,...r){if(t=t?" "+t+" ":" ",!e||"object"!=typeof e)throw new i.DCXError(i.DCXError.INVALID_PARAMS,`Object${t}is invalid.`);try{r.forEach(t=>{G(t[0],e[t[0]],t[1],t[2]||!1,t[3]||[])})}catch(e){throw new i.DCXError(i.DCXError.INVALID_PARAMS,`Object${t}is invalid. ${e.message.replace("Param","Property")}`,e)}},t.validateParam=G,t.validateParams=K,t.verifyUuid=e=>o.validate(e),t.verifyandGetSnapshotMimetype=e=>{let t=H(e,100),r=x(t,"+dcxucf"),s=B(t);return r>-1&&s>-1?t.substring(s,r+7):""},t.withRetries=function e(t,r=3){return t().catch(s=>{if(r)return e(t,r-1);throw s})}},609645:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var s=r(42173);class o{constructor(e){this._data=e}getElementsByTagName(e){return this._data.children.filter(t=>"string"!=typeof t&&t.tagName===e).map(n)}}class i extends o{constructor(e){super(e),this._data=e}setAttribute(e,t){this._data.attributes[e]=t}getAttribute(e){return this._data.attributes[e]}appendChild(e,t={},r=[]){let s={tagName:e,attributes:t,children:r};return this._data.children.push(s),n(s)}}function n(e){return new i(e)}class a extends o{constructor(e){super(e)}parse(e){let t=function(e,t={}){let r,s=t.pos||0,o=!!t.keepComments,i=!!t.keepWhitespace;function n(t){let r=[];for(;e[s];)if(60===e.charCodeAt(s)){if(47===e.charCodeAt(s+1)){let o=s+2;if(s=e.indexOf(">",s),-1===e.substring(o,s).indexOf(t)){let t=e.substring(0,s).split("\n");throw Error("Unexpected close tag\nLine: "+(t.length-1)+"\nColumn: "+(t[t.length-1].length+1)+"\nChar: "+e[s])}return s+1&&(s+=1),r}if(33===e.charCodeAt(s+1)){if(45===e.charCodeAt(s+2)){let t=s;for(;-1!==s&&(62!==e.charCodeAt(s)||45!==e.charCodeAt(s-1)||45!==e.charCodeAt(s-2)||-1===s);)s=e.indexOf(">",s+1);-1===s&&(s=e.length),o&&r.push(e.substring(t,s+1))}else{if(91===e.charCodeAt(s+2)&&91===e.charCodeAt(s+8)&&"cdata"===e.substr(s+3,5).toLowerCase()){let t=e.indexOf("]]>",s);-1===t?(r.push(e.substr(s+9)),s=e.length):(r.push(e.substring(s+9,t)),s=t+3);continue}{let t=s+1;s+=2;let o=!1;for(;(62!==e.charCodeAt(s)||!0===o)&&e[s];)91===e.charCodeAt(s)?o=!0:!0===o&&93===e.charCodeAt(s)&&(o=!1),s++;r.push(e.substring(t,s))}}s++;continue}let i=d();r.push(i),"?"===i.tagName[0]&&(r.push(...i.children),i.children=[])}else{let t=function(){let t=s;return -2==(s=e.indexOf("<",s)-1)&&(s=e.length),e.slice(t,s+1)}();(i||t.trim().length>0)&&r.push(t),s++}return r}function a(){let t=s;for(;-1==="\r\n	>/= ".indexOf(e[s])&&e[s];)s++;return e.slice(t,s)}let l=t.noChildNodes||["img","br","input","meta","link","hr"];function d(){s++;let t=a(),r={},o=[];for(;62!==e.charCodeAt(s)&&e[s];){let i=e.charCodeAt(s);if(i>64&&i<91||i>96&&i<123){let i=a(),n,l=e.charCodeAt(s);for(;l&&39!==l&&34!==l&&!(l>64&&l<91||l>96&&l<123)&&62!==l;)s++,l=e.charCodeAt(s);if(39===l||34===l){if(n=function(){let t=e[s],r=s+1;return s=e.indexOf(t,r),e.slice(r,s)}(),-1===s)return{tagName:t,attributes:r,children:o}}else n=null,s--;r[i]=n}s++}if(47!==e.charCodeAt(s-1))if("script"===t){let t=s+1;s=e.indexOf("<\/script>",s),o=[e.slice(t,s)],s+=9}else if("style"===t){let t=s+1;s=e.indexOf("</style>",s),o=[e.slice(t,s)],s+=8}else -1===l.indexOf(t)?(s++,o=n(t)):s++;else s++;return{tagName:t,attributes:r,children:o}}if(void 0!==t.attrValue)for(t.attrName=t.attrName||"id",r=[];-1!==(s=function(){let r=RegExp("\\s"+t.attrName+"\\s*=['\"]"+t.attrValue+"['\"]").exec(e);return r?r.index:-1}());)-1!==(s=e.lastIndexOf("<",s))&&r.push(d()),e=e.substr(s),s=0;else r=t.parseNode?d():n("");return t.simplify?function e(t){let r={};if(!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];for(let s in t.forEach(function(t){if("object"!=typeof t)return;r[t.tagName]||(r[t.tagName]=[]);let s=e(t.children);r[t.tagName].push(s),Object.keys(t.attributes).length&&(s._attributes=t.attributes)}),r)1===r[s].length&&(r[s]=r[s][0]);return r}(Array.isArray(r)?r:[r]):r}(e);return this._data={children:s.isArray(t)?t:[t]},this}getElementsByTagName(e){return super.getElementsByTagName(e)}toString(){return function(e,t=!1){let r="",s=0;return function e(o){if(s+=1,o){t&&o.length>0&&"string"!=typeof o[0]&&(r+="\r\n");for(let i=0;i<o.length;i++)"string"==typeof o[i]?r+=o[i].trim():function(o){for(let e in r+=t?"<".padStart(s)+o.tagName:"<"+o.tagName,o.attributes)null===o.attributes[e]?r+=" "+e:-1===o.attributes[e].indexOf('"')?r+=" "+e+'="'+o.attributes[e].trim()+'"':r+=" "+e+"='"+o.attributes[e].trim()+"'";"?"!==o.tagName[0]?(r+=">",e(o.children),t&&r.endsWith("\r\n")?r+="</".padStart(s)+o.tagName+">\r\n":r+=t?"</"+o.tagName+">\r\n":"</"+o.tagName+">"):r+=t?"?>\r\n":"?>"}(o[i]);t&&o.length>0&&"string"!=typeof o[0]&&!r.endsWith("\r\n")&&(r+="\r\n")}s-=1}(e),r}(this._data.children)}}function l(e){return(new a).parse(e)}function d(e){return s.isObject(e)&&s.isArray(e.patchDocument)?e.patchDocument:[]}let h="dcx-js";function c(e,t=h,r=(new Date).toISOString(),o=s.generateUuid()){let i=d(this),n=p(o,e,t,r);return s.createPatchDocumentBuilder(i).add("/xmpMM:History/@list/-",n).replace("/xmpMM:InstanceID",o).replace("/xmp:ModifyDate",r).replace("/xmp:MetadataDate",r).operations}function u(e,t,r){let o=d(this);return s.createPatchDocumentBuilder(o).add(`/${e}:${t}`,r).operations}function p(e,t,r,s){return{"stEvt:action":t,"stEvt:when":s,"stEvt:softwareAgent":r,"stEvt:instanceID":e}}function _(e=h,t,r=s.generateUuid(),o=(new Date).toISOString()){return`<rdf:li
    stEvt:action="${t}"
    stEvt:instanceID="xmp.iid:${r}"
    stEvt:when="${o}"
    stEvt:softwareAgent="${e}"/>`}function f(e=h,t=s.generateUuid(),r=(new Date).toISOString(),o,i){return o||(o=[_(e,"created",t,r)]),`<x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 7.1.2">
        <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
            <rdf:Description rdf:about=""
            xmlns:xmp="http://ns.adobe.com/xap/1.0/"
            xmlns:xmpMM="http://ns.adobe.com/xap/1.0/mm/"
            ${i?'xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#"':""}
            xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#"
            xmpMM:OriginalDocumentID="xmp.did:${t}"
            xmp:ModifyDate="${r}"
            xmp:MetadataDate="${r}"
            xmp:CreatorTool="${e}"
            xmp:CreateDate="${r}"
            xmpMM:DocumentID="xmp.did:${t}"
            xmpMM:InstanceID="xmp.iid:${t}">
                <xmpMM:History>
                    <rdf:Seq>
                        ${o.join("\n")}
                    </rdf:Seq>
                </xmpMM:History>
                ${i||""}
            </rdf:Description>
        </rdf:RDF>
    </x:xmpmeta>`}function g(e,t,r){let s=e.getElementsByTagName(t),o=e.getAttribute(t);s.length<1&&null==o&&e.setAttribute(t,r)}t.XMLElement=i,t.XMLParser=a,t.appendHistoryEvent=c,t.deleteProperty=function(e,t){let r=d(this);return s.createPatchDocumentBuilder(r).remove(`/${e}:${t}`).operations},t.initializeXMPJSON=function(e=h,t=s.generateUuid(),r=(new Date).toISOString()){return{"xmp:ModifyDate":r,"xmp:MetadataDate":r,"xmp:CreatorTool":e,"@context":{xmpMM:"http://ns.adobe.com/xap/1.0/mm/",stEvt:"http://ns.adobe.com/xap/1.0/sType/ResourceEvent#",xmp:"http://ns.adobe.com/xap/1.0/"},"xmpMM:DocumentID":`xmp.did:${t}`,"xmpMM:History":{"@list":[{"stEvt:softwareAgent":e,"stEvt:action":"created","stEvt:when":r,"stEvt:instanceID":`xmp.iid:${t}`}]},"xmp:CreateDate":r,"@id":"","xmpMM:InstanceID":`xmp.iid:${t}`,"xmpMM:OriginalDocumentID":`xmp.did:${t}`}},t.initializeXMPXML=f,t.makeDerivedWithAction=function(e=h,t,r=s.generateUuid(),o=(new Date).toISOString()){let i=d(this),n=s.createPatchDocumentBuilder(i).add("/@context/stRef","http://ns.adobe.com/xap/1.0/sType/ResourceRef#").add("/@context/xmpMM","http://ns.adobe.com/xap/1.0/mm/").add("/xmpMM:DerivedFrom",{}).copy("/xmpMM:DocumentID","/xmpMM:DerivedFrom/stRef:documentID").copy("/xmp:ModifyDate","/xmpMM:DerivedFrom/stRef:lastModifyDate").copy("/xmpMM:InstanceID","/xmpMM:DerivedFrom/stRef:instanceID").copy("/xmpMM:OriginalDocumentID","/xmpMM:DerivedFrom/stRef:originalDocumentID").replace("/xmpMM:InstanceID",r).replace("/xmpMM:DocumentID",r);return c.call({patchDocument:n.operations},t,e,o,r)},t.makeDerivedWithXML=function(e,t,r,o=(new Date).toISOString()){return e||t||r||(e=s.generateUuid()),`<xmpMM:DerivedFrom
        stRef:documentID="xmp.did:${t||r||e}"
        stRef:instanceID="xmp.iid:${r||t||e}"
        stRef:originalDocumentID="xmp.did:${e||t||r}"
        stRef:lastModifyDate="${o}"/>`},t.makeHistoryEventXML=_,t.parseXML=l,t.registerNamespace=function(e,t){let r=d(this);return s.createPatchDocumentBuilder(r).add(`/@context/${t}`,e).operations},t.repairXMPXML=function(e,t=h,r=s.generateUuid(),o=(new Date).toISOString()){let i=l(e),n=i.getElementsByTagName("x:xmpmeta");if(n.length<1)return f(t,r,o);let a=n[0].getElementsByTagName("rdf:RDF");if(a.length<1)return f(t,r,o);let d=a[0].getElementsByTagName("rdf:Description");if(d.length<1)return f(t,r,o);let c=d[0];return g(c,"xmp:ModifyDate",o),g(c,"xmp:MetadataDate",o),g(c,"xmp:CreatorTool",t),g(c,"xmp:CreateDate",o),g(c,"xmpMM:DocumentID",`xmp.did:${r}`),g(c,"xmpMM:InstanceID",`xmp.iid:${r}`),g(c,"xmpMM:OriginalDocumentID",`xmp.did:${r}`),function(e){let t=["xmpMM:History","rdf:Seq"],r=e;for(;t.length>0;){let e=t.shift(),s=r.getElementsByTagName(e);r=s.length>0?s[0]:r.appendChild(e)}}(c),i.toString()},t.setCreatorTool=function(e){return u.call(this,"xmp","CreatorTool",e)},t.setProperty=u,t.updateLastHistoryEvent=function(e,t,r){let o=d(this);if(null==e&&null==t&&null==r)return o;let i=s.createPatchDocumentBuilder(o),n=p(s.generateUuid(),e,t,r);for(let e in n=s.pruneUndefined(n))i.replace(`/xmpMM:History/@list/-/${e}`,n[e]);return i.operations}}}]);
//# sourceMappingURL=vendor-startup-dcx.d31d0dd4b85ef572.js.map